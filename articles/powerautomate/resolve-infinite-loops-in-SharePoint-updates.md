---
title: Power Automate のフローで無限トリガーループが起きる際の対処法
date: 2024-06-19 13:30:00
tags:
  - Power Automate
  - Power Platform
---

# Power Automate のフローで無限トリガーループが起きる際の対処法
こんにちは。Power Platform サポートチームの トテ です。
今回は、 Power Automate のフローで無限トリガーループが起きる際の対処法についてご紹介します。

<!-- more -->

## 1 . 無限トリガーループ事象
Power Automate フローを実行した際、ないしはフローチェッカー上に、「このフローでの操作は、無限トリガーループを引き起こす可能性がありますという警告メッセージが表示されてしまうケースがあります。

写真

*無限トリガーループとは、ワークフローまたは自動化プロセスが無限にトリガーされる状態を指します。一度の動きを想定しているつもりが、フローをオフにしない限り、同じ動作が繰り返し起きてしまう状態です。

<br>

## 2. Power Automate 上で見られる実例
以下のフローを作成しています。

① SharePoint リストに登録<br>（ SharePoint コネクタの「アイテムが作成または変更されたとき」のトリガーを使用）
② Teams チームのチャネルに投稿
③ ②のメッセージリンクを①のリンク列に追加

写真

上記において、無限トリガーループの警告メッセージが表示される場合には、フロー内での更新に対してもフローが起動してしまうことで、再度 SharePoint のアイテムが更新される状況になっていることが考えられます。

<br>

## 3. 事象の原因
- 例として挙げているフローは、フロー①において、SharePoint 上で作成か更新がされた際にフローが起動する状態を指定しています。
- すると、フローが起動した際には無条件で SharePoint のアイテムを更新するというフローになってしまうため、無限ループの動作が発生してしまいます。

<br>

## 4. 対策
### アイテム作成時のみのトリガーで要件を満たせる場合（ SharePoint リストアイテムの更新ではフローをトリガーする必要がない場合）

写真

<br><br>

### SharePoint リストアイテムの作成、更新どちらでもトリガーを必要とする場合

対策の手順は主に2つです。

**①〈 SharePoint コネクタのアクション : 「アイテムやファイルの変更を取得する(プロパティのみ)」の追加〉**

既存のフローの SharePoint コネクタ の「アイテムやファイルの変更を取得する(プロパティのみ)」のアクションを追加します。<br>

写真

パラメーターの内容
- サイトのアドレスおよびリストやライブラリの名前 : 「アイテムが作成または変更されたとき」のアクション同じ SharePoint サイト・リスト を指定します。
- ID :　動的コンテンツにて、 「アイテムが作成または変更されたとき」の ID を指定します。
- 以降 : 動的コンテンツにて、 「アイテムが作成または変更されたとき」の「トリガー期間の開始トークン（ウィンドウ開始のトークンのトリガー）」を指定します。
  
<br>

**②〈条件分岐の追加〉**
次に条件分岐を追加します。
リンクが更新された場合には Teams に投稿をせず、新規作成またはそれ以外の列が更新された場合には Teams に投稿をする、という条件を作成します。

写真

パラメーターの内容
- 左辺： 「アイテムやファイルの変更を取得する(プロパティのみ)」の 動的コンテンツより、SharePoint のリンクを格納している列に該当するものを取得し設定します。
- 中央：is equal to (に等しい)
- 右辺：false


上記の条件の場合、Teams に投稿以降のアクションを条件分岐の True (はい)側に含めるようにご設定ください。

