<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Dynamics CRM &amp; Power Platform Support Blog</title>
  
  <subtitle>日本マイクロソフトの Dynamics CRM &amp; Power Platform テクニカル サポート チームより、情報をお届けします！</subtitle>
  <link href="https://jpdynamicscrm.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpdynamicscrm.github.io/blog/"/>
  <updated>2024-11-26T00:36:26.434Z</updated>
  <id>https://jpdynamicscrm.github.io/blog/</id>
  
  <author>
    <name>Japan Dynamics CRM &amp; Power Platform Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>メールボックスの承認・テストと有効化の自動化について</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/EmailEnableAutmation/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/EmailEnableAutmation/</id>
    <published>2024-11-26T00:36:30.330Z</published>
    <updated>2024-11-26T00:36:26.434Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの原です。<br>本記事では Dynamics 365における、メールボックスの承認・テストと有効化の自動化についてご紹介いたします。<br>また、メールボックスの承認・テスト有効化を自動化するための標準機能としてご提供している機能は現段階ではございませんが、代替案がございますので、本記事ではそちらの代替案をご紹介させていただきます。少しでもお客様の業務効率化に繋がりますと幸いです。</p><p>なお、弊社検証環境では下記にご紹介するコマンドにて、電子メールの承認やテストと有効化が実行可能なことを確認しておりますが、下記でご案内いたします Microsoft.Xrm.Data.PowerShell モジュールにつきましては、コミュニティにより<br>提供・メンテナンスされるツールでございますため、本モジュールをご利用いただく中での<br>エラーやご不明点に関しましては弊社からサポートをご提供することがかないません。<br><br>そのため、ご確認いただく中で何か問題があった場合は、基本的には以下の New Issue より、Github 経由で問題を報告いただく必要がございます。<br>予めご了承いただきますようお願いいたします。<br>URL:<a href="https://github.com/seanmcne/Microsoft.Xrm.Data.PowerShell/issues">https://github.com/seanmcne/Microsoft.Xrm.Data.PowerShell/issues</a></p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Dynamics 365では、Dynamics 365と Exchange Online の同期を行うことができます。これを行うことで、 Dynamics 365 のレコードから取引先担当者にメールを送信できるようになったり、営業案件のタイムラインで会話を追跡することができるようになります。<br><br>メールボックスを有効化するためには、承認とテストが既定では必須となっております。<br>メールボックスの承認・テストと有効化を手動で行う方法については、<a href="https://learn.microsoft.com/ja-jp/power-platform/admin/connect-exchange-online" target="_blank">Exchange Online への接続</a>をご参照ください。<br></p><p><a id='anchor-powershell'></a></p><h2 id="PowerShell-を使用して実行する"><a href="#PowerShell-を使用して実行する" class="headerlink" title="PowerShell を使用して実行する"></a>PowerShell を使用して実行する</h2><p>メールボックスの承認やテストと有効化は PowerShell で下記コマンドを入力することで実施いただくことが可能です。<br><br>そのため、タスク スケジューラや Power Automate を利用しPowerShell を実行いただくことで、任意のタイミングで自動的にメールボックスの承認やテストと有効化を行うことが可能となります。<br>また、反復処理などで各ユーザーの IDを置き換える処理を実装いただくことで、複数のメールボックスに対して一括でメールボックスの承認やテストと有効化を行うことが可能です。<br>Power Automate を使用して PowerShell を実行する方法に関しては、<br><a href="https://jpdynamicscrm.github.io/blog/powerautomate/Execute-PowerShell/#:~:text=Azure%20%E4%B8%8A%E3%81%A7%20PowerShell%20%E3%82%84%20Python%20%E3%81%AA%E3%81%A9%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E6%A9%9F%E8%83%BD%E3%81%A7%E3%81%99%E3%80%82%20%E3%81%93%E3%81%AE%20Runbook,Forms%20%E3%81%A7%20Microsoft%20365%20%E7%AE%A1%E7%90%86%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%20%E3%81%AE%E3%83%AD%E3%83%BC%E3%83%AB%E7%94%B3%E8%AB%8B%E3%82%92%E8%A1%8C%E3%81%84%E3%80%81%E6%89%BF%E8%AA%8D%E3%81%95%E3%82%8C%E3%81%9F%E3%82%89%E3%80%81%20PowerShell%20%E3%81%A7%E3%83%AD%E3%83%BC%E3%83%AB%E4%BB%98%E4%B8%8E%E3%81%99%E3%82%8B" target="_blank" rel="noopener noreferrer"> Power Automateを使用して PowerShell を実行する方法</a><br>をご参照ください。</p><ol><li>管理者として PowerShell を起動します。</li><li>以下のコマンドを実行し、 Microsoft.Xrm.Data.Poweshell のモジュールをダウンロードします。<br><br>Install-Module Microsoft.Xrm.Data.PowerShell -Scope CurrentUser</li><li>以下のコマンドを実行します。<br><br>Import-Module Microsoft.Xrm.Data.Powershell</li><li>   以下のコマンドを実行します。<br><br>Connect-CrmOnlineDiscovery -InteractiveMode</li><li>   PowerShell Interactive Login ウィザードが表示されますので、[Display list of available organizations] にチェックを入れ、[Login]をクリックし、サインインします。</li><li>   インスタンス一覧が出力されますので、当該インスタンスを選択し、[Login] をクリックします。</li><li>   ログイン完了後、以下のコマンドにより指定したユーザーの電子メールの承認が可能です。<br><br>Approve-CrmEmailAddress  -UserId &lt;UserId&gt;</li><li>   また、以下のコマンドによりユーザーのメールボックスに対してメールボックスのテストと有効化を実行することができます。<br><br>Set-CrmUserMailbox -UserId &lt;UserId&gt;  -ScheduleTest</li></ol><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p><strong>メールボックスの承認を不要にする</strong><br><br>メールボックスを有効化するにあたって、メールボックスの承認は、既定では必須となっております。<br><br>ただし、こちらの承認作業は、管理者にて設定を変更いただくことで、要件を削除することが可能となっております。<br><br>詳しい手順につきましては、<a href="https://learn.microsoft.com/ja-jp/power-platform/admin/connect-exchange-online#remove-the-requirement-to-approve-mailboxes" target="_blank">メールボックスを承認するための要件の削除</a>をご参照ください。<br><br><br>また、メールボックスを承認するための要件を削除せずに、自動化をされたい場合は、<a href="#anchor-powershell">  PowerShell を使用して実行する</a>をご検討ください。</p><h2 id="終わりに"><a href="#終わりに" class="headerlink" title="終わりに"></a>終わりに</h2><p>本記事では Dynamics 365における、メールボックスの承認・テストと有効化についてご紹介いたしました。メールボックスを管理する上でのお役に立てましたら幸いです。ご不明な点や、お困りのことなどがございましたら、弊社サポート一同にてお待ち申し上げておりますので、ぜひお気軽にお問合せください。<br><br><br>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの原です。&lt;br&gt;本記事では Dynamics 365における、メールボックスの承認・テストと有効化の自動化についてご紹介いたします。&lt;br&gt;また、メールボックスの承認・テスト有効化を自動化するための標準機能としてご提</summary>
      
    
    
    
    
    <category term="Dynamics" scheme="https://jpdynamicscrm.github.io/blog/tags/Dynamics/"/>
    
    <category term="Environment" scheme="https://jpdynamicscrm.github.io/blog/tags/Environment/"/>
    
    <category term="サポート" scheme="https://jpdynamicscrm.github.io/blog/tags/%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88/"/>
    
  </entry>
  
  <entry>
    <title>Power Platform Ideasサイトのご紹介</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/Power-platform-Ideas/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/Power-platform-Ideas/</id>
    <published>2024-11-19T15:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.438Z</updated>
    
    <content type="html"><![CDATA[<!-- ここに 導入部分 --><p>こんにちは、Power Platform サポートチームの藤田です。<br>今回は、製品に対して改善や実装要望を届けることのできる Ideas をご紹介します。</p><span id="more"></span><!-- ここに Read more 以降の文章 --><hr><h2 id="Ideas-とは？"><a href="#Ideas-とは？" class="headerlink" title="Ideas とは？"></a>Ideas とは？</h2><p>各製品の Ideas にご投稿いただくことで、お客様から直接製品チームにご意見やご要望をお伝えいただくことが可能です。</p><p><a href="https://ideas.powerapps.com/d365community/forum/f1458c72-ae29-ed11-9db2-000d3a8c451e">Power Apps Ideas</a></p><p><a href="https://ideas.powerautomate.com/d365community/forum/086dd68e-597f-ec11-8d21-0022482e8f9f">Power Automate Ideas</a></p><p><a href="https://ideas.powervirtualagents.com/d365community/forum/21a4f1f9-f7fc-ec11-82e6-000d3a8b109b">Copilot Studio</a></p><p>投稿されたご意見の採用をお約束できるものではございませんが、<br>投稿に対して Vote 数が多くなることで製品チームが確認を行い、機能強化が行われることもございますので、<br>ぜひ投稿をご検討ください。</p><p>このサイトは投稿した後に、状況に応じてご要望の機能の必要性やビジネスインパクトなどの確認を行う場合があるため、<br>技術サポートからではなくお客様によるご投稿を推奨させていただいております。</p><h2 id="Ideas-の利用方法について"><a href="#Ideas-の利用方法について" class="headerlink" title="Ideas の利用方法について"></a>Ideas の利用方法について</h2><p>新規投稿や、投票、コメント機能を利用するためには、Microsoft アカウント もしくは Microsoft 職場または学校アカウント でサインインする必要があります。<br>投稿を閲覧するのみの場合は、Microsoft アカウントでサインインする必要はありません。<br>サインイン手順と、投稿の利用手順をご案内いたしますのでご確認ください。</p><h3 id="Microsoft-アカウント-もしくは-Microsoft-職場または学校アカウント-でサインインする手順"><a href="#Microsoft-アカウント-もしくは-Microsoft-職場または学校アカウント-でサインインする手順" class="headerlink" title="Microsoft アカウント もしくは Microsoft 職場または学校アカウント でサインインする手順"></a>Microsoft アカウント もしくは Microsoft 職場または学校アカウント でサインインする手順</h3><ol><li>画面右上に表示される [Sign in] ボタンをクリックします。</li><li>[サインイン] 画面にて Microsoft アカウント もしくは Microsoft 職場または学校アカウント の情報を入力し、[サインイン] をクリックします。</li><li>[要求されているアクセス許可] と表示された場合には、[承諾] をクリックします。</li><li>[Complete your Profile] 画面で Usernameに任意のユーザー名を入力し、[Submit] ボタンをクリックします。</li><li>サインインが完了します。</li></ol><h3 id="投稿方法"><a href="#投稿方法" class="headerlink" title="投稿方法"></a>投稿方法</h3><ol><li>上記の [サインイン手順] を完了した状態で [新しいアイデアの投稿] をクリックします。</li><li>[タイトル] [カテゴリ]及び [説明] に内容を記載の上 Post することで投稿ができます。</li></ol><h2 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h2><p>Ideasをはじめ、コミュニティ サイトは、海外のお客様もご利用いただいております。<br>海外のお客様からVoteを集めたり、製品チームにて確認したりするために、可能な限り英語でご投稿をお願いいたします。</p><p>日本語で記述いただく場合には、お手数ではございますが、英訳も併記いただけますようお願いいたします。</p>]]></content>
    
    
    <summary type="html">&lt;!-- ここに 導入部分 --&gt;
&lt;p&gt;こんにちは、Power Platform サポートチームの藤田です。&lt;br&gt;今回は、製品に対して改善や実装要望を届けることのできる Ideas をご紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="PowerPlatform" scheme="https://jpdynamicscrm.github.io/blog/tags/PowerPlatform/"/>
    
    <category term="Ideas" scheme="https://jpdynamicscrm.github.io/blog/tags/Ideas/"/>
    
  </entry>
  
  <entry>
    <title>Power Platform - &quot;Http With Microsoft Entra ID (事前承認済み)&quot; コネクタのセキュリティ更新プログラム - MC901932 MC918447</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/MC901932/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/MC901932/</id>
    <published>2024-11-01T02:30:00.000Z</published>
    <updated>2024-11-26T00:36:26.434Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの網野です。<br>2024 年 10 月 に MC901932 / MC918447 にて通知された内容について、お客様への影響および対応方法についてご案内いたします。</p><span id="more"></span><h2 id="MC901932-・-MC918447-の内容"><a href="#MC901932-・-MC918447-の内容" class="headerlink" title="MC901932 ・ MC918447 の内容"></a>MC901932 ・ MC918447 の内容</h2><hr><h3 id="変更された内容"><a href="#変更された内容" class="headerlink" title="変更された内容"></a>変更された内容</h3><p>Http With Microsoft Entra ID コネクタを利用して API を実行する場合、管理者による API アクセス許可の承認が必要となります。<br><br>以下に詳細をご案内いたします。</p><p>変更前の状態では、API のアクセス許可方式が異なる 2 種類の有効なコネクタがあります。 <br></p><table><thead><tr><th align="left">コネクタ ID</th><th align="left">コネクタ表示名</th><th align="left">アクセス許可</th></tr></thead><tbody><tr><td align="left">webcontents</td><td align="left">Http With Microsoft Entra ID (事前承認済み)</td><td align="left"><b><font color=red>マイクロソフト</font></b>がアクセス許可</td></tr><tr><td align="left">webcontentsv2</td><td align="left">Http With Microsoft Entra ID</td><td align="left">管理者がアクセス許可</td></tr></tbody></table><div class="alert is-info"><p class="alert-title">Note</p><p>コネクタ表示名は機能変更前後で変更となるため、本ブログではコネクタ ID を使ってご説明いたします。</p><p></p></div><br>機能変更前の webcontents コネクタは信頼するファーストパーティのアプリに対してマイクロソフトが任意に API アクセス許可を与えていました。<br><br>機能の変更が展開されますと、webcontents コネクタのアクセス許可を webcontentsv2 と同じ方式にし、webcontentsv2 コネクタを非推奨とします。<br>本機能変更によって管理者側で利用可能な API を必要最小限に制御し、お客様環境におけるセキュリティとデータプライバシーを強化することを目的としています。<br><br>変更後はコネクタ表示名とアクセス許可が以下のように変更になります。<table><thead><tr><th align="left">コネクタ ID</th><th align="left">コネクタ表示名</th><th align="left">アクセス許可</th></tr></thead><tbody><tr><td align="left">webcontents</td><td align="left">Http With Microsoft Entra ID</td><td align="left"><b><font color=red>管理者</font></b>がアクセス許可</td></tr><tr><td align="left">webcontentsv2</td><td align="left">Http With Microsoft Entra ID<b><font color=red>(deprecated)</font></b></td><td align="left">管理者がアクセス許可</td></tr></tbody></table><h3 id="影響範囲"><a href="#影響範囲" class="headerlink" title="影響範囲"></a>影響範囲</h3><p>機能の変更が展開された後に作成された接続から、変更後の動作になります。</p><h3 id="対応方法"><a href="#対応方法" class="headerlink" title="対応方法"></a>対応方法</h3><ol><li><u>webcontents コネクタを利用している</u>  <ul><li>変更<b><font color=red>前</font></b>に作成した接続  →　現時点では対応は必要ありません。</li><li>変更<b><font color=red>後</font></b>に作成した接続<br>→ <a href="https://learn.microsoft.com/ja-jp/connectors/webcontentsv2/#%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%81%8C%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%AB%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B">こちらの手順</a> に従い、 API 実行に必要なアクセス許可をアプリに付与し、webcontentsv2 コネクタで動作検証を行ってください。</li></ul></li><li><u>webcontentv2 コネクタを利用している</u><br>  2024 年 10 月時点では対応は必要ありませんが、今後 webcontentsv2 コネクタは非推奨となっていく予定です。</li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>機能の変更が展開されると、webcontents コネクタと webcontentsv2 コネクタは内部的に同じアプリとなります。</p><p></p><p>一方にアクセス許可を与えると両方のコネクタに対してアクセスが許可されます。</p></div><h2 id="メッセージセンター時系列"><a href="#メッセージセンター時系列" class="headerlink" title="メッセージセンター時系列"></a>メッセージセンター時系列</h2><table><thead><tr><th align="left">日付</th><th align="left">番号</th><th align="left">タイトル</th><th align="left">内容</th></tr></thead><tbody><tr><td align="left">2024 年 10 月 2 日</td><td align="left">MC901932</td><td align="left">Power Platform - “Http With Microsoft Entra ID (事前承認済み)” コネクタのセキュリティ更新プログラム</td><td align="left">機能変更の内容詳細とスケジュール</td></tr><tr><td align="left">2024 年 10 月 25 日</td><td align="left">MC918447</td><td align="left">Power Platform – [更新] “HTTP With Microsoft Entra ID (preauthorized)” コネクタのセキュリティ更新プログラム</td><td align="left">適用延期</td></tr></tbody></table><h3 id="MC901932"><a href="#MC901932" class="headerlink" title="MC901932"></a>MC901932</h3><p><b>Power Platform - “Http With Microsoft Entra ID (事前承認済み)” コネクタのセキュリティ更新プログラム</b><br></p><p>セキュリティを強化するための “Http With Microsoft Entra ID (preauthorized)” (“Webcontents” と呼ばれることもあります) コネクタの更新を発表します。この変更は 2024 年 10 月 25 日にロールアウトを開始し、2024 年 11 月 15 日に全世界でのロールアウトを完了します。この変更の一環として、アクセス許可がアタッチされていないファーストパーティアプリを使用する新しい接続タイプが追加されます。これは、セキュリティの露出を必要なものだけに制限することで、ベスト プラクティスが守られるようにするためです。この変更に伴い、コネクタの名前は “Http With Microsoft Entra ID” に更新され、名前から “(preauthorized)” が削除されます。</p><p><b>これにはどのような影響がありますか?</b><br></p><p>既存の接続は引き続き機能します。既存の接続を新しい接続タイプに移行する必要がある場合は、後日フォローアップします。<br>以下で推奨されるアクションを実行しない場合、2024 年 10 月 25 日以降に行われた新しい接続は失敗します。</p><p><b>準備するには何をする必要がありますか?</b><br></p><ol><li>この リンクされた記事 に記載されている手順に従って、2024 年 10 月 25 日より前にコネクタで使用されている最初の部分のアプリに必要なアクセス許可を追加してください。 </li><li>“Http With Microsoft Entra ID” (WebcontentsV2 とも呼ばれます) コネクタに接続を追加してテストを実行し、すべてが正常に動作することを確認します。 </li></ol><h3 id="MC918447"><a href="#MC918447" class="headerlink" title="MC918447"></a>MC918447</h3><p><b>Power Platform – [更新] “HTTP With Microsoft Entra ID (preauthorized)” コネクタのセキュリティ更新プログラム</b><br></p><p>この通信は、2024年10月1日に以前に伝達されたMC901932へのフォローアップメッセージです。以下の変更はまだ進行中ですが、当初2024年10月24日から2024年11月15日まで予定されていたロールアウト期間を延長します。 新しい推定タイムラインは、追加情報とともにできるだけ早く提供します。<br><br><br><br>セキュリティを強化するための “HTTP With Microsoft Entra ID (preauthorized)” (“Webcontents” と呼ばれることもあります) コネクタの更新を発表します。この変更の一環として、アクセス許可がアタッチされていないファーストパーティアプリを使用する新しい接続タイプが追加されます。これは、セキュリティの露出を必要なものだけに制限することで、ベストプラクティスが守られるようにするためです。この変更に合わせて、コネクタの名前は “HTTP With Microsoft Entra ID” に更新されます。</p><p><b>これにはどのような影響がありますか?</b><br><br>既存の接続は引き続き機能します。<br><br>既存の接続を新しい接続タイプに移行する必要がある場合は、後日フォローアップします。<br></p><p><b>準備するには何をする必要がありますか?</b><br></p><ol><li>「サインインしているユーザーに代わって動作するようにコネクタを承認する」の記事に記載されている手順に従って、コネクタで使用されているファーストパーティ アプリに必要なアクセス許可を追加してください。</li><li>“HTTP With Microsoft Entra ID” (WebcontentsV2 とも呼ばれます) コネクタに接続を追加してテストを実行し、すべてが正常に動作することを確認します。</li></ol><h2 id="よくあるご質問"><a href="#よくあるご質問" class="headerlink" title="よくあるご質問"></a>よくあるご質問</h2><h3 id="両方のコネクタを利用していますが、影響はありますか。"><a href="#両方のコネクタを利用していますが、影響はありますか。" class="headerlink" title="両方のコネクタを利用していますが、影響はありますか。"></a>両方のコネクタを利用していますが、影響はありますか。</h3><p>ご利用中のフローやアプリ等につきましては、今のところ影響はありません。<br><br>しかしながら、コネクタに対して新しく接続を作成する場合は機能変更の影響を受けます。<br><br>意図しないフローやアプリの中断を防ぐため、<a href="https://learn.microsoft.com/ja-jp/connectors/webcontentsv2/#%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%81%8C%E3%82%B5%E3%82%A4%E3%83%B3%E3%82%A4%E3%83%B3%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BB%A3%E3%82%8F%E3%82%8A%E3%81%AB%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B">こちらの手順</a> に従って、 API 実行に必要なアクセス許可をアプリに付与し、webcontentsv2 コネクタで動作検証を行ってください。<br></p><h3 id="自分のテナントに機能の変更が展開される具体的な日にちはわかりますか。"><a href="#自分のテナントに機能の変更が展開される具体的な日にちはわかりますか。" class="headerlink" title="自分のテナントに機能の変更が展開される具体的な日にちはわかりますか。"></a>自分のテナントに機能の変更が展開される具体的な日にちはわかりますか。</h3><p>恐れ入りますが、現時点で具体的な日にちはお伝えすることができません。<br><br>当初 2024 年 10 月 25 日 から 2024 年 11 月 15 日の間で適用される予定となっていましたが適用を延期しています。<br><br>適用予定日が決まり次第メッセージセンター等にて通知を行います。</p><h3 id="webcontents-コネクタを使っていますが、古い接続には影響が出ず、新しい接続にのみ影響が出るのはなぜですか"><a href="#webcontents-コネクタを使っていますが、古い接続には影響が出ず、新しい接続にのみ影響が出るのはなぜですか" class="headerlink" title="webcontents コネクタを使っていますが、古い接続には影響が出ず、新しい接続にのみ影響が出るのはなぜですか"></a>webcontents コネクタを使っていますが、古い接続には影響が出ず、新しい接続にのみ影響が出るのはなぜですか</h3><p>お客様のフローが意図せず停止することのないよう古い接続をそのまま利用できるような形で機能変更を行っているためです。<br></p><p>機能の変更が展開されますと、 webcontens コネクタに対して 2 種類の接続が存在するようになります。<br></p><table><thead><tr><th align="left"></th><th align="left">作成時期</th><th align="left">アクセス許可</th></tr></thead><tbody><tr><td align="left">接続Ａ</td><td align="left">変更前に作成</td><td align="left">APIのアクセス許可がマイクロソフトにより設定されている</td></tr><tr><td align="left">接続Ｂ</td><td align="left">変更後に作成</td><td align="left">APIのアクセス許可をユーザーが設定する</td></tr></tbody></table><p>接続Ａは引き続きご利用いただくことができますが、セキュリティの観点から管理者のアクセス許可を必要とする動作にしていく予定です。<br><br>接続Ａの対応については検討を行っているため、お客様側での対応が必要となりましたら改めてメッセージセンターで通知を行います。</p><h3 id="両方のコネクタをDLPポリシーでブロックしているのですが、影響ありますか。"><a href="#両方のコネクタをDLPポリシーでブロックしているのですが、影響ありますか。" class="headerlink" title="両方のコネクタをDLPポリシーでブロックしているのですが、影響ありますか。"></a>両方のコネクタをDLPポリシーでブロックしているのですが、影響ありますか。</h3><p>ブロックしてコネクタ自体を利用していない場合は影響ありません。</p><hr><p>本ブログの内容は MC901932 / MC918447 通達時点の情報となりますので、最新情報についてはコネクタ等各種公開情報を随時ご参照ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの網野です。&lt;br&gt;2024 年 10 月 に MC901932 / MC918447 にて通知された内容について、お客様への影響および対応方法についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Apps" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Apps/"/>
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
  </entry>
  
  <entry>
    <title>Copilot Studio お問い合わせの際の情報取得手順</title>
    <link href="https://jpdynamicscrm.github.io/blog/copilotstudio/helpful-information-for-copilotstudio-sr/"/>
    <id>https://jpdynamicscrm.github.io/blog/copilotstudio/helpful-information-for-copilotstudio-sr/</id>
    <published>2024-10-10T06:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.246Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの竹内です。<br>本記事では Copilot Studio (旧称 Power Virtual Agents) 関連のお問い合わせの際に、調査のために必要となる情報について、その取得手順をご案内致します。</p><span id="more"></span><ol><li><a href="#anchor-intro">概要</a></li><li><a href="#anchor-how-to-collect">情報取得手順詳細</a><ol><li><a href="#anchor-about-situation">事象の発生状況</a></li><li><a href="#anchor-about-screencapture">事象発生時のエラーメッセージや画面キャプチャ・動画</a></li><li><a href="#anchor-environmentid">環境 ID</a></li><li><a href="#anchor-botid">Bot ID</a></li><li><a href="#anchor-conversationid">Conversation ID</a></li><li><a href="#anchor-snapshot-zip">事象再現時のスナップショット zip ファイル</a></li><li><a href="#anchor-knowledge-enable-state">ナレッジの有効化状態</a></li><li><a href="#anchor-raw-input-output">会話入出力</a></li><li><a href="#anchor-topics-screen">トピック画面</a></li><li><a href="#anchor-conversation-transcript">会話トランスクリプションテーブルデータ</a></li><li><a href="#anchor-about-networkhar">Web ブラウザのネットワーク トレース・コンソール ログ</a></li></ol></li></ol><p><a id='anchor-intro'></a></p><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>弊社サポートではお問合せを頂いた際のトラブルシューティングにおいてお問い合わせの内容をもとに調査方針を立てております。<br>発生している事象の把握のため、直面されている事象の切り分けや情報提供をお願いすることがあります。<br>Copilot Studio (旧称 Power Virtual Agents) に関するサポートサービスへお問合せの際の情報取得手順について以下のとおりご案内いたします。</p><p><a id='anchor-how-to-collect'></a></p><h1 id="情報取得手順詳細"><a href="#情報取得手順詳細" class="headerlink" title="情報取得手順詳細"></a>情報取得手順詳細</h1><p><a id='anchor-about-situation'></a></p><h2 id="1-事象の発生状況"><a href="#1-事象の発生状況" class="headerlink" title="1. 事象の発生状況"></a>1. 事象の発生状況</h2><p>  エラーや意図しない状況がどのような状況下で発生するかお知らせください。<br>  事象の発生条件を特定することで、問題の特定だけではなく弊社環境での再現調査においても有用な情報が得られます。<br>  以下の情報をお知らせいただくことでより明確に事象を把握することができます。  </p><p><a id='anchor-about-screencapture'></a></p><h2 id="2-事象発生時のエラーメッセージや画面キャプチャ・動画"><a href="#2-事象発生時のエラーメッセージや画面キャプチャ・動画" class="headerlink" title="2. 事象発生時のエラーメッセージや画面キャプチャ・動画"></a>2. 事象発生時のエラーメッセージや画面キャプチャ・動画</h2><p>  エラーの内容を具体的に表すメッセージや画面キャプチャなどの情報をお寄せください。<br>  事象再現時の動画がありますと事象の発生状況をより正確に把握することができます。  </p><h3 id="エラーメッセージや画面キャプチャ"><a href="#エラーメッセージや画面キャプチャ" class="headerlink" title="エラーメッセージや画面キャプチャ"></a>エラーメッセージや画面キャプチャ</h3><p>  エラーの内容が分かるよう画面キャプチャをご取得ください。<br>  エラーメッセージ内にタイムスタンプやエラーコードが記載されている場合はそれらの情報を <strong>テキスト形式</strong> でご取得ください。  </p><h3 id="動画"><a href="#動画" class="headerlink" title="動画"></a>動画</h3><p>  以下のいずれかの方法で事象発生時の動画をご取得ください。  </p><div class="alert is-important"><p class="alert-title">重要</p><p>事象発生の事前に取得開始し、事象発生後に採取を行う必要がございます。</p></div><ul><li>Windows ゲーム バーでの画面収録<br><a href="https://support.microsoft.com/ja-jp/windows/%E3%82%B2%E3%83%BC%E3%83%A0-%E3%83%90%E3%83%BC%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6-pc-%E3%81%AB%E3%82%B2%E3%83%BC%E3%83%A0-%E3%82%AF%E3%83%AA%E3%83%83%E3%83%97%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B-2f477001-54d4-1276-9144-b0416a307f3c">ゲーム バーを使用して PC にゲーム クリップを記録する</a>  </li><li>PowerPoint での画面収録<br><a href="https://support.microsoft.com/ja-jp/office/powerpoint-%E3%81%A7%E7%94%BB%E9%9D%A2%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B-0b4c3f65-534c-4cf1-9c59-402b6e9d79d0">PowerPoint で画面を記録する</a>  </li><li>Microsoft Teams での画面収録<br><a href="https://support.microsoft.com/ja-jp/office/microsoft-teams-%E3%81%A7%E4%BC%9A%E8%AD%B0%E3%82%92%E8%A8%98%E9%8C%B2%E3%81%99%E3%82%8B-34dfbe7f-b07d-4a27-b4c6-de62f1348c24#:~:text=Microsoft">Microsoft Teamsで会議を記録する</a>  </li></ul><p><a id='anchor-environmentid'></a></p><h2 id="3-環境ID"><a href="#3-環境ID" class="headerlink" title="3. 環境ID"></a>3. 環境ID</h2><p>  以下の手順で環境 ID を取得し、ご提供ください。<br>  必要に応じて URL をそのままご提供ください。</p><ul><li>Copilot Studio ポータルを開きます。開いている環境が対象の環境であることを確認してください  </li><li>URL 内の environments/ の直後にある ID が環境 ID です。</li><li>URL をテキストファイル、あるいは文字列としてメール等に張り付けてご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_EnvironmentID.png">  </li></ul><p><a id='anchor-botid'></a></p><h2 id="4-Bot-ID"><a href="#4-Bot-ID" class="headerlink" title="4. Bot ID"></a>4. Bot ID</h2><p>  以下の手順で環境 ID を取得し、ご提供ください。<br>  必要に応じて URL をそのままご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロットを開きます。</li><li>URL 内の bots/ の直後にある ID が Bot ID です。</li><li>URL をテキストファイル、あるいは文字列としてメール等に張り付けてご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_BotID.png">  </li></ul><p><a id='anchor-conversationid'></a></p><h2 id="5-Conversation-ID"><a href="#5-Conversation-ID" class="headerlink" title="5. Conversation ID"></a>5. Conversation ID</h2><p>  以下の手順で Conversation ID を取得し、ご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロットを開きます。  </li><li>対象のコパイロットとのチャットウィンドウに ‘/debug conversationid’ とご入力ください。  </li><li>得られた応答をテキストファイルとしてご提供ください。また、下画像と同様のスクリーンショットをご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_ConversationID.png">  </li></ul><p><a id='anchor-snapshot-zip'></a></p><h2 id="6-事象再現時のスナップショット-zip-ファイル"><a href="#6-事象再現時のスナップショット-zip-ファイル" class="headerlink" title="6. 事象再現時のスナップショット zip ファイル"></a>6. 事象再現時のスナップショット zip ファイル</h2><p>  以下の手順でスナップショット zip ファイルを取得し、ご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロットを開きます。  </li><li>対象のコパイロットとのチャットウィンドウ右上の三点リーダーより、「スナップショットの保存」を選択します。  </li><li>得られた zip ファイルをご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_snapshot.png">  </li></ul><p><a id='anchor-knowledge-enable-state'></a></p><h2 id="7-ナレッジの有効化状態"><a href="#7-ナレッジの有効化状態" class="headerlink" title="7. ナレッジの有効化状態"></a>7. ナレッジの有効化状態</h2><p>  以下の手順でスクリーンショット画像ファイルを取得し、ご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロットを開きます。  </li><li>対象のコパイロットの「ナレッジ」セクションで「有効」のトグルボタンがオンであるかを確認します。  </li><li>確認した際の、下画像と同様のスクリーンショットをご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_knowledge_enabling.png">  </li></ul><p><a id='anchor-raw-input-output'></a></p><h2 id="8-会話入出力"><a href="#8-会話入出力" class="headerlink" title="8. 会話入出力"></a>8. 会話入出力</h2><p>  以下の手順でスクリーンショット画像ファイルを取得し、ご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロットを開きます。  </li><li>対象のコパイロットとのチャットウィンドウでコパイロットと会話を行ってください。  </li><li>その会話画面について、下画像と同様のスクリーンショットをご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_conversation_inout.png"> </li></ul><p><a id='anchor-topics-screen'></a></p><h2 id="9-トピック画面"><a href="#9-トピック画面" class="headerlink" title="9. トピック画面"></a>9. トピック画面</h2><p>  以下の手順でスクリーンショット画像ファイルを取得し、ご提供ください。</p><ul><li>Copilot Studio ポータル&gt;（対象の環境選択）＞カスタムコパイロット＞対象のコパイロット＞トピックタブを開きます。  </li><li>事象に応じて対象のトピックの全体像や、対象のノードのプロパティなどを表示してください。  </li><li>その画面について、下画像のようにスクリーンショットを撮影してご提供ください。<br><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_topic_screen.png"> </li></ul><p><a id='anchor-conversation-transcript'></a></p><h2 id="10-会話トランスクリプションテーブルデータ"><a href="#10-会話トランスクリプションテーブルデータ" class="headerlink" title="10. 会話トランスクリプションテーブルデータ"></a>10. 会話トランスクリプションテーブルデータ</h2><p>  下記公開情報にてご案内している方法で、会話トランスクリプションテーブルのデータを取得してください。<br>  取得した zip ファイルをご提供ください。<br>  <a href="https://learn.microsoft.com/ja-jp/microsoft-copilot-studio/analytics-sessions-transcripts#export-conversation-transcripts">https://learn.microsoft.com/ja-jp/microsoft-copilot-studio/analytics-sessions-transcripts#export-conversation-transcripts</a></p><p><a id='anchor-about-networkhar'></a></p><h2 id="11-Web-ブラウザのネットワーク-トレース・コンソール-ログ"><a href="#11-Web-ブラウザのネットワーク-トレース・コンソール-ログ" class="headerlink" title="11. Web ブラウザのネットワーク トレース・コンソール ログ"></a>11. Web ブラウザのネットワーク トレース・コンソール ログ</h2><p>  カスタム Copilot 編集中、あるいは実行中に Copilot Studio サービスへ送信する HTTP リクエストや Copilot Studio サービスから受信する HTTP レスポンスの内容を確認することで通信上の問題を特定します。  </p><div class="alert is-important"><p class="alert-title">重要</p><p>事象発生の事前に取得開始し、事象発生後に採取を行う必要がございます。 </p></div><div class="alert is-info"><p class="alert-title">Note</p><p>事象の内容により、netsh trace コマンドやサードパーティ製のツール「Fiddler」によるネットワーク キャプチャの取得をお願いする場合があります。  </p></div><h3 id="ブラウザネットワークトレース"><a href="#ブラウザネットワークトレース" class="headerlink" title="ブラウザネットワークトレース"></a>ブラウザネットワークトレース</h3><p>  ご取得方法は以下公開情報をご参照ください。<br>  <a href="https://learn.microsoft.com/ja-jp/azure/azure-web-pubsub/howto-troubleshoot-network-trace#collect-a-network-trace-in-the-browser-browser-based-apps-only">ブラウザーでネットワーク トレースを収集する (ブラウザーベースのアプリのみ)</a></p><div class="alert is-important"><p class="alert-title">重要</p><p>ご取得の際は「ログの保持」「キャッシュを無効にする」にチェックを有効にしご取得ください。</p><p><img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_browser_trace.png"> 　</p></div><h3 id="コンソールログ"><a href="#コンソールログ" class="headerlink" title="コンソールログ"></a>コンソールログ</h3><p>  Console タブをクリックし、ログ領域を右クリックし <strong>「名前を付けて保存」</strong> にて保存いたします。<br>  <img src="/blog/copilotstudio/helpful-information-for-copilotstudio-sr/image_console_log.png">　　</p><hr><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>本手順は執筆時点でのユーザー インターフェイスを基に紹介しています。バージョンアップによって若干の UI の遷移など異なる場合があります。その場合は画面の指示に従って進めてください。  </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの竹内です。&lt;br&gt;本記事では Copilot Studio (旧称 Power Virtual Agents) 関連のお問い合わせの際に、調査のために必要となる情報について、その取得手順をご案内致します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="情報採取" scheme="https://jpdynamicscrm.github.io/blog/tags/%E6%83%85%E5%A0%B1%E6%8E%A1%E5%8F%96/"/>
    
    <category term="Copilot Studio" scheme="https://jpdynamicscrm.github.io/blog/tags/Copilot-Studio/"/>
    
    <category term="Power Virtual Agents" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Virtual-Agents/"/>
    
  </entry>
  
  <entry>
    <title>Power Platform における Copilot の無効化方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/pp-copilot-disable/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/pp-copilot-disable/</id>
    <published>2024-07-05T03:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.466Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの竹内です。<br>Microsoft の提供する生成 AI の Copilot は Power Platform の随所で使用することができます。<br>今回は、それらの機能の一部、あるいは全部を無効化、制御する方法についてご案内いたします。  </p><span id="more"></span><h1 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h1><ol><li><a href="#disable-in-power-platform">Power Platform 環境設定で環境レベルで Copilot 機能を無効化する</a></li><li><a href="#disable-in-power-automate">Power Automate における Copilot の無効化</a></li><li><a href="#disable-in-power-apps">Power Apps における Copilot の無効化</a></li><li><a href="#disable-connector-aibuilder">Copilot Connector や AI Builder の無効化</a></li></ol><p><a id='disable-in-power-platform'></a></p><h2 id="Power-Platform-環境設定で環境レベルで-Copilot-機能を無効化する"><a href="#Power-Platform-環境設定で環境レベルで-Copilot-機能を無効化する" class="headerlink" title="Power Platform 環境設定で環境レベルで Copilot 機能を無効化する"></a>Power Platform 環境設定で環境レベルで Copilot 機能を無効化する</h2><h3 id="Power-Platform-における-Copilot-機能無効化の概要"><a href="#Power-Platform-における-Copilot-機能無効化の概要" class="headerlink" title="Power Platform における Copilot 機能無効化の概要"></a>Power Platform における Copilot 機能無効化の概要</h3><p>データをホストしているリージョンと Copilot 出力を得ることができるリージョンが異なるため、リージョン間データ移動をオフにすると、リージョンを跨いだデータ移動を要する Copilot 機能を使用することができなくなります。 </p><p>なお、日本で Copilot を使用している場合、Power Platform または Dynamics 365 環境がホストされる地域は日本となり、Azure OpenAI Service および Bing 検索のデータをホストしているリージョンはアメリカとなります。<br>(2024年8月15日時点)  </p><p>最新情報については下記の公開情報をご参照ください。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/geographical-availability-copilot#regions-involved-with-copilots-and-generative-ai-features">コパイロットと生成 AI 機能をオンにする</a></p><!-- ![](/blog/powerplatform/pp-copilot-disable/img02.png)![](/blog/powerplatform/pp-copilot-disable/img01.png) --><p>設定方法や、Power Platform 各製品で無効化できる機能等、更なる詳細についてはこちらの公開文書（<a href="https://learn.microsoft.com/ja-jp/power-platform/admin/geographical-availability-copilot#enable-data-movement-across-regions">Turn on copilots and generative AI features - Power Platform | Microsoft Learn</a>）をご参照ください。<br>なお、PowerShellコマンド実行から管理する方法もございます。それに関しては、下記の公開文書をご参照ください。（<a href="https://learn.microsoft.com/ja-jp/powershell/module/microsoft.powerapps.administration.powershell/set-powerplatformgenerativeaisettings?view=pa-ps-latest">Set-PowerPlatformGenerativeAiSettings (Microsoft.PowerApps.Administration.PowerShell) | Microsoft Learn</a>）  </p><br><p>また、Copilot に関する機能は現在多くの変更がされておりますので、最新情報についてはこちらのリリースプランのページ（<a href="https://releaseplans.microsoft.com/ja-jp/availability-reports/?report=copilotproductreport">Release Planner Availability Reports  · Microsoft Release Planner</a>）も合わせてご参照ください。<br>こちらのページでは、Power Platform および Dynamics 各製品/地域/言語/リリースバージョンによる Copilot 利用可能機能についての最新情報がレポートとしてまとめられております。</p><br><h3 id="Power-Platform-における-Copilot-機能無効化の手順"><a href="#Power-Platform-における-Copilot-機能無効化の手順" class="headerlink" title="Power Platform における Copilot 機能無効化の手順"></a>Power Platform における Copilot 機能無効化の手順</h3><p>リージョン間のデータ移動をオフにすることで、Power Platform 全体で Copilot の一部機能を無効化することができます。<br>無効化できる機能の詳細については下記の公開文書をご参照ください。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/geographical-availability-copilot#copilots-and-generative-ai-features-that-are-available-when-you-enable-data-movement-across-regions">コパイロットと生成 AI 機能は、地域をまたいだデータ移動を可能にした場合に利用できます</a></p><p>具体的な手順は下記のとおりです。<br><a href="https://admin.powerplatform.microsoft.com/">Power Platform 管理センター (Power Platform Admin Center)</a> で特定の環境を選択し、環境の「生成AI機能」カードを編集します。<br>「リージョン間データ移動 (the Move data across regions)」のチェックボックスをオフにします。  </p><p><img src="/blog/powerplatform/pp-copilot-disable/img03.png"> </p><p><img src="/blog/powerplatform/pp-copilot-disable/img04.png"> </p><!--<div align="center"><img src="./pp-copilot-disable/img04.png" width="50%"></div>--><br><br><p>Power Platform 全体での Copilot の制御、無効化方法については以上となります。<br><strong>以降では、Power Automate と Power Apps それぞれについて、テナントレベル、環境レベルでの Copilot 機能の管理、無効化方法についてご案内いたします。</strong></p><p><a id='disable-in-power-automate'></a></p><h2 id="Power-Automate-における-Copilot-の無効化"><a href="#Power-Automate-における-Copilot-の無効化" class="headerlink" title="Power Automate における Copilot の無効化"></a>Power Automate における Copilot の無効化</h2><h3 id="Power-Automate-における-Copilot-機能の概要"><a href="#Power-Automate-における-Copilot-機能の概要" class="headerlink" title="Power Automate における Copilot 機能の概要"></a>Power Automate における Copilot 機能の概要</h3><p>Power Automate 中では、こちらの公開文書（<a href="https://learn.microsoft.com/ja-jp/power-automate/copilot-overview">Copilot in Power Automate - Power Automate | Microsoft Learn</a>）に表されているような、多くの Copilot 機能が提供されております。</p><h3 id="Power-Automate-における-Copilot-機能の無効化"><a href="#Power-Automate-における-Copilot-機能の無効化" class="headerlink" title="Power Automate における Copilot 機能の無効化"></a>Power Automate における Copilot 機能の無効化</h3><p>Copilotを無効化するには以下の手順の操作を実行してください。</p><ol><li>リージョンを確認する<br>リージョンの確認方法などについてはこちらの公開文書（<a href="https://learn.microsoft.com/ja-jp/power-platform/admin/regions-overview">Choose the region when setting up an environment - Power Platform | Microsoft Learn</a>）をご参照ください。<br>リージョンがGPUを保有しているか否か、具体的には以下のリストに含まれるかどうかにより以降の手順が異なります。</li></ol><ul><li>UK</li><li>Australia</li><li>US</li><li>India</li></ul><ol start="2"><li>無効化する<ul><li>リージョンが上記である場合：<ul><li>テナントレベル：管理者がサポートに連絡する</li><li>環境レベル：設定不可</li></ul></li><li>リージョンが上記でない場合：<ul><li>テナントレベル：管理者が Power Platform 管理センター等からリージョン間データ移行を無効化する</li><li>環境レベル：管理者が Power Platform 管理センター等からリージョン間データ移行を無効化する</li></ul></li></ul></li></ol><h3 id="Power-Automate-における-Copilot-機能の無効化の確認"><a href="#Power-Automate-における-Copilot-機能の無効化の確認" class="headerlink" title="Power Automate における Copilot 機能の無効化の確認"></a>Power Automate における Copilot 機能の無効化の確認</h3><p>こちらの公開文書（<a href="https://learn.microsoft.com/ja-jp/power-platform/admin/list-tenantsettings">プログラム可能性と拡張性 - Power Platform API - 2020-10-01 - テナント設定の一覧表示 (プレビュー) - Power Platform | Microsoft Learn</a>）に記載のある HTTP 要求をして、下記のプロパティ値を参照することにより、無効化されているかを確認することができます。</p><blockquote><p>powerPlatform.powerAutomate.disableCopilot<br>powerPlatform.powerAutomate.disableCopilotWithBing   </p></blockquote><p><a id='disable-in-power-apps'></a></p><h2 id="Power-Apps-における-Copilot-の無効化"><a href="#Power-Apps-における-Copilot-の無効化" class="headerlink" title="Power Apps における Copilot の無効化"></a>Power Apps における Copilot の無効化</h2><h3 id="Power-Apps-における-Copilot-機能の概要"><a href="#Power-Apps-における-Copilot-機能の概要" class="headerlink" title="Power Apps における Copilot 機能の概要"></a>Power Apps における Copilot 機能の概要</h3><p>キャンバスアプリやモデル駆動型アプリなど、それぞれの項目で利用可能な Copilot の情報がまとめられておりますので、こちらの公開文書をご参照ください。（<a href="https://learn.microsoft.com/ja-jp/power-apps/maker/canvas-apps/ai-overview">Copilot in Power Apps overview - Power Apps | Microsoft Learn</a>）</p><h3 id="Power-Apps-における-Copilot-features-の分類と無効化"><a href="#Power-Apps-における-Copilot-features-の分類と無効化" class="headerlink" title="Power Apps における Copilot features の分類と無効化"></a>Power Apps における Copilot features の分類と無効化</h3><p>Power Apps における Copilot 機能の無効化についてはこちらの公開文書も合わせてご参照ください（<br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/canvas-apps/ai-overview#enable-or-disable-copilot-preview-in-power-apps">Enable or disable Copilot (preview) in Power Apps</a> ）。</p><ul><li>Power Apps における Copilot の機能には <strong>General available (GA) features</strong> と <strong>Preview features</strong> がございます。</li><li>General available Copilot features のリリース情報などは<a href="https://learn.microsoft.com/ja-jp/dynamics365/release-plans/">こちらのリリースプラン</a>をご参照ください。</li><li>あるいは、各機能の公開文書ページにどちらの機能であるかの記載がございます（英語版でのみ表示される場合などございますので、必要に応じて設定を切り替える等していただくようお願いいたします。）。<br>例：<a href="https://learn.microsoft.com/en-us/power-apps/maker/canvas-apps/ai-conversations-create-app">Build apps through conversation - Power Apps | Microsoft Learn</a></li></ul><!--![](/blog/powerplatform/pp-copilot-disable/img07.png) ![](/blog/powerplatform/pp-copilot-disable/img08.png) --></br></br><p>無効化方法：</p><ul><li><p>General available Copilot features はデフォルトで有効化されており、お客様の操作によって無効化することはできません。</p><ul><li>これらを無効化するためには、テナント管理者がMSサポートに連絡する必要がございます。</li><li>なお、無効化ができるのはテナント単位のみであり、環境単位では無効化することができません。</li></ul></li><li><p>Copilot preview features はデフォルトで有効化されているが、これは管理者によって無効化することができます。</p><ul><li>テナント単位での設定と環境単位での設定方法がございます。</li><li>それぞれの具体的な設定方法についてはこちらの公開文書をご参照ください（<a href="https://learn.microsoft.com/ja-jp/power-apps/maker/canvas-apps/ai-overview#enable-or-disable-copilot-preview-in-power-apps">Enable or disable Copilot (preview) in Power Apps</a> ）。</li></ul><!--![](/blog/powerplatform/pp-copilot-disable/img18.png) --></li></ul><p><a id='disable-connector-aibuilder'></a></p><h2 id="Copilot-Connector-や-AI-Builder-の無効化"><a href="#Copilot-Connector-や-AI-Builder-の無効化" class="headerlink" title="Copilot Connector や AI Builder の無効化"></a>Copilot Connector や AI Builder の無効化</h2><p>Connector や AI Builder 等の機能は上記の設定では無効化できません。具体的には、Power Automate 中の Copilot のコネクタや Power Apps 中の「GPTでテキスト生成する」などの機能です。<br>これらは環境単位で Power Platform 管理センターから無効化することができます。<br>下記の設定画面から、無効化する機能のトグルボタンを「Off」にしてください。</p><p><img src="/blog/powerplatform/pp-copilot-disable/img05.png"> </p><p>また、Power Apps のキャンバス中に Copilot コンポーネントを埋め込む機能を無効化するのもここからできます。 </p><p><img src="/blog/powerplatform/pp-copilot-disable/img06.png"> </p><br><hr><h1 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h1><p>生成 AI である Copilot を Power Platform 内部で無効化する方法についてご紹介いたしました。</p><p>この記事が皆さまと Copilot との適切な付き合いの一助になりましたら幸いです。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの竹内です。&lt;br&gt;Microsoft の提供する生成 AI の Copilot は Power Platform の随所で使用することができます。&lt;br&gt;今回は、それらの機能の一部、あるいは全部を無効化、制御する方法についてご案内いたします。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Apps" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Apps/"/>
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Copilot" scheme="https://jpdynamicscrm.github.io/blog/tags/Copilot/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate クラウド フローを使用して、Microsoft Graph API を実行する方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/Graph-API/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/Graph-API/</id>
    <published>2024-06-24T05:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.286Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの清水、竹内です。<br>この記事では、Power Automate を使用して、Microsoft Graph API を実行する方法についてご紹介いたします。</p><span id="more"></span><ul><li><a href="#%E7%9B%AE%E6%AC%A1">目次</a></li><li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li><li><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9">必要なライセンス</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B-api-%E3%82%92%E6%B1%BA%E5%AE%9A%E3%81%99%E3%82%8B">使用する API を決定する</a></li><li><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E8%A8%B1%E5%8F%AF%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">必要なアクセス許可を確認する</a></li><li><a href="#http-with-microsoft-entra-id-preauthorized-%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%81%BE%E3%81%9F%E3%81%AF-http-with-microsoft-entra-id-%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">HTTP with Microsoft Entra ID (preauthorized) コネクタまたは HTTP with Microsoft Entra ID コネクタを使用する</a></li><li><a href="#http-%E3%82%B3%E3%83%8D%E3%82%AF%E3%82%BF%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">HTTP コネクタを使用する</a><ul><li><a href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">おわりに</a></li></ul></li></ul><p><a id='anchor-Intro'></a></p><h1 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h1><hr><p>Power Automate では、コネクタを使用して様々な操作を自動化することができますが、目的の操作がコネクタでは用意されていない場合、API を使用することでフローでの自動化が実現可能な場合があります。  </p><p>ここでは、Microsoft Graph API を使用して API リクエストを送信する 2 つの方法について、ご説明いたします。</p><p><a id='anchor-license-requirement'></a></p><h1 id="必要なライセンス"><a href="#必要なライセンス" class="headerlink" title="必要なライセンス"></a>必要なライセンス</h1><hr><p>今回作成するフローではプレミアム コネクタを使用するため、以下のいずれかのライセンスが必要です。  </p><ul><li>Power Automate Premium</li><li>Power Automate Process</li></ul><p><a id='anchor-decide-the-API'></a></p><h1 id="使用する-API-を決定する"><a href="#使用する-API-を決定する" class="headerlink" title="使用する API を決定する"></a>使用する API を決定する</h1><hr><p>まずは使用する API を決定します。<br><a href="https://learn.microsoft.com/ja-jp/graph/api/overview?view=graph-rest-1.0">Microsoft Graph API のリファレンス</a> から、目的に合った API を探してください。  </p><p>本記事では、よくあるお問い合わせの一つとして、「テキスト形式でメールを送信する」処理を例にとって進めていきたいと思います。<br>Power Automate の Office 365 Outlook コネクタ「メールを送信する (V2)」アクションでは、HTML 形式のメールしか送信できませんが、Graph API を使用することで、テキスト形式でメールを送信することも可能です。<br>今回使用する API はこちらです。<br><a href="https://learn.microsoft.com/ja-jp/graph/api/user-sendmail?view=graph-rest-1.0&tabs=http">メールを送信する - Microsoft Graph v1.0 | Microsoft Learn</a>  </p><p><a id='anchor-check-the-permission'></a></p><h1 id="必要なアクセス許可を確認する"><a href="#必要なアクセス許可を確認する" class="headerlink" title="必要なアクセス許可を確認する"></a>必要なアクセス許可を確認する</h1><hr><p>公開情報には、必ず API を呼び出すために必要なアクセス許可が記されているので、「アクセス許可」のセクションにて必要なアクセス許可が何かを確認してください。   </p><p>アクセス許可の選択方法などの詳細については、<a href="https://learn.microsoft.com/ja-jp/graph/permissions-reference">Microsoft Graph のアクセス許可のリファレンス | Microsoft Learn</a>をご参照ください。<br>今回使用する API では、以下のアクセス許可が必要です。  </p><p><img src="/blog/powerautomate/Graph-API/img01.png">  </p><p>ここで、アクセス許可には「委任」と「アプリケーション」の 2 種類があります。  </p><ul><li>委任されたアクセス許可<br>ユーザーの代わりにアクセスする際に使用いたします。<br>API を実際に実行するアプリケーションに対し、サインインしているユーザーとして動作するためのアクセス許可が委任されます。  </li><li>アプリケーションのアクセス許可<br>ユーザーなしでアクセスする際に使用いたします。<br>API を実行するアプリケーション自体にアクセス許可を付与します。  </li></ul><p>委任されたアクセス許可が使用できる場合は、ユーザーに変わって API を実行する HTTP with Entra ID (preauthorized) コネクタまたは HTTP with Entra ID コネクタが、<br>アプリケーションのアクセス許可が使用できる場合は、ユーザーなしで API を実行する HTTP コネクタが使用できます。  </p><p>それぞれのコネクタの使い方について説明します。  </p><p><a id='anchor-use-HTTP-with-Entra-ID-Connector'></a></p><h1 id="HTTP-with-Microsoft-Entra-ID-preauthorized-コネクタまたは-HTTP-with-Microsoft-Entra-ID-コネクタを使用する"><a href="#HTTP-with-Microsoft-Entra-ID-preauthorized-コネクタまたは-HTTP-with-Microsoft-Entra-ID-コネクタを使用する" class="headerlink" title="HTTP with Microsoft Entra ID (preauthorized) コネクタまたは HTTP with Microsoft Entra ID コネクタを使用する"></a>HTTP with Microsoft Entra ID (preauthorized) コネクタまたは HTTP with Microsoft Entra ID コネクタを使用する</h1><hr><p>HTTP with Microsoft Entra ID (preauthorized) コネクタまたは HTTP with Microsoft Entra ID コネクタでは、接続でサインインしたユーザーに代わって API を実行できます。  </p><div class="alert is-info"><p class="alert-title">Note</p><p>Microsoft Entra ID は Azure Active Directory の名称が変更されたものです。この変更の更なる詳細についてはこちらのドキュメント（<a href="https://learn.microsoft.com/ja-jp/entra/fundamentals/compare">Azure Active Directory は Microsoft Entra ID に名称変更されています - Microsoft Entra | Microsoft Learn</a>）をご参照ください。   </p><p>この変更に伴い、HTTP with Azure AD コネクタは HTTP with Microsoft Entra ID (preauthorized) コネクタに変更されました。</p><p>また、利用者のアクセス可能な範囲の制御を容易にするため、HTTP with Microsoft Entra ID コネクタが作成されました。</p><p>これらのコネクタについての更なる詳細については、こちらのドキュメント（<a href="https://learn.microsoft.com/ja-jp/connectors/webcontents/">Microsoft Entra ID 付きの HTTP (事前承認済み) - Connectors | Microsoft Learn</a>）（<a href="https://learn.microsoft.com/ja-jp/connectors/webcontentsv2/">Microsoft Entra ID を使用した HTTP - Connectors | Microsoft Learn</a>）をご参照ください。  </p></div><p>以降では HTTP with Microsoft Entra ID (preauthorized) コネクタを使用した例をご紹介いたします。   </p><ol><li><p>HTTP with Microsoft Entra ID (preauthorized) コネクタの「HTTP 要求を呼び出します」アクションを挿入します。</p></li><li><p>コネクタを初めて使用する場合、接続を作成します。<br>今回は Graph API を実行するため、「基本リソース URL」と「Microsoft Entra ID リソース URI (アプリケーション ID URI)」の両方に以下の URI を設定し、[サインイン] をクリックします。  </p><ul><li>URI: <a href="https://graph.microsoft.com/">https://graph.microsoft.com</a>  </li></ul><p><img src="/blog/powerautomate/Graph-API/img08.png">  </p><p>※ここでサインインしたユーザーのアクセス許可が委任され、API が実行されます。  </p></li><li><p><a href="https://learn.microsoft.com/ja-jp/graph/api/user-sendmail?view=graph-rest-1.0&tabs=http#http-request">API のリファレンス</a> を参考に、リクエストを作成します。  </p><p><img src="/blog/powerautomate/Graph-API/img10.png">  </p><p>&lt;補足&gt;<br>本文の指定方法は、各リソースのリファレンスを参考に変更してください。<br>今回は、Message リソースを使用するので、下記の公開情報を参照しました。<br><a href="https://learn.microsoft.com/ja-jp/graph/api/resources/message?view=graph-rest-1.0">メッセージ リソースの種類 - Microsoft Graph | Microsoft Learn</a>  </p><p>また、テキスト形式でメールを送信することが目的なので、 <code>message.body.contentType</code> を <code>Text</code> に設定します。  </p><p><img src="/blog/powerautomate/Graph-API/img09.png">  </p></li><li><p>フローを実行し、正常に実行されるか確認します。  </p></li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>必要なアクセス許可の種類によっては、HTTP with Microsoft Entra ID (preauthorized) コネクタでは API が実行できない場合があります。</p><p>HTTP with Microsoft Entra ID (preauthorized) コネクタで実行できる権限スコープの一覧は現時点では公開されておりませんが、フローを実行した際に権限エラーが発生する場合、HTTP with Microsoft Entra ID (preauthorized) コネクタでは実行できない可能性がございますので、HTTP with Microsoft Entra ID コネクタや HTTP コネクタでの実行をお試しください。  </p></div><p><a id='anchor-use-HTTP-connector'></a></p><h1 id="HTTP-コネクタを使用する"><a href="#HTTP-コネクタを使用する" class="headerlink" title="HTTP コネクタを使用する"></a>HTTP コネクタを使用する</h1><hr><p>HTTP コネクタでは、ユーザーのサインインなしに、Azure AD に登録したアプリから API を実行できます。  </p><ol><li>Azure AD にアプリを登録します。<br><a href="https://learn.microsoft.com/ja-jp/graph/auth-register-app-v2?context=graph/api/1.0&view=graph-rest-1.0">アプリを Azure AD v2.0 エンドポイントに登録する - Microsoft Graph | Microsoft Learn</a> にしたがって、 Azure AD にアプリを登録します。<br>また、登録したアプリの [API のアクセス許可] のページにて、「必要なアクセス許可を確認する」の手順で確認したアプリケーションのアクセス許可を追加し、管理者の同意を与えます。  <img src="/blog/powerautomate/Graph-API/img07.png">   </li><li>HTTP コネクタの「HTTP」アクションを挿入します。<br>2-1. <a href="https://learn.microsoft.com/ja-jp/graph/api/user-sendmail?view=graph-rest-1.0&tabs=http#http-request">API のリファレンス</a> を参考に、リクエストを作成します。<br>   HTTP コネクタを使用する場合、サインイン中のユーザーがいないため、<code>/me/sendMail</code>ではなく、<code>/users/&#123;id | userPrincipalName&#125;/sendMail</code> の要求方法を使用することに注意してください。     <img src="/blog/powerautomate/Graph-API/img06.png">  2-2. 認証を「Active Directory OAuth」に設定し、Azure AD に登録したアプリから取得した情報を設定します。  <ul><li>テナント: ディレクトリ (テナント) ID  </li><li>対象ユーザー: <a href="https://graph.microsoft.com/">https://graph.microsoft.com</a>  </li><li>クライアント ID: アプリケーション (クライアント) ID  </li><li>資格情報の種類: シークレット  </li><li>シークレット: [証明書とシークレット] より、新しいクライアントシークレットを発行し、発行された「値」  </li></ul><img src="/blog/powerautomate/Graph-API/img05.png">  </li><li>フローを実行し、正常に実行されるか確認します。  </li></ol><hr><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><p>Power Automate から Graph API を実行することで、様々な操作を自動化することができます。<br>ぜひ、色々なシーンで活用してみてください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの清水、竹内です。&lt;br&gt;この記事では、Power Automate を使用して、Microsoft Graph API を実行する方法についてご紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
    <category term="Graph API" scheme="https://jpdynamicscrm.github.io/blog/tags/Graph-API/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate のフローで無限トリガーループが起きる際の対処法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/</id>
    <published>2024-06-19T04:30:00.000Z</published>
    <updated>2024-11-26T00:36:26.354Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Power Platform サポートチームの トテ です。<br>今回は、 Power Automate のフローで無限トリガーループが起きる際の対処法についてご紹介します。</p><span id="more"></span><h2 id="1-無限トリガーループ事象"><a href="#1-無限トリガーループ事象" class="headerlink" title="1 . 無限トリガーループ事象"></a>1 . 無限トリガーループ事象</h2><p>Power Automate フローを実行した際、ないしはフローチェッカー上に、「このフローでの操作は、無限トリガーループを引き起こす可能性があります」という警告メッセージが表示されてしまうケースがあります。</p><p> <img src="/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/image-5.png" alt="alt text"></p><br>*無限トリガーループとは、ワークフローまたは自動化プロセスが無限にトリガーされる状態を指します。一度の動きを想定しているつもりが、フローをオフにしない限り、同じ動作が繰り返し起きてしまう状態です。<p><br><br></p><h2 id="2-Power-Automate-上で見られる実例"><a href="#2-Power-Automate-上で見られる実例" class="headerlink" title="2. Power Automate 上で見られる実例"></a>2. Power Automate 上で見られる実例</h2><p>以下のフローを作成していると仮定します。</p><p>① SharePoint コネクタの <strong>「アイテムが作成または変更されたとき」のトリガーを使用</strong> して SharePoint リストに登録<br><br>② Teams のチャネルに①の内容を投稿<br><br>③ ②のメッセージリンクを①のリンク列に追加</p><p><img src="/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/image-7.png" alt="alt text"></p><p>上記において、無限トリガーループの警告メッセージが表示される場合には、フロー内での更新に対してもフローが起動してしまうことで、再度 SharePoint のアイテムが更新される状況になっていることが考えられます。<br><br></p><h3 id="事象の原因"><a href="#事象の原因" class="headerlink" title="事象の原因"></a>事象の原因</h3><p>無限トリガーループの原因は、トリガーで指定しているリスト（テーブル）と同一のリスト（テーブル）を更新する処理が入っているためです。</p><br>今回の場合、 例として挙げているフローは、フロー①の段階において、SharePoint 上で作成または更新がなされた際にフローが起動する状態を指定しています。すると、フローが起動した際に無条件で SharePoint のアイテムを更新するという状態になってしまうため、無限ループの動作が発生してしまいます。<p><br><br></p><h2 id="3-対策"><a href="#3-対策" class="headerlink" title="3. 対策"></a>3. 対策</h2><p>無限トリガーループを回避するためには、トリガーで指定しているリストと同一のリストを更新するアクションを避けるか、適切な条件を設定して無限ループを防止する必要があります。<br><br></p><h3 id="アイテム作成時のみのトリガーで要件を満たせる場合（-SharePoint-リストアイテムの更新ではフローをトリガーする必要がない場合）"><a href="#アイテム作成時のみのトリガーで要件を満たせる場合（-SharePoint-リストアイテムの更新ではフローをトリガーする必要がない場合）" class="headerlink" title="アイテム作成時のみのトリガーで要件を満たせる場合（ SharePoint リストアイテムの更新ではフローをトリガーする必要がない場合）"></a>アイテム作成時のみのトリガーで要件を満たせる場合（ SharePoint リストアイテムの更新ではフローをトリガーする必要がない場合）</h3><p>下記の画像のように、①の段階で、<strong>「アイテムが作成または変更されたとき」</strong> のトリガーではなく、<strong>「項目が作成されたとき」</strong> という SharePoint のトリガーをご使用いただくと、当該の警告事象は起こらずにご利用いただけます。</p><p><img src="/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/image-4.png" alt="alt text"></p><p><br><br></p><h3 id="SharePoint-リストアイテムの作成、更新どちらでもトリガーを必要とする場合"><a href="#SharePoint-リストアイテムの作成、更新どちらでもトリガーを必要とする場合" class="headerlink" title="SharePoint リストアイテムの作成、更新どちらでもトリガーを必要とする場合"></a>SharePoint リストアイテムの作成、更新どちらでもトリガーを必要とする場合</h3><p>対策の手順は主に2つです。</p><p><strong>①〈 SharePoint コネクタのアクション : 「アイテムやファイルの変更を取得する(プロパティのみ)」の追加〉</strong></p><p>既存のフローに SharePoint コネクタ の「アイテムやファイルの変更を取得する(プロパティのみ)」のアクションを追加します。<br></p><p><img src="/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/image-6.png" alt="alt text"></p><p>パラメーターの内容における設定例</p><ul><li>サイトのアドレスおよびリストやライブラリの名前 : 「アイテムが作成または変更されたとき」のアクション同じ SharePoint サイト・リスト を指定します。</li><li>ID : 動的コンテンツにて、 「アイテムが作成または変更されたとき」の ID を指定します。</li><li>以降 : 動的コンテンツにて、 「アイテムが作成または変更されたとき」の「ウィンドウ開始のトークンのトリガー」を指定します。</li><li>期限 : 動的コンテンツにて、「アイテムが作成または変更されたとき」の「ウィンドウ終了のトークンのトリガー」を指定します。</li></ul><p><br><br></p><p><strong>②〈条件分岐の追加〉</strong>　<br><br>次に条件分岐を追加します。<br>リンクが更新された場合には Teams に投稿をせず、新規作成またはそれ以外の列が更新された場合には Teams に投稿をする、という条件を作成します。</p><p><img src="/blog/powerautomate/resolve-infinite-loops-in-SharePoint-updates/image-3.png" alt="alt text"></p><p>パラメーターの内容における設定例</p><ul><li>左辺： 「アイテムやファイルの変更を取得する(プロパティのみ)」の動的コンテンツより、SharePoint のリンクを格納している列に該当するものを取得し設定します。</li><li>中央：is equal to (に等しい)</li><li>右辺：false</li></ul><p>上記の条件の場合、Teams に投稿以降のアクションを条件分岐の True (はい)側に含めるようにご設定ください。</p><p>また、トリガー条件を追加することで、無限トリガーループを回避することもできます。例えば、今回の場合、Link列が設定されていない場合にのみフローを起動するような条件を追加することがこれにあてはまります。トリガー条件の設定の仕方詳細は次のブログを参考にしてください。<a href="https://jpdynamicscrm.github.io/blog/powerautomate/cloudflow-trigger-condition/">トリガー条件の設定の仕方詳細</a></p><br><p>参考URL<br><a href="https://learn.microsoft.com/en-us/connectors/sharepointonline/#get-changes-for-an-item-or-a-file-(properties-only)">https://learn.microsoft.com/en-us/connectors/sharepointonline/#get-changes-for-an-item-or-a-file-(properties-only)</a></p><br><div class="alert is-info"><p class="alert-title">Note</p><p>なお、フロー編集画面での警告は本変更実施後も表示される可能性はありますが、対策の実行により、無限ループは発生せず、フローの動作は問題ないことが確認できました。</p></div><p><br><br></p><h2 id="最後に"><a href="#最後に" class="headerlink" title="最後に"></a>最後に</h2><p>本記事がご利用の皆様のお役に立てましたら幸いです。ご不明な点などがございましたら、弊社サポート一同にてお待ち申し上げておりますので、ぜひお気軽にお問合せください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。Power Platform サポートチームの トテ です。&lt;br&gt;今回は、 Power Automate のフローで無限トリガーループが起きる際の対処法についてご紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
  </entry>
  
  <entry>
    <title>Copilot studio の生成 AI 機能を利用する際のデータのお取り扱いについて</title>
    <link href="https://jpdynamicscrm.github.io/blog/copilotstudio/copilot-studio-data-handling/"/>
    <id>https://jpdynamicscrm.github.io/blog/copilotstudio/copilot-studio-data-handling/</id>
    <published>2024-06-14T04:30:00.000Z</published>
    <updated>2024-11-26T00:36:26.238Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Power Platform サポートチームの トテ です。<br>今回はよく寄せられるお問い合わせのひとつ、 Copilot Studio の生成 AI 機能におけるデータのお取り扱いについてご案内いたします。</p><span id="more"></span><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><h3 id="お客様のデータ処理に関して"><a href="#お客様のデータ処理に関して" class="headerlink" title="お客様のデータ処理に関して"></a>お客様のデータ処理に関して</h3><p>Microsoft によるお客様のデータの処理は、お客様との合意に基づいてのみ行われるとともに、契約で合意した厳格なポリシーと手順に従って行われます。<br>Microsoft の広告主によってサポートされるサービスとの間でお客様のデータを共有することはなく、マーケティングリサーチや広告などの目的でマイニングすることもありません。</p><br><h3 id="Microsoft-のコンプライアンスとデータプライバシー"><a href="#Microsoft-のコンプライアンスとデータプライバシー" class="headerlink" title="Microsoft のコンプライアンスとデータプライバシー"></a>Microsoft のコンプライアンスとデータプライバシー</h3><p>Microsoft は、信頼、透過性、標準への準拠、および法規制の順守に取り組んでいます。 Microsoft のクラウド製品およびサービスは、顧客の厳格なセキュリティとプライバシーに関する需要に対応するよう、しっかりした基盤の上に構築されています。</p><p>個人のデータの収集と使用について規定している国、地域、業界固有の要件に組織が準拠するのを支援するために、Microsoft はクラウド サービス プロバイダーのコンプライアンス認証 (証明書と構成証明を含む) 包括的なセットを提供しています。</p><br><h3 id="Power-Platform-のデータの保護に関して"><a href="#Power-Platform-のデータの保護に関して" class="headerlink" title="Power Platform のデータの保護に関して"></a>Power Platform のデータの保護に関して</h3><p>ユーザーデバイスと Microsoft データセンター間で転送中のデータは、セキュリティ保護されます。 顧客と Microsoft データセンターの間で確立される接続は暗号化され、すべてのパブリックエンドポイントは業界標準の TLS を使用して保護されます。 TLS は、セキュリティが強化されたブラウザーからサーバーへの接続を確立し、デスクトップとデータセンターの間でデータの機密性と整合性を確保することができます。 また、顧客エンドポイントからサーバーへの API アクセスも同様に保護されます。</p><h3 id="オンプレミスデータゲートウェイのデータ保護"><a href="#オンプレミスデータゲートウェイのデータ保護" class="headerlink" title="オンプレミスデータゲートウェイのデータ保護"></a>オンプレミスデータゲートウェイのデータ保護</h3><p>オンプレミスのデータゲートウェイ経由で転送されたデータも暗号化されます。 ユーザーがアップロードするデータは通常 Azure Blob Storage に送信され、システム自体のすべてのメタデータおよびアーティファクトは Azure SQL Database および Azure Table storage に保存されます。</p><p>Dataverse データベースの環境は、SQL Server Transparent Data Encryption (TDE) を使用して、ディスクへの書き込み時にリアルタイムの暗号化を実行しています。</p><br><p>参考 URL</p><ul><li><a href="https://www.microsoft.com/ja-jp/trust-center/privacy">データ保護とプライバシー</a> </li><li><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/wp-compliance-data-privacy">コンプライアンスとデータプライバシー</a></li></ul><br><h2 id="Copilot-Studio-の生成-AI-機能"><a href="#Copilot-Studio-の生成-AI-機能" class="headerlink" title="Copilot Studio の生成 AI 機能"></a>Copilot Studio の生成 AI 機能</h2><p>Copilot Studio の生成 AI 機能 を使用すると、複雑な会話フローを作成したり、手作業で設定を行うことなく、Copilot を構築できます。これらの機能は、Azure OpenAI API Service と Bing Search を使用しており、米国およびその他のサポートされている地理的場所向けに作成された環境で利用できます。<br><br>Power Virtual Agents は、コード不要のガイド付きグラフィカルインターフェイスソリューションであり、チームのすべてのメンバーが、Teams プラットフォームと簡単に統合できる会話型のチャットボットの作成が可能です。</p><div class="alert is-info"><p class="alert-title">Note</p><p>Power Virtual Agents 機能は、生成 AI への投資と Microsoft Copilot 全体の統合の強化により、現在 Microsoft Copilot Studio の一部となっています。</p></div><br><p>参考 URL</p><ul><li><a href="https://www.microsoft.com/ja-jp/microsoft-copilot/microsoft-copilot-studio">Microsoft Copilot Studio</a></li><li><a href="https://www.microsoft.com/ja-jp/ai/responsible-ai">責任ある AI プラクティスの強化</a></li></ul><br><h2 id="生成-AI-の地理的な場所を越えたデータ移動"><a href="#生成-AI-の地理的な場所を越えたデータ移動" class="headerlink" title="生成 AI の地理的な場所を越えたデータ移動"></a>生成 AI の地理的な場所を越えたデータ移動</h2><p>米国外の地域から Copilot Studio 生成 AI 機能にアクセスすると、地域の境界を越えてデータが移動します。 このデータ移動は、Power Platform で有効化または無効化できます。 一度有効にすると、この機能が有効になっている間に行われたデータの移動は、同意を取り消しても元に戻すことはできません。</p><p>Bing を利用した機能は、<a href="https://go.microsoft.com/fwlink/?linkid=2178408">Microsoft サービス契約</a> および <a href="https://go.microsoft.com/fwlink/?LinkId=521839">Microsoft プライバシー ステートメント</a> によって個別に管理されます。</p><p>米国以外の環境で生成 AI 機能を有効または無効にできるのは、グローバル管理者と Power Platform 管理者のみです。</p><p><br><br></p><h2 id="Copilot-と生成-AI-機能に関わるリージョン"><a href="#Copilot-と生成-AI-機能に関わるリージョン" class="headerlink" title="Copilot と生成 AI 機能に関わるリージョン"></a>Copilot と生成 AI 機能に関わるリージョン</h2><p>Copilot と生成 AI 機能を使用すると、入力 (プロンプト) と出力 (結果) がリージョン外、生成 AI 機能がホストされている場所に移動する場合があります。<strong>お客様のデータは、Azure OpenAI サービス基盤モデルのトレーニング、再トレーニング、または改善には使用されません。</strong></p><div class="alert is-important"><p class="alert-title">重要</p><p>データは、あくまでデータ処理のため、一時的に別リージョンにデータが移りますが、それらが保存されることはありません。</p></div><br>次の表は、コパイロットと生成 AI 機能に関係する領域を示しています。<br><table><thead><tr><th>Power Platform または Dynamics 365 環境がホストされている地域</th><th>Azure OpenAI Service がホストされている地域</th><th>Bing 検索のデータが保存および処理される地域</th></tr></thead><tbody><tr><td>オーストラリア、インド、イギリス、アメリカ合衆国</td><td>お客様の Power Platform または Dynamics 365 環境の<br>地理的地域内</td><td>アメリカ合衆国</td></tr><tr><td>ヨーロッパ*</td><td>スウェーデンまたはスイス</td><td>アメリカ合衆国</td></tr><tr><td>フランス、ドイツ、ノルウェイ、スイス</td><td>スウェーデンまたはスイス</td><td>アメリカ合衆国</td></tr><tr><td>アジア、ブラジル、カナダ、<strong>日本</strong>、韓国、シンガポール、南アフリカ、アラブ首長国連邦</td><td>アメリカ合衆国</td><td>アメリカ合衆国</td></tr><tr><td>政府機関クラウド (GCC、GCC High)</td><td>米国 (商用クラウド)</td><td>アメリカ合衆国</td></tr></tbody></table><p>*Power Platform と Dynamics 365 の環境が EU データ境界でホストされている場合、同じ境界で Azure OpenAI エンドポイントを使用します。</p><br><p>参考 URL</p><ul><li><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/geographical-availability-copilot">コパイロットと生成 AI 機能をオンにする</a></li></ul><br><h2 id="Copilot-と生成-AI-機能の無効化について"><a href="#Copilot-と生成-AI-機能の無効化について" class="headerlink" title="Copilot と生成 AI 機能の無効化について"></a>Copilot と生成 AI 機能の無効化について</h2><p>Power Platform の管理センターで新たに環境を作る際は、環境を作成した段階で、デフォルト機能で生成 AI 機能がオンになっています。お客さま自身が有効化を明示的に実行しない場合においてもデフォルト機能として有効化されていることをご認識ください。この機能をオフにするには、下記の手順を実行します。</p><ol><li><a href="https://admin.powerplatform.microsoft.com/">Power Platform 管理センター </a>にサインインします。</li><li>左側のパネルで 環境 を選択します。</li><li>生成 AI 機能 カードで、編集 を選択します。（下記画像参照）</li></ol><p><img src="/blog/copilotstudio/copilot-studio-data-handling/image-4.png" alt="alt text"><br><br><br>すると、生成 AI 機能に関する要件が表示されます。（下記画像参照）</p><p><img src="/blog/copilotstudio/copilot-studio-data-handling/image-5.png" alt="alt text"></p><ol start="4"><li>各要件内容のチェックボックスを外し、保存をクリックしていただくことにより、生成 AI 機能を無効化することができます。<blockquote><p>リージョン間でデータを移動する チェックボックスがすでに選択されている場合にのみ、Bing 検索チェックボックスを選択できます。</p></blockquote></li></ol><p><br><br></p><h2 id="Dynamics-365-と-Power-Platform-の-Copilot-データ-セキュリティとプライバシーに関する-FAQ"><a href="#Dynamics-365-と-Power-Platform-の-Copilot-データ-セキュリティとプライバシーに関する-FAQ" class="headerlink" title="Dynamics 365 と Power Platform の Copilot データ セキュリティとプライバシーに関する FAQ"></a>Dynamics 365 と Power Platform の Copilot データ セキュリティとプライバシーに関する FAQ</h2><p>Copilot for Dynamics 365 と Power Platform の機能は、中核となる一連のセキュリティとプライバシーの取り組みおよび Microsoft <a href="https://www.microsoft.com/ai/principles-and-approach">責任ある AI の原則</a> に従います。 Dynamics 365 と Power Platform のデータは、業界をリードする包括的なコンプライアンス、セキュリティ、プライバシーの制御によって保護されます。</p><p>Copilot は  <a href="https://learn.microsoft.com/ja-jp/azure/cognitive-services/openai/overview">Microsoft Azure OpenAI Service</a> を基盤として構築されており、完全に Azure Cloud 内で実行されます。 Azure OpenAI は、地域可用性と、責任ある AI のコンテンツフィルターを提供します。<br> Copilot は <a href="https://learn.microsoft.com/ja-jp/azure/security/fundamentals/overview">Microsoft Azure のセキュリティ機能</a> をすべて備えた OpenAI モデルを使用します。 OpenAI は独立した組織です。<strong>顧客のデータは OpenAI と共有されません。</strong></p><div class="alert is-important"><p class="alert-title">重要</p><p>ひとつ前の項では、Copilot と生成 AI 機能の無効化の方法をご紹介させていただきました。<strong>ご説明させていただいた通り、デフォルト機能として生成 AI 機能は有効化されているため、お客さま自身が有効化を明示的に実行しない場合においてもその状態が保たれています。しかし、無効化に変更せずに、そのまま使用していただいた場合においても、顧客のデータは OpenAI と共有されることはございません。</strong></p></div><p><br><br><br>以降では、頻繁に寄せられる質問のうち、公式サイトで公開している FAQ を抜粋してご紹介させていただきます。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/faqs-copilot-data-security-privacy">Dynamics 365 と Power Platform の Copilot データ セキュリティとプライバシーに関する FAQ 全文</a></p><br><blockquote><p>Copilot を使用するとデータはどうなりますか？</p></blockquote><p>お客様のデータは、お客様がコントロールします。 許可を付与しない限り、Microsoft は顧客のデータをサードパーティと共有しません。 それに加えて、当社は顧客が同意しない場合は、Copilot やその AI 機能のトレーニングに顧客データを使用しません。 Copilot は既存のデータ アクセス許可とポリシーに準拠しており、ユーザーに対する応答は、そのユーザーが個人的にアクセスできるデータのみに基づいています。 データの制御方法と処理方法の詳細については、<a href="https://learn.microsoft.com/ja-jp/power-platform/faqs-copilot-data-security-privacy#copilot-in-dynamics-365-apps-and-power-platform">Dynamics 365 アプリと Power Platform の Copilot</a> の下にリストされた記事を参照してください。</p><p>Copilot は瞬時の処理により、サービスの不正使用や危険な使用を監視します。 当社は不正行為を監視する目的で、Copilot の入出力の保存や人間によるレビューを行いません。</p><p><br><br></p><blockquote><p>Copilot は、どのようにユーザーのデータを使用しますか？</p></blockquote><p>それぞれのサービスや機能は、ユーザーが提供したデータや Copilot で処理するように設定したデータに基づき、Copilot を使用します。</p><p>プロンプト (入力) と Copilot の応答 (出力や結果):</p><ul><li>他のお客様はご利用いただけません。</li><li>サードパーティの製品やサービス (OpenAI モデルなど) のトレーニングや改善には使用されません。</li><li>テナント管理者が当社とのデータ共有をオプトインしない限り、Microsoft AI モデルのトレーニングや改善には使用されません。*</li></ul><p><br><br></p><blockquote><p>Copilot は顧客データをどのように保護しますか？</p></blockquote><p>Copilot は Azure OpenAI Service を基盤としており、顧客に対する当社の既存のプライバシー、セキュリティ、規制の取り組みに準拠しています。<br><br></p><ul><li>セキュリティ、プライバシー、コンプライアンスに対する Microsoft の包括的なアプローチに基づいて構築されています。 Copilot は Dynamics 365 や Power Platform などの Microsoft サービスに統合されており、多要素認証やコンプライアンス境界など、セキュリティ、プライバシー、コンプライアンスのポリシーとプロセスを継承します。</li><li>組織データは複数の保護形式により保護されます。サービス側のテクノロジにより、保存や転送に際して組織コンテンツを暗号化し、堅牢なセキュリティを実現します。 接続はトランスポート層セキュリティ ( TLS ) で保護され、Dynamics 365、Power Platform、Azure OpenAI 間のデータ転送は Microsoft バックボーンネットワーク経由で行われるため、信頼性と安全性が両方とも保証されます。</li><li>テナントレベルと環境レベルの両方でデータを保護するように設計されています。テナント管理者が当社とのデータ共有をオプトインしていない限り、Microsoft AI モデルはテナントデータやプロンプトに基づいてトレーニングされず、そこから学習もしません。 環境内では、設定したアクセス許可に基づいてアクセスを制御できます。認証と承認のメカニズムにより、テナント間の共有モデルへの要求が分離されます。顧客データを保護するために当社が長年使用してきたのと同様のテクノロジにより、Copilot は顧客がアクセスできるデータのみを利用します。<br><br><br></li></ul><p>ここまでの質疑の回答内にありました「許可を付与しない限り」、「オプトインしない限り」の詳細につきましては以降の説明をご覧ください。</p><div class="alert is-important"><p class="alert-title">重要</p><p><strong>Power Poltform の Copilot Studio で生成 AI 機能を利用してもデータをトレーニングに利用されることはありません。ただし、米国テナントに限り、お客さま自らが設定を有効化することで共有をすることも可能です。下記を参照の通り、この設定は現在、日本エリアの場合には選定できません。よって、米国エリア以外は、お客さまのご意思をもってしてもデータを共有することはできず、これに照らして、データがトレーニングに利用されることはございません。</strong></p><p><img src="/blog/copilotstudio/copilot-studio-data-handling/image-3.png" alt="alt text"></p></div><br><p>米国テナントの場合にかぎるオプトインについての情報は次の通りです。米国テナントの環境で動作している且つ、お客さま自らがデータを共有したいと望む場合には下記を参照ください。</p><div class="alert is-info"><p class="alert-title">Note</p><p><strong>Copilot AI 機能のデータ共有とは何ですか？</strong></p><p></p><p></p><p>マイクロソフトは、Dynamics 365 Copilot および Power Platform Copilot の新しい AI を活用した Copilot 機能の品質を向上させ、より正確な結果を生成するよう常に取り組んでいます。 Copilot 機能を改善する重要な方法の 1 つは、Copilot 機能へのユーザーの入力、関連する出力、およびテレメトリをより深く理解することです。</p><p></p><p><em><strong>Power Platform 管理センターの Dynamics 365 Copilot および Power Platform Copilot AI 機能のデータ共有設定を有効にすると、</strong></em> マイクロソフトは、Dynamics 365 および Power Platform Copilot AI 機能、サービス、機械学習モデル、および関連システムを構築、改善、検証するために、ユーザーの自然言語入力、出力、および関連テレメトリを含め (ただし必ずしもこれらに限定されない)、顧客データを取得し、手動でレビューできるようになります。</p><p></p><p>当社は、Azure OpenAI Service 基盤モデルの学習に顧客データを使用しません。</p></div><br><div class="alert is-info"><p class="alert-title">Note</p><p><strong>顧客データへのアクセスが可能な範囲はどうなっていますか？</strong></p><p></p><p></p><p>Azure OpenAI Service 上に保存された不正使用を監視するためのデータは不正利用の監視を目的として、必要な場合に限り Microsoft 従業員しか確認でません。</p></div><br>上記、Note 参考URL<p><a href="https://learn.microsoft.com/ja-jp/power-platform/faqs-copilot-data-sharing">Dynamics 365 および Power Platform における Copilot AI 機能のオプションのデータ共有に関する FAQ</a></p><p><br><br></p><blockquote><p>Copilot の回答は常に事実に基づいていますか？</p></blockquote><p>他の生成 AI と同様に、Copilot の応答が 100% 事実である保証はありません。 事実に基づいて問い合わせに回答するように当社は改善を継続していますが、他のユーザーに送信する前に必ず自分の判断で出力を確認する必要があります。 Copilot は下書きと概要を提供して作業を効率化しますが、これは完全に自動です。 AI で生成したコンテンツは常に確認する必要があります。</p><p>当社のチームは<a href="https://learn.microsoft.com/ja-jp/dynamics365/faqs-copilot-data-security-privacy">責任ある AI の原則</a>に沿って、誤報や偽情報、コンテンツのブロック、データの安全性、有害なコンテンツや差別的なコンテンツを助長するなどの問題に積極的に取り組んでいます。</p><p><br><br></p><blockquote><p>Copilot は有害なコンテンツをどのようにブロックしますか？</p></blockquote><p>Azure OpenAI Service には、中核モデルと並列に動作するコンテンツフィルターシステムが含まれます。 このシステムは、有害なコンテンツの出力を特定し、ブロックするように設計された分類モデルにより、入力プロンプトと応答の両方を実行することで機能します。<a href="https://learn.microsoft.com/ja-jp/azure/ai-services/openai/concepts/content-filter?tabs=warning,python#harm-categories">Azure OpenAI コンテンツ フィルターの詳細情報</a></p><p><br><br></p><p>参考 URL</p><ul><li><a href="https://learn.microsoft.com/ja-jp/microsoft-copilot-studio/faqs-copilot">コパイロットに関するよくあるご質問</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-platform/faqs-copilot-data-sharing">Copilot データ共有に関するよくあるご質問</a></li><li><a href="https://learn.microsoft.com/ja-jp/dynamics365/faqs-copilot-data-security-privacy">Copilot のセキュリティとプライバシーに関するよくあるご質問</a></li></ul><p><br><br><br></p><br>FAQ では実際にご質問をいただくことが多い内容を中心に取り上げさせていただきました。<br>ここからは少し毛色を変えて、同様に最近問い合わせの増えている AI Builder のデータの取り扱いについてご紹介させていただきます。<br><h2 id="Power-Platform-における-AI-Builder-の位置づけ"><a href="#Power-Platform-における-AI-Builder-の位置づけ" class="headerlink" title="Power Platform における AI Builder の位置づけ"></a>Power Platform における AI Builder の位置づけ</h2><p><strong>AI Builder は、Microsoft Power Platform の一部です。</strong> AI Builder を使えば、Microsoft Power Platform 機能を使用した際に、ビジネスプロセスを最適化する AI モデルを作成することができます。例えば、ニーズに合わせて調整されたカスタムモデルを作成したり、業務シナリオで使用できる事前構築済みモデルの選択が可能です。 <br>AI Builder を使用すると、インテリジェンスを使用してプロセスを自動化し、Power Apps と Power Automate でデータからインサイトを収集することができます。<br><br></p><h2 id="AI-Builder-のテキスト生成モデル"><a href="#AI-Builder-のテキスト生成モデル" class="headerlink" title="AI Builder のテキスト生成モデル"></a>AI Builder のテキスト生成モデル</h2><h3 id="クラウドフローにおける-AI-Builder-のテキスト生成モデル"><a href="#クラウドフローにおける-AI-Builder-のテキスト生成モデル" class="headerlink" title="クラウドフローにおける AI Builder のテキスト生成モデル"></a>クラウドフローにおける AI Builder のテキスト生成モデル</h3><p>クラウドフローの Copilot は、Power Automate フローについて説明し、その過程で役立つガイダンスを提供するだけで、作成および編集ができるように設計されています。</p><p>AI Builder Power Automate Power Apps のテキスト生成モデルを使用すると、テキストの要約、回答の下書き、テキストの分類など、さまざまなシナリオで、フローや組み込みアプリで GPT モデルを直接使用できます。</p><br>AI Builder のテキスト生成モデルも、米国の環境が前提条件で、Azure OpenAI Service に搭載されています。そのため、格納場所は米国であり、使用用途や閲覧可能ユーザー、データ保護などもここまでの記載と同様の扱いになっています。<br><h3 id="AI-builder-のカスタムプロンプト"><a href="#AI-builder-のカスタムプロンプト" class="headerlink" title="AI builder のカスタムプロンプト"></a>AI builder のカスタムプロンプト</h3><p>AI Builder プロンプトは、Azure OpenAI Service を利用した GPT-3.5 Turbo モデルで実行されています。</p><blockquote><blockquote><p>Available in the United States, Australia, UK, and Europe<br>GPT Prompts and Prompt Builder will be generally available this week across the United States, Australia, the United Kingdom, and Europe. GPT Prompts currently leverage the GPT-3.5-Turbo model from Azure’s OpenAI Service, meaning your prompts and outputs: <br></p></blockquote></blockquote><div class="alert is-important"><p class="alert-title">重要</p><p>are NOT available to other customers.</p><p>are NOT available to OpenAI.</p><p>are NOT used to improve OpenAI models.</p><p>are NOT used to improve any Microsoft or 3rd party products or services.</p><p>are NOT used for automatically improving Azure OpenAI models for your use in your resource.</p></div><p>上記からも判断できる通り、テキストを作成の際のプロンプトの内容が、教師データとして用いられることはありません。</p><br><p>参考 URL</p><ul><li><a href="https://learn.microsoft.com/ja-jp/ai-builder/create-a-custom-prompt">AI Builder プロンプトについて</a></li><li><a href="https://powerautomate.microsoft.com/en-us/blog/ai-builder-gpt-prompts-are-generally-available/">AI Builder GPT Prompts are generally available</a><br><br><br><br></li></ul><p>免責事項<br><br>※本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。<br></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。Power Platform サポートチームの トテ です。&lt;br&gt;今回はよく寄せられるお問い合わせのひとつ、 Copilot Studio の生成 AI 機能におけるデータのお取り扱いについてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Virtual Agents" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Virtual-Agents/"/>
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Copilot studio" scheme="https://jpdynamicscrm.github.io/blog/tags/Copilot-studio/"/>
    
    <category term="Dynamics 365" scheme="https://jpdynamicscrm.github.io/blog/tags/Dynamics-365/"/>
    
    <category term="AI builder" scheme="https://jpdynamicscrm.github.io/blog/tags/AI-builder/"/>
    
  </entry>
  
  <entry>
    <title>Power Platform での仮想ネットワーク データ ゲートウェイについて</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/vnetgateway-support-status/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/vnetgateway-support-status/</id>
    <published>2024-01-19T15:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.486Z</updated>
    
    <content type="html"><![CDATA[<!-- ここに 導入部分 --><p>こんにちは、Power Platform サポートチームの藤田です。<br>今回は、最近お問い合わせの増えている仮想ネットワーク ゲートウェイについて、サポートされる機能をご紹介します。</p><p>※2024-04-12 追記：仮想ネットワーク ゲートウェイに代わりご利用いただける、Power Platform の仮想ネットワーク サポートがパブリック プレビューとなりました。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/vnet-support-overview">Power Platform 向け Virtual Network のサポートの概要 (プレビュー)</a><br><a href="https://learn.microsoft.com/en-in/power-platform/admin/vnet-support-overview#whats-the-difference-between-a-virtual-network-data-gateway-and-azure-virtual-network-support-for-power-platform">仮想ネットワーク データ ゲートウェイと Power Platform の Azure Virtual Network サポートの違いは何ですか?</a><br><a href="https://powerapps.microsoft.com/en-us/blog/announcing-public-preview-of-virtual-network-support-for-power-platform-dataverse-plug-ins-and-connectors/">Announcing public preview of virtual network support for Power Platform Dataverse plug-ins and Connectors</a></p><span id="more"></span><!-- ここに Read more 以降の文章 --><div class="alert is-important"><p class="alert-title">重要</p><p>本記事は弊社公式ドキュメントの公開情報を元に構成しておりますが、 本記事編集時点と実際の機能に相違がある場合がございます。</p><p>最新情報につきましては、参考情報として記載しておりますドキュメントをご確認ください</p></div><hr><h2 id="仮想ネットワーク-データ-ゲートウェイとは？"><a href="#仮想ネットワーク-データ-ゲートウェイとは？" class="headerlink" title="仮想ネットワーク データ ゲートウェイとは？"></a>仮想ネットワーク データ ゲートウェイとは？</h2><p>仮想ネットワーク データ ゲートウェイを使用すると、お使いの VNet 内の Azure サービスと Power Platform のサービスを安全に接続することが出来ます。<br>詳細は以下の公開情報をご参照ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/vnet/overview">仮想ネットワーク (VNet) データ ゲートウェイ (プレビュー) とは</a><br><a href="https://learn.microsoft.com/ja-jp/data-integration/vnet/data-gateway-architecture">仮想ネットワーク データ ゲートウェイのアーキテクチャ</a></p><p>※ 2024 年 1 月現在、上記の仮想ネットワーク データ ゲートウェイはプレビュー中の機能となっています。</p><h2 id="仮想ネットワーク-データ-ゲートウェイが使える機能"><a href="#仮想ネットワーク-データ-ゲートウェイが使える機能" class="headerlink" title="仮想ネットワーク データ ゲートウェイが使える機能"></a>仮想ネットワーク データ ゲートウェイが使える機能</h2><p>現在、仮想ネットワーク データ ゲートウェイが使える機能は以下の通りです。</p><ul><li>Fabric Dataflow Gen2</li><li>Power BI データセット</li><li>Power Platform データフロー</li><li>Power BI のページ分割されたレポート</li></ul><p><a href="https://learn.microsoft.com/ja-jp/data-integration/vnet/overview#limitations">仮想ネットワーク (VNet) データ ゲートウェイ (プレビュー) とは - 制限事項</a></p><h2 id="Power-Automate-のカスタム-コネクタと仮想ネットワーク-データ-ゲートウェイ"><a href="#Power-Automate-のカスタム-コネクタと仮想ネットワーク-データ-ゲートウェイ" class="headerlink" title="Power Automate のカスタム コネクタと仮想ネットワーク データ ゲートウェイ"></a>Power Automate のカスタム コネクタと仮想ネットワーク データ ゲートウェイ</h2><p>カスタム コネクタから仮想ネットワーク データ ゲートウェイを使用し、Azure OpenAI Service 等の Azure サービスに接続したいというお問い合わせが増えております。<br>この機能については、2022 年 4 月頃にプレビューとして登場し、2023 年 8 月末頃にプレビューを取り下げた機能です。現在はサポートされておらず、公開情報等もございません。<br>一方で、本記事執筆時点では機能自体は削除されていない状態であり、依然使用できる状態となっております。</p><p>プレビュー期間中に既にお試しいただいていた方や、使用してはいなかったが Microsoft 社外サイト等で機能を知った方等、現在も利用したい・試してみたいという状況はあるかと思います。<br>その場合は、<strong>本機能がプレビュー未満の状態であり、予告なく変更または削除される可能性がある点をご了承いただいた上で</strong>お使いいただくようお願いいたします。</p><h2 id="プレビュー機能とは？"><a href="#プレビュー機能とは？" class="headerlink" title="プレビュー機能とは？"></a>プレビュー機能とは？</h2><p>プレビュー機能には、いくつかの免責事項があります。※</p><ul><li>個別の <a href="https://dynamics.microsoft.com/ja-jp/legaldocs/supp-dynamics365-preview/">追加使用条件</a> に依存しています。</li><li>運用環境での使用を目的としていません。</li><li>Microsoft サポートによる運用環境での使用はサポートされていません。 ただし、Microsoft サポートは、プレビュー機能に関するフィードバックをお伺いし、場合によってはベスト エフォート サポートを提供する場合があります。</li><li>機能が制限される可能性があります。</li><li>地域によっては利用できない場合があります。</li></ul><p>上記の通り、プレビュー機能のご利用で問題が発生し、お問い合わせいただいた場合、プレビュー機能を使用中止いただくようお願いすることとなってしまう場合がございます。<br>ビジネス クリティカルなシナリオでは、プレビュー機能のご利用を避けていただくようお願いいたします。</p><p>※ <a href="https://learn.microsoft.com/ja-jp/dynamics365/sales/sales-previews-in-trial">プレビュー機能とは</a> より引用</p>]]></content>
    
    
    <summary type="html">&lt;!-- ここに 導入部分 --&gt;
&lt;p&gt;こんにちは、Power Platform サポートチームの藤田です。&lt;br&gt;今回は、最近お問い合わせの増えている仮想ネットワーク ゲートウェイについて、サポートされる機能をご紹介します。&lt;/p&gt;
&lt;p&gt;※2024-04-12 追記：仮想ネットワーク ゲートウェイに代わりご利用いただける、Power Platform の仮想ネットワーク サポートがパブリック プレビューとなりました。&lt;br&gt;&lt;a href=&quot;https://learn.microsoft.com/ja-jp/power-platform/admin/vnet-support-overview&quot;&gt;Power Platform 向け Virtual Network のサポートの概要 (プレビュー)&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://learn.microsoft.com/en-in/power-platform/admin/vnet-support-overview#whats-the-difference-between-a-virtual-network-data-gateway-and-azure-virtual-network-support-for-power-platform&quot;&gt;仮想ネットワーク データ ゲートウェイと Power Platform の Azure Virtual Network サポートの違いは何ですか?&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://powerapps.microsoft.com/en-us/blog/announcing-public-preview-of-virtual-network-support-for-power-platform-dataverse-plug-ins-and-connectors/&quot;&gt;Announcing public preview of virtual network support for Power Platform Dataverse plug-ins and Connectors&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="PowerPlatform" scheme="https://jpdynamicscrm.github.io/blog/tags/PowerPlatform/"/>
    
    <category term="VNetGateway" scheme="https://jpdynamicscrm.github.io/blog/tags/VNetGateway/"/>
    
  </entry>
  
  <entry>
    <title>クラウド フローで Microsoft Purview の監査ログを取得する方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/work-with-audit-log/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/work-with-audit-log/</id>
    <published>2023-11-13T07:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.366Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの清水です。<br>今回は、よくお問い合わせをいただく題材の一つとして、クラウド フローを使用して、Microsoft Purview の監査ログを取得する方法について紹介します。  </p><p>2023 年 10 月現時点では、監査ログを取得できるようなコネクタ・アクションは存在しないため、監査ログを取得するには、<a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/">Office 365 Management API</a> を使用する必要があります。<br>少し複雑なフローになりますが、最後までお付き合いいただければと思います。  </p><h2 id="必要なライセンスについて"><a href="#必要なライセンスについて" class="headerlink" title="必要なライセンスについて"></a>必要なライセンスについて</h2><p>プレミアム コネクタを使用するフローとなりますので、有償ライセンスが必要です。<br>以下のいずれかのライセンス/環境があれば、フローを実行可能です。  </p><ul><li>Power Automate Premium (※ 旧名: Power Automate per user with attended RPA)  </li><li>Power Automate Process</li><li>Power Automate per user (※ 2023/8/1~ レガシー)</li><li>Power Automate per flow (※ 2023/8/1~ レガシー)</li><li>従量課金制環境  </li></ul><h2 id="必要な権限について"><a href="#必要な権限について" class="headerlink" title="必要な権限について"></a>必要な権限について</h2><p>Office 365 Management API を使用するために必要なアクセス許可を付与する際、テナント管理者の同意が必要となります。<br>同意の付与には、グローバル管理者の権限が必要です。</p><h2 id="手順の概要"><a href="#手順の概要" class="headerlink" title="手順の概要"></a>手順の概要</h2><p>フローは大きく 7 つのステップで構成されます。  </p><ol start="0"><li>事前準備<br>Office 365 Management API を使用する準備として、Azure AD へのアプリケーションの登録およびアクセス許可の付与などを行います。<br>ここでは Power Automate は使用いたしません。  </li><li>事前準備で取得したパラメータを変数に格納  </li><li>Office 365 Management API で既存のサブスクリプションの確認<br>監査ログを API から取得するために、まずはサブスクリプションを開始する必要があります。<br>既に開始済みで有効な状態であれば、サブスクリプションを新しく開始する必要はないので、本ステップでは、既存のサブスクリプションがあるかどうかを確認します。  </li><li>(既存のサブスクリプションが存在しない場合) Office 365 Management API でサブスクリプションの開始<br>手順 1 で既存のサブスクリプションの一覧を取得したので、目的のサブスクリプションがないか、無効な状態の場合には、サブスクリプションを開始します。  </li><li>Office 365 Management API でコンテンツ リストの取得<br>コンテンツ (監査ログ) 自体を取得するために、まずは取得可能なコンテンツ リストを取得する必要があります。<br>このコンテンツ リストで得られた値を使用して、後続のステップでコンテンツ自体を取得していきます。</li><li>Office 365 Management API でコンテンツの取得<br>コンテンツを取得し、変数に格納していきます。  </li><li>CSVファイルの作成・保存<br>CSV ファイルを作成し、クラウド ストレージに保存したら完了です。  </li></ol><p>それでは、詳細な手順について見ていきましょう。  </p><h2 id="0-事前準備"><a href="#0-事前準備" class="headerlink" title="0. 事前準備"></a>0. 事前準備</h2><p><strong>0-1．アプリの登録</strong><br>Office 365 Management API の利用を開始するため、<a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/get-started-with-office-365-management-apis#register-your-application-in-azure-ad">Office 365 Management API の使用を開始する</a> の下記の箇所を実施してください。  </p><ul><li><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/get-started-with-office-365-management-apis#use-the-azure-portal-to-register-your-application-in-azure-ad">Azure portal を使用してアプリケーションを Azure AD で登録する</a><br>※リダイレクト URI は空のまま作成します。  </li><li><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/get-started-with-office-365-management-apis#generate-a-new-key-for-your-application">アプリケーションの新しいキーを生成する</a> </li><li><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/get-started-with-office-365-management-apis#specify-the-permissions-your-app-requires-to-access-the-office-365-management-apis">アプリが Office 365 Management APIにアクセスするために必要な許可を指定します。</a><br>※今回は HTTP コネクタを使用するため、手順 3 では「b. アプリケーションのアクセス許可」を選択してください。</li></ul><p>手順の完了後、フローで使用する以下 3 つの値を控えておきます。  </p><ul><li>アプリケーション (クライアント) ID  </li><li>ディレクトリ (テナント) ID<br><img src="/blog/powerautomate/work-with-audit-log/enrolled-app-property.png" alt="アプリの概要"></li><li>作成したシークレットの値<br><img src="/blog/powerautomate/work-with-audit-log/secret.png" alt="シークレットの値"></li></ul><p><strong>0-2．Office 365 Management API のエンドポイントの確認</strong><br>Office 365 Management API のエンドポイントを以下から確認します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#activity-api-operations">アクティビティ API の操作</a>  </p><p>今回使用する検証用のテナントでは、パブリック クラウドを使用しているため、”Enterprise プラン” の URL を使用します。  </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://manage.office.com/api/v1.0/&#123;tenant_id&#125;/activity/feed/&#123;operation&#125;</span><br></pre></td></tr></table></figure><ul><li><code>&#123;tenant_id&#125;</code> 部分には、ご使用のテナント ID を指定します。  </li><li><code>&#123;operation&#125;</code> 部分には、これから使用する API の “パス” を指定します。  </li></ul><p><strong>0-3．Office 365 Management API のコンテンツタイプの確認</strong><br>このフローで取得したい監査ログの種類を以下から確認します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#working-with-the-office-365-management-activity-api">Office 365 管理アクティビティ API の操作</a>  </p><p>本ブログでは、<code>Audit.AzureActiveDirectory</code> を対象とすることとします。  </p><h2 id="1-事前準備で取得したパラメータをフローの変数に格納"><a href="#1-事前準備で取得したパラメータをフローの変数に格納" class="headerlink" title="1. 事前準備で取得したパラメータをフローの変数に格納"></a>1. 事前準備で取得したパラメータをフローの変数に格納</h2><p>ここからフローの作成に入っていきます。  </p><p><strong>1-1．トリガーを決定し、フローを一から作成</strong><br>今回は日次でログを取得することにしたいので、繰り返しトリガーを選択します。<br>トリガーの設定は要件に合わせてご設定ください。  </p><p><img src="/blog/powerautomate/work-with-audit-log/trigger.png" alt="triigger">  </p><p><strong>1-2．事前準備で取得した 5 つの値を変数に格納</strong><br>変数コネクタ「変数を初期化する」アクションを 5 つフローに追加し、それぞれ以下のように設定します。</p><ul><li>テナント ID</li></ul><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-tenantid.png" alt="変数を初期化-テナント ID">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>tenantID</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td>0-1 で取得した「ディレクトリ (テナント) ID」</td></tr></tbody></table><ul><li>クライアント ID  </li></ul><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-clientid.png" alt="変数を初期化-クライアント ID">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>clientID</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td>0-1 で取得した「アプリケーション (クライアント) ID」</td></tr></tbody></table><ul><li>シークレット</li></ul><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-secret.png" alt="変数を初期化-シークレット">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>secret</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td>0-1 で取得した「シークレット」</td></tr></tbody></table><ul><li>エンドポイント</li></ul><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-endpoint.png" alt="変数を初期化-エンドポイント">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>endpoint</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td>0-2 で取得したエンドポイントの “/{operation}” の直前まで<br>例: <a href="https://manage.office.com/api/v1.0/@%7Bvariables(&#39;tenantID&#39;)}/activity/feed">https://manage.office.com/api/v1.0/@{variables(&#39;tenantID&#39;)}/activity/feed</a></td></tr></tbody></table><ul><li>コンテンツタイプ</li></ul><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-contenttype.png" alt="変数を初期化-コンテンツタイプ">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentType</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td>0-3 で取得した「コンテンツ タイプ」<br>例: <code>Audit.AzureActiveDirectory</code></td></tr></tbody></table><h2 id="2．Office-365-Management-API-で既存のサブスクリプションの確認"><a href="#2．Office-365-Management-API-で既存のサブスクリプションの確認" class="headerlink" title="2．Office 365 Management API で既存のサブスクリプションの確認"></a>2．Office 365 Management API で既存のサブスクリプションの確認</h2><p>監査ログを API から取得するために、まずはサブスクリプションを開始する必要があります。<br>既に開始済みで有効な状態であれば、サブスクリプションを新しく開始する必要はないので、本ステップでは、既存のサブスクリプションがあるかどうかを確認します。  </p><p>ここでは、以下の API を使用します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#list-current-subscriptions">現在のサブスクリプションのリストの作成</a>  </p><p><strong>2-1．サブスクリプション リストの作成</strong><br>HTTP コネクタ「HTTP」アクションをフローに追加し、API のリファレンスに従って、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-list-subscriptions.png" alt="HTTPアクション-サブスクリプションリストを確認">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>方法</td><td>GET</td></tr><tr><td>URI</td><td><code>@&#123;variables(&#39;endpoint&#39;)&#125;</code>/subscriptions/list</td></tr><tr><td>認証</td><td>Active Directory OAuth</td></tr><tr><td>テナント</td><td>動的なコンテンツ &gt; <code>tenantID</code></td></tr><tr><td>対象ユーザー</td><td><code>https://manage.office.com/</code></td></tr><tr><td>クライアント ID</td><td>動的なコンテンツ &gt; <code>clientID</code></td></tr><tr><td>資格情報の種類</td><td>シークレット</td></tr><tr><td>シークレット</td><td>動的なコンテンツ &gt; <code>secret</code></td></tr></tbody></table><p>まずはここまででフローを実行してみましょう。<br>フローの実行が成功し、下図赤枠のような出力が得られました。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-list-subscriptions-result.png" alt="HTTPアクション-サブスクリプションリストの確認結果">  </p><p>詳しく見てみると、以下のような JSON が出力されています。  </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;contentType&quot;</span>: <span class="string">&quot;Audit.General&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enabled&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webhook&quot;</span>: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;contentType&quot;</span>: <span class="string">&quot;Audit.SharePoint&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enabled&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;webhook&quot;</span>: <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>Audit.General</code> と <code>Audit.SharePoint</code> のサブスクリプションがリストされていて、どちらも status が <code>enabled</code> になっていますね。<br><code>Audit.General</code> と <code>Audit.SharePoint</code> のコンテンツタイプのサブスクリプションは有効のようですが、今回取得したい <code>Audit.AzureActiveDirectory</code> については開始されていないようなので、次のステップで追加していきます。  </p><h2 id="3-既存のサブスクリプションが存在しない場合-Office-365-Management-API-でサブスクリプションの開始"><a href="#3-既存のサブスクリプションが存在しない場合-Office-365-Management-API-でサブスクリプションの開始" class="headerlink" title="3. (既存のサブスクリプションが存在しない場合) Office 365 Management API でサブスクリプションの開始"></a>3. (既存のサブスクリプションが存在しない場合) Office 365 Management API でサブスクリプションの開始</h2><p>まずは、既存のサブスクリプションが存在するかどうかを「条件」アクションでチェックします。  </p><p>条件の結果が「はい」の場合、既存の有効なサブスクリプションが存在しないので、Office 365 Management API を使用して、新たにサブスクリプションを開始します。<br>ここでは、以下の API を使用します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#start-a-subscription">サブスクリプションの開始</a>  </p><p><strong>3-1. 既存の有効なサブスクリプションを抽出</strong><br>データ操作コネクタ「アレイのフィルター処理」アクションを追加し、以下のように設定します。<br>以下のアクションでは、<code>HTTP | サブスクリプションリストを確認</code> アクションの出力から、status が <code>enabled</code> かつ contentType が <code>contentType 変数の値</code> に等しいオブジェクトのみを抽出します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/filter-array.png" alt="アレイのフィルター処理">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>差出人</td><td>動的なコンテンツ &gt; <code>HTTP | サブスクリプションリストを確認</code> - <code>本文</code></td></tr><tr><td>条件</td><td>[詳細設定モードで編集] をクリック &gt; 下式を入力 <br> <code>@and(equals(item()?[&#39;status&#39;], &#39;enabled&#39;), equals(item()?[&#39;contentType&#39;], variables(&#39;contentType&#39;)))</code></td></tr></tbody></table><p><strong>3-2．既存の有効なサブスクリプションが存在するかどうかを判定</strong><br>コントロールコネクタ「条件」アクションを追加し、以下のように設定します。<br>以下のアクションでは、<code>アレイのフィルター処理</code> アクションの出力が空かどうかを判定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/condition.png" alt="条件">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>左辺</td><td>式 &gt; <code>empty(body(&#39;アレイのフィルター処理&#39;))</code></td></tr><tr><td>条件</td><td>次の値に等しい</td></tr><tr><td>右辺</td><td>式 &gt; <code>true</code></td></tr></tbody></table><p><strong>3-3．サブスクリプションの開始</strong><br><code>はいの場合</code> 内にHTTP コネクタ「HTTP」アクションをフローに追加し、API のリファレンスに従って、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-start-subscription.png" alt="HTTPアクション-サブスクリプションを開始">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>方法</td><td>POST</td></tr><tr><td>URI</td><td><code>@&#123;variables(&#39;endpoint&#39;)&#125;</code>/subscriptions/start?contentType=<code>@&#123;variables(&#39;contentType&#39;)&#125;</code></td></tr><tr><td>ヘッダー</td><td><code>Content-Type</code>: <code>application/json; utf-8</code></td></tr><tr><td>認証</td><td>Active Directory OAuth</td></tr><tr><td>テナント</td><td>動的なコンテンツ &gt; <code>tenantID</code></td></tr><tr><td>対象ユーザー</td><td><code>https://manage.office.com/</code></td></tr><tr><td>クライアント ID</td><td>動的なコンテンツ &gt; <code>clientID</code></td></tr><tr><td>資格情報の種類</td><td>シークレット</td></tr><tr><td>シークレット</td><td>動的なコンテンツ &gt; <code>secret</code></td></tr></tbody></table><h2 id="4-Office-365-Management-API-でコンテンツリストの取得"><a href="#4-Office-365-Management-API-でコンテンツリストの取得" class="headerlink" title="4. Office 365 Management API でコンテンツリストの取得"></a>4. Office 365 Management API でコンテンツリストの取得</h2><p>無事サブスクリプションが開始できたので、続いて、目的のコンテンツ タイプで現在取得できるコンテンツ一覧を取得します。<br>ここでは、以下の API を使用します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#list-available-content">利用可能なコンテンツのリストの作成</a>  </p><p>API のリファレンスを読むと、取得したいコンテンツの時間範囲をパラメータとして指定できるようですが、時間範囲は 24 時間以内とするよう推奨されています。<br>そのため、本フローでは、フロー実行日の前日 24 時間分のコンテンツを取得するよう設定します。  </p><p>また、本 API では、改ページが発生する可能性があるようです。<br>大量の監査ログが存在する場合に、改ページの処理を行わないと、全てのデータが取得できない恐れがあるため、Do until アクションを使用して、改ページへの対応も行っていきます。</p><p><strong>4-1．startTime を前日の 00:00 JST (UTC: 15:00) に指定</strong><br>変数コネクタ「変数を初期化する」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-startTime.png" alt="変数を初期化-startTime">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>startTime</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td><code>@&#123;addDays(convertFromUtc(utcNow(), &#39;Tokyo Standard Time&#39;), -2, &#39;yyyy-MM-dd&#39;)&#125;</code>T15:00:00Z</td></tr></tbody></table><p><strong>4-2．endTime を前日の 23：59 JST (UTC: 14:59) に指定</strong><br>変数コネクタ - 変数を初期化するアクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-endTime.png" alt="変数を初期化-endTime">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>endTime</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td><code>@&#123;addDays(convertFromUtc(utcNow(), &#39;Tokyo Standard Time&#39;), -1, &#39;yyyy-MM-dd&#39;)&#125;</code>T14:59:59Z</td></tr></tbody></table><p><strong>4-3．配列変数を 2 つ用意</strong><br>監査ログの取得結果を格納するための変数を事前に用意します。<br>変数コネクタ「変数を初期化する」アクションを 2 つフローに追加し、それぞれ以下のように設定します。   </p><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-contents.png" alt="変数を初期化-contents">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contents</td></tr><tr><td>種類</td><td>アレイ</td></tr><tr><td>値</td><td>空欄のまま</td></tr></tbody></table><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-contentsAll.png" alt="変数を初期化-contentsAll">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentsAll</td></tr><tr><td>種類</td><td>アレイ</td></tr><tr><td>値</td><td>空欄のまま</td></tr></tbody></table><p><strong>4-4．改ページに対応するための変数と繰り返しアクションを用意</strong><br>変数コネクタ「変数を初期化する」アクションを追加し、以下のように設定します。<br>ここでは、コンテンツリストを取得するための URI を変数に格納します。リファレンスに従って設定してください。  </p><p><img src="/blog/powerautomate/work-with-audit-log/init-variable-contentslisturi.png" alt="変数を初期化-contentsListUri">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentsListUri</td></tr><tr><td>種類</td><td>文字列</td></tr><tr><td>値</td><td><code>@&#123;variables(&#39;endpoint&#39;)&#125;/subscriptions/content?contentType=@&#123;variables(&#39;contentType&#39;)&#125;&amp;startTime=@&#123;variables(&#39;startTime&#39;)&#125;&amp;endTime=@&#123;variables(&#39;endTime&#39;)&#125;</code></td></tr></tbody></table><p>コントロールコネクタ「Do until」アクションを追加し、以下のように設定します。</p><p><img src="/blog/powerautomate/work-with-audit-log/dountil.png" alt="Do until">    </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>左辺</td><td>動的なコンテンツ &gt; <code>contentListUri</code></td></tr><tr><td>条件</td><td>次のもので始まらない</td></tr><tr><td>右辺</td><td><a href="https://manage.office.com/">https://manage.office.com/</a></td></tr></tbody></table><p><strong>4-5．コンテンツリストの取得</strong><br>Do until 内で HTTP コネクタ「HTTP」アクションをフローに追加し、API のリファレンスに従って、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-content.png" alt="HTTPアクション-コンテンツリストの取得">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>方法</td><td>GET</td></tr><tr><td>URI</td><td>動的なコンテンツ &gt; <code>contentListUri</code></td></tr><tr><td>認証</td><td>Active Directory OAuth</td></tr><tr><td>テナント</td><td>動的なコンテンツ &gt; <code>tenantID</code></td></tr><tr><td>対象ユーザー</td><td><code>https://manage.office.com/</code></td></tr><tr><td>クライアント ID</td><td>動的なコンテンツ &gt; <code>clientID</code></td></tr><tr><td>資格情報の種類</td><td>シークレット</td></tr><tr><td>シークレット</td><td>動的なコンテンツ &gt; <code>secret</code></td></tr></tbody></table><p>さて、ここまでで一度フローを実行してみましょう。  </p><p>フローが正常に実行され、<code>HTTP | コンテンツリストの作成</code> アクションまで正常に完了しました。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-content-result.png" alt="コンテンツリストの作成結果">  </p><p>さらに「HTTP | コンテンツリストの作成」アクションの本文を詳しく見てみると、以下のようなデータが取得されています。  </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;contentUri&quot;</span>: <span class="string">&quot;https://manage.office.com/api/v1.0/&#123;tenantID&#125;/activity/feed/audit/20231016001037495037203$20231016005646231021586$audit_azureactivedirectory$Audit_AzureActiveDirectory$jpn0016&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentId&quot;</span>: <span class="string">&quot;20231016001037495037203$20231016005646231021586$audit_azureactivedirectory$Audit_AzureActiveDirectory$jpn0016&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentType&quot;</span>: <span class="string">&quot;Audit.AzureActiveDirectory&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentCreated&quot;</span>: <span class="string">&quot;2023-10-16T00:56:46.231Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentExpiration&quot;</span>: <span class="string">&quot;2023-10-23T00:10:37.495Z&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;contentUri&quot;</span>: <span class="string">&quot;https://manage.office.com/api/v1.0/&#123;tenantID&#125;/activity/feed/audit/20231016010437450010083$20231016044336610021746$audit_azureactivedirectory$Audit_AzureActiveDirectory$jpn0016&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentId&quot;</span>: <span class="string">&quot;20231016010437450010083$20231016044336610021746$audit_azureactivedirectory$Audit_AzureActiveDirectory$jpn0016&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentType&quot;</span>: <span class="string">&quot;Audit.AzureActiveDirectory&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentCreated&quot;</span>: <span class="string">&quot;2023-10-16T04:43:36.610Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contentExpiration&quot;</span>: <span class="string">&quot;2023-10-23T00:10:37.495Z&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    …</span><br></pre></td></tr></table></figure><p>このデータをどう活用していくのかを確認するために、Office 365 Management API のリファレンスを見てみると、上記のコンテンツ リストに含まれる <code>contentUri</code> に対して GET 要求を行うことで、コンテンツ (=アクションまたはイベントのコレクション) が取得できるようです。  </p><p>そこで、次のアクションでは、コンテンツリスト内の各 contentUri に対して GET 要求を行っていきます。  </p><h2 id="5-Office-365-Management-API-でコンテンツの取得"><a href="#5-Office-365-Management-API-でコンテンツの取得" class="headerlink" title="5. Office 365 Management API でコンテンツの取得"></a>5. Office 365 Management API でコンテンツの取得</h2><p>コンテンツの取得には、以下の API を使用します。<br><a href="https://learn.microsoft.com/ja-jp/office/office-365-management-api/office-365-management-activity-api-reference#retrieving-content">コンテンツの取得</a>  </p><p>リファレンスの “応答のサンプル” を見てみると、一つの contentUri に対して GET 要求を行うと、配列形式で複数のコンテンツが返却されるようです。<br>今回は、複数の contentUri に対して繰り返し GET 要求を行い、得られた配列を 1 つの CSV に出力したいので、事前に CSV 作成のための変数を用意しておき、各 contentUri から得られた配列は変数に格納していくこととします。<br>Power Automate の「変数の設定」アクションでは、自己参照ができないため、配列を結合しながら CSV にまとめていくために、手順 4-3 で 2 つの変数を用意しています。  </p><p><strong>5-1．GET 要求を繰り返すためのループアクションを作成</strong><br>Do until 内でコントロールコネクタ「Apply to each」アクションをフローに追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/apply-to-each.png" alt="Apply to each">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>以前の手順から出力を選択</td><td>動的なコンテンツ &gt; <code>HTTP | コンテンツリストの作成</code> &gt; <code>本文</code></td></tr></tbody></table><p><strong>5-2．コンテンツの取得</strong><br>Apply to each 内で HTTP コネクタ「HTTP」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/http-contents.png" alt="HTTP-コンテンツの取得">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>方法</td><td>GET</td></tr><tr><td>URI</td><td>式 &gt; <code>items(&#39;Apply_to_each&#39;)?[&#39;contentUri&#39;]</code></td></tr><tr><td>認証</td><td>Active Directory OAuth</td></tr><tr><td>テナント</td><td>動的なコンテンツ &gt; <code>tenantID</code></td></tr><tr><td>対象ユーザー</td><td><code>https://manage.office.com/</code></td></tr><tr><td>クライアント ID</td><td>動的なコンテンツ &gt; <code>clientID</code></td></tr><tr><td>資格情報の種類</td><td>シークレット</td></tr><tr><td>シークレット</td><td>動的なコンテンツ &gt; <code>secret</code></td></tr></tbody></table><p><strong>5-3．contentsAll 変数の値を一時的に contents 変数に退避</strong><br>Apply to each 内で変数コネクタ「変数の設定」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/set-variable-contents.png" alt="変数の設定-contents"></p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contents</td></tr><tr><td>値</td><td>動的なコンテンツ &gt; <code>変数</code> &gt; <code>contentsAll</code></td></tr></tbody></table><p><strong>5-4．contents 変数の値と「HTTP | コンテンツの取得」アクションの本文を結合して contentsAll に格納</strong><br>Apply to each 内で変数コネクタ「変数の設定」アクションを追加し、以下のように設定します。<br>配列の結合には、<a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#union"><code>union</code> 関数</a> を使用します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/set-variable-contentsall.png" alt="変数の設定-contentsall">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentsAll</td></tr><tr><td>値</td><td>式 &gt; <code>union(json(body(&#39;HTTP_|_コンテンツの取得&#39;)), variables(&#39;contents&#39;))</code></td></tr></tbody></table><p><strong>5-5．「HTTP | コンテンツリストの作成」のヘッダーに NextPageUri があるかを確認</strong><br>Do until 内でコントロールコネクタ「条件」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/condition2.png" alt="条件">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>左辺</td><td>式 &gt; <code>outputs(&#39;HTTP_|_コンテンツリストの作成&#39;)[&#39;headers&#39;]?[&#39;NextPageUri&#39;]</code></td></tr><tr><td>条件</td><td>次の値に等しくない</td></tr><tr><td>右辺</td><td>式 &gt; <code>Null</code></td></tr></tbody></table><p><strong>5-6．NextPageUri が存在する場合、contentsListUri 変数を NextPageUri で更新</strong><br><code>はいの場合</code> 内に変数コネクタ「変数の設定」アクションをフローに追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/set-variable-nextpageuri.png" alt="変数の設定-NextPageUri">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentsListUri</td></tr><tr><td>値</td><td>式 &gt; <code>outputs(&#39;HTTP_|_コンテンツリストの作成&#39;)[&#39;headers&#39;]?[&#39;NextPageUri&#39;]</code></td></tr></tbody></table><p><strong>5-7．NextPageUri が存在しない場合、contentsListUri 変数を 0 で更新</strong><br><code>いいえの場合</code> 内に変数コネクタ「変数の設定」アクションをフローに追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/set-variable-no-nextpageuri.png" alt="変数の設定-NextPageUri">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>名前</td><td>contentsListUri</td></tr><tr><td>値</td><td>0</td></tr></tbody></table><h2 id="6-CSVファイルの作成・保存"><a href="#6-CSVファイルの作成・保存" class="headerlink" title="6. CSVファイルの作成・保存"></a>6. CSVファイルの作成・保存</h2><p>これで監査ログの値を全て取得できたので、最後に CSV を作成してクラウド ストレージに保存します。  </p><p><strong>6-1．CSV ファイルの作成</strong><br>データ操作コネクタ「CSV テーブルの作成」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/create-csv-table.png" alt="CSVテーブルの作成">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>開始</td><td>動的なコンテンツ &gt; <code>変数</code> &gt; <code>contentsAll</code></td></tr></tbody></table><p><strong>6-2．CSV ファイルの保存</strong><br>今回は SharePoint のドキュメントライブラリに保存しますが、こちらはアクションの一例ですので、任意のストレージに保存してください。<br>SharePoint コネクタ「ファイルの作成」アクションを追加し、以下のように設定します。  </p><p><img src="/blog/powerautomate/work-with-audit-log/create-file.png" alt="CSVファイルの保存">  </p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>サイトのアドレス</td><td>任意のサイト</td></tr><tr><td>フォルダ―のパス</td><td>任意のパス</td></tr><tr><td>ファイル名</td><td>任意のファイル名(拡張子: .csv)</td></tr><tr><td>ファイル コンテンツ</td><td>動的なコンテンツ &gt; <code>CSV テーブルの作成</code> &gt; <code>出力</code></td></tr></tbody></table><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>長大なフローになりましたので、最後にフローの全体像を貼っておきます。<br>全体の構成に誤りがないか、以下のキャプチャと見比べて確認してみてください。  </p><p>今回は <code>Audit.AzureActiveDirectory</code> のコンテンツ タイプを対象に API を実行しましたが、SharePoint など他のコンテンツ タイプについても同じ構成のフローで実行できますので、ぜひカスタマイズして便利なフローを作ってみてください。  </p><p><img src="/blog/powerautomate/work-with-audit-log/flow.png" alt="フロー全体像"></p><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>Power Autoamte のテンプレートギャラリーには、”<a href="https://make.powerautomate.com/galleries/public/templates/4a7ea95259f1404e95855f6b053360b1/office-365-%E3%81%AE%E7%9B%A3%E6%9F%BB%E3%83%AD%E3%82%B0%E3%81%A7%E7%89%B9%E5%AE%9A%E3%81%AE%E8%A9%B3%E7%B4%B0%E3%82%92%E7%9B%A3%E8%A6%96%E3%81%97%E3%81%A6%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E3%82%92%E9%80%81%E4%BF%A1">Office 365 の監査ログで特定の詳細を監視してアラートを送信</a>“ というテンプレートがありますが、こちらは古い API を使用しているため、現時点では使用が推奨されておりません。<br>監査ログの取得については、Office 365 Management API でのフローの作成をご検討ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの清水です。&lt;br&gt;今回は、よくお問い合わせをいただく題材の一つとして、クラウド フローを使用して、Microsoft Purview の監査ログを取得する方法について紹介します。  &lt;/p&gt;
&lt;p&gt;2023 年 10 月現</summary>
      
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
    <category term="Office 365 Management API" scheme="https://jpdynamicscrm.github.io/blog/tags/Office-365-Management-API/"/>
    
  </entry>
  
  <entry>
    <title>ユーザーの個人設定を管理者が変更する方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/ChangePersonalizationSettings/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/ChangePersonalizationSettings/</id>
    <published>2023-08-23T03:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.430Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの原です。</p><p>今回は、ユーザーの個人設定を管理者が変更する方法をご紹介いたします。</p><h3 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h3><p>個人設定では、タイムゾーンを変更したり、レコードのリストの各ページに表示するレコード数を変更したり、言語や通貨を変更したりなど様々な設定が可能です。<br><br>一方で、ユーザーの個人設定は通常、ユーザー個人でのみ変更が可能となっている項目であり、管理者にて一括で変更する標準機能のご提供はございません。<br><br>ただし、代替案として以下に紹介する方法で、管理者が他ユーザーの個人設定を変更することが可能です。<br>また、これはあくまでユーザーの個人設定を管理者が変更する方法であり、既定値を変更するものではないことにご注意ください。<br></p><p>なお、弊社検証環境では下記にご紹介する API にて、ユーザーの個人設定の一括変更が実行可能なことを確認しておりますが、<br>下記でご案内いたします XrmToolBox につきましては、サードパーティー製ツールでございますため、<br>本ツールをご利用いただく中でのエラーやご不明点に関しましては弊社からサポートをご提供することがかないません。<br><br>詳細な使用方法やエラーに対する対処は製品提供元へご確認いただく必要がございますことをご承知おきいただきますようお願い申し上げます。</p><h3 id="XrmToolBox-を使用して変更する"><a href="#XrmToolBox-を使用して変更する" class="headerlink" title="XrmToolBox を使用して変更する"></a>XrmToolBox を使用して変更する</h3><ol><li><p>XrmToolBox を <a href="https://learn.microsoft.com/ja-jp/power-apps/developer/model-driven-apps/developer-tools">こちら</a> の記事の案内に従ってダウンロードします。</p></li><li><p>XrmToolBox アプリケーションを開き、 [Configuration] タブより [Manage connections] を選択します。<br><img src="/blog/powerplatform/ChangePersonalizationSettings/2ndStep.png"></p></li><li><p>[New Connection] を選択し、[Microsoft Login Control] をクリックします。</p></li><li><p>[Open Microsoft Login Control] をクリックし、ユーザー名などを入力します。<br><img src="/blog/powerplatform/ChangePersonalizationSettings/4thStep.png"><br><br><img src="/blog/powerplatform/ChangePersonalizationSettings/4-2ndStep.png"></p></li><li><p>該当環境を選択して Connection の任意の名前を入力し、[Finish]を選択します。<br>Connection が作成されたことを確認し、[Connections Manager] ウィンドウを閉じます。</p></li><li><p>[Tools] タブより [User Settings Utility] を選択し、ダブルクリックします。<br>(表示されない場合は事前に [ToolLibrary] よりツールを追加してください)<br>※「Do you want to connect to an organization first?」というダイアログが表示された場合は「はい」を選択し<br>作成した Connection 先を選び「Connect」をクリックしてください。<br><img src="/blog/powerplatform/ChangePersonalizationSettings/6thStep.png"></p></li><li><p>[Load Users and settings] をクリックします。</p></li><li><p>対象ユーザーを選択し、変更したい個人設定を変更します。</p></li><li><p>[Update User Settings]をクリックします。<br><br><img src="/blog/powerplatform/ChangePersonalizationSettings/finalStep.png"></p></li></ol><p>以上の手順で管理者がユーザーの個人設定を変更することが可能です。<br>また、繰り返しにはなりますが、冒頭でお伝えした通り、XrmToolBox につきましては、サードパーティー製ツールでございますため、本ツールをご利用いただく中でのエラーやご不明点に関しましては弊社からサポートをご提供することがかないませんことをご承知おきください。</p><h3 id="API-を使用して変更する"><a href="#API-を使用して変更する" class="headerlink" title="API を使用して変更する"></a>API を使用して変更する</h3><p>以下の方法で個人設定の変更が可能です。<br>また、以下では一例としてタイムゾーンの変更の方法をご紹介いたします。</p><ul><li>要求の方法：PATCH</li><li>要求のURL：https://&lt;orgname&gt;.crm7.dynamics.com/api/data/v9.2/usersettingscollection(&lt;UserID&gt;)</li><li>ヘッダー：以下を入力します。<br><br>{<br><br>“Accept”: “application/json”,<br><br>“Content-Type”: “application/json; charset=utf-8”,<br><br>“OData-MaxVersion”: “4.0”,<br><br>“Odata-Version”: “4.0”,<br><br>}</li><li>要求の本文：以下を入力します。<br>※ここではタイムゾーンを「（GMT+09:00）大阪、札幌、東京」に変更する方法をご紹介しています。ここの本文を変更いただくことでタイムゾーン以外の個人設定の変更が可能となります。<br><br>{<br><br>“timezonecode”:235<br><br>}</li></ul><h3 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h3><p>本記事が、ユーザーの個人設定を管理いただく上でのお役に立てましたら幸いです。<br>ご不明な点などがございましたら、弊社サポート一同にてお待ち申し上げておりますので、ぜひお気軽にお問合せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの原です。&lt;/p&gt;
&lt;p&gt;今回は、ユーザーの個人設定を管理者が変更する方法をご紹介いたします。&lt;/p&gt;
&lt;h3 id=&quot;はじめに&quot;&gt;&lt;a href=&quot;#はじめに&quot; class=&quot;headerlink&quot; title=&quot;はじめに</summary>
      
    
    
    
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Settings" scheme="https://jpdynamicscrm.github.io/blog/tags/Settings/"/>
    
  </entry>
  
  <entry>
    <title>MC454715 (Power AppsとPower Platformの管理センターで使用される新しいPower PlatformのURL)</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/MC454715/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/MC454715/</id>
    <published>2023-06-06T02:30:00.000Z</published>
    <updated>2024-11-26T00:36:26.434Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチームの網野です。<br>2022 年 11 月 に MC454715 にて通知された内容について、お客様への影響および対応方法についてご案内いたします。</p><span id="more"></span><h2 id="MC454715-の内容"><a href="#MC454715-の内容" class="headerlink" title="MC454715 の内容"></a>MC454715 の内容</h2><hr><h3 id="機能変更の内容"><a href="#機能変更の内容" class="headerlink" title="機能変更の内容"></a>機能変更の内容</h3><p>2022 年 11 月以降 Power Platform 管理センターや Power Apps / Power Automate ポータルにて、内部的に Power Platform API という新しいアプリの利用を順次開始しています。Power Platform API アプリへのリクエストが行われるようになりますので、Power Platform API アプリへの通信が行える状態になっている必要があります。  </p><h3 id="影響するユーザー"><a href="#影響するユーザー" class="headerlink" title="影響するユーザー"></a>影響するユーザー</h3><p>以下のいずれかに該当する場合、影響が発生する可能性があります。</p><ol><li>ファイアウォールやプロキシなどで URL を制御している場合</li><li>Azure AD の条件付きアクセスで利用可能なアプリを制御している場合</li></ol><h3 id="対応方法"><a href="#対応方法" class="headerlink" title="対応方法"></a>対応方法</h3><p>以下の対応が必要です。  </p><ol><li><p><u>許可が必要な URL の確認</u><br>  ファイアウォール等で通信を制御している場合には以下の URL への通信を許可してください。  </p><ul><li>*.api.powerplatform.com</li><li>api.powerplatform.com  </li></ul><p>  また、Power Apps / Power Automate をご利用いただく場合に許可が必要な URL は以下の公開情報におまとめしています。<br>  本件の対応と合わせてすべての URL が許可されているかご確認ください。 </p><ul><li><a href="https://learn.microsoft.com/ja-jp/power-apps/limits-and-config#required-services">Power Apps 必要なサービス</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-automate/ip-address-configuration#required-services">Power Automate 必要なサービス</a>  </li></ul></li><li><p><u>Azure AD の条件付きアクセスの確認</u><br>  Azure AD の条件付きアクセスを利用している場合、Power Platform API アプリがブロックされていないことを確認してください。<br>  Azure AD の条件付きアクセスを利用していない場合や、Power Platform API アプリをブロックしていない場合は対応は必要ございません。  </p><p>  また、Azure AD の条件付きアクセスを利用している場合、Power Apps および Power Automate をご利用いただくには <a href="https://learn.microsoft.com/ja-jp/power-platform/guidance/adoption/conditional-access">公開情報</a> に記載されているアプリがすべて許可されている必要があります。<br>  2023/06/04 時点では以下のアプリが対象となりますので、本件の対応と合わせて対象のアプリがすべてブロックされていないことをご確認ください。  </p><ul><li>Common Data Service</li><li>Power Platform API</li><li>Microsoft Power Apps</li><li>Microsoft Flow</li><li>Microsoft Azure Management  <br></li></ul><p>  Azure AD の条件付きアクセスポリシーに Power Platform API が表示されない場合は以下の公開情報に記載の PowerShell から追加することができます。<br>  <a href="https://learn.microsoft.com/ja-jp/power-platform/admin/programmability-authentication-v2#step-2-configure-api-permissions">ステップ 2. API アクセス許可の構成</a></p>  <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Install the Azure AD the module</span></span><br><span class="line"><span class="built_in">Install-Module</span> AzureAD</span><br><span class="line"> </span><br><span class="line"><span class="built_in">Connect-AzureAD</span></span><br><span class="line"><span class="built_in">New-AzureADServicePrincipal</span> <span class="literal">-AppId</span> <span class="number">8578</span>e004<span class="literal">-a5c6</span><span class="literal">-46e7</span><span class="literal">-913e</span><span class="literal">-12f58912df43</span> <span class="literal">-DisplayName</span> <span class="string">&quot;Power Platform API&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="MC454715-メッセージ全文"><a href="#MC454715-メッセージ全文" class="headerlink" title="MC454715　メッセージ全文"></a>MC454715　メッセージ全文</h3><p><img src="/blog/powerplatform/MC454715/messagecenter.png"></p><h2 id="よくあるご質問"><a href="#よくあるご質問" class="headerlink" title="よくあるご質問"></a>よくあるご質問</h2><h3 id="対応しないとどうなりますか？"><a href="#対応しないとどうなりますか？" class="headerlink" title="対応しないとどうなりますか？"></a>対応しないとどうなりますか？</h3><p>必要な通信が行われませんので、使用中にエラーになるなど想定外のエラーが発生する可能性がございます。</p><h3 id="いつからこの変更が適用されますか？"><a href="#いつからこの変更が適用されますか？" class="headerlink" title="いつからこの変更が適用されますか？"></a>いつからこの変更が適用されますか？</h3><p>2022年末より変更が適用されています。<br>また、機能追加に伴い、Power Platform API アプリへの通信が順次増えていますので、現在影響がなくても今後影響する可能性がございます。</p><h3 id="Microsoft-Power-Platform-API-はいつ追加されたアプリですか？"><a href="#Microsoft-Power-Platform-API-はいつ追加されたアプリですか？" class="headerlink" title="Microsoft Power Platform API はいつ追加されたアプリですか？"></a>Microsoft Power Platform API はいつ追加されたアプリですか？</h3><p>いいえ、Microsoft Power Platform API アプリは 2022 年 3 月にプレビュー機能としてリリースされた機能です。<br>Power Platform 製品の内部で利用されるだけではなく、お客様が直接 API を呼び出すこともできます。<br>詳細につきましては、開発チームの blog および公開情報をご参照ください。</p><ul><li> <a href="https://powerapps.microsoft.com/en-us/blog/introducing-microsoft-power-platform-api-preview/">Introducing Microsoft Power Platform API (preview)</a></li><li><a href="https://learn.microsoft.com/en-us/rest/api/power-platform/">Microsoft Power Platform API reference (preview)</a></li></ul><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチームの網野です。&lt;br&gt;2022 年 11 月 に MC454715 にて通知された内容について、お客様への影響および対応方法についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Apps" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Apps/"/>
    
    <category term="Power Platform" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Platform/"/>
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate for desktop のインストール後に LAN が繋がらない場合の対応方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-not-connected-to-lan/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-not-connected-to-lan/</id>
    <published>2023-06-03T03:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.346Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Power Platform サポートの櫻井です。<br>本記事では Power Automate for desktop のインストール後に LAN が繋がらない場合の対応方法についてご案内いたします。</p><span id="more"></span><ol><li><a href="#anchor-intro">はじめに</a></li><li><a href="#anchor-reason">原因</a> </li><li><a href="#anchor-measure">対応方法</a><ol><li><a href="#anchor-measure-wireless-lan">端末ごとの証明書フィルタリング設定 (無線 LAN の場合)</a></li><li><a href="#anchor-measure-wired-lan">端末ごとの証明書フィルタリング設定 (有線 LAN の場合)</a></li><li><a href="#anchor-measure-gpo">グループ ポリシーによる証明書フィルタリング設定</a><br><br/><br/></li></ol></li></ol><p><a id='anchor-intro'></a></p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><hr><p>「Power Automate for desktop をインストール後、社内 LAN に繋がらなくなってしまった」<br>というお問い合わせをいただくことがございます。<br>この記事では、本事象の原因と対応方法についてご案内いたします。<br><br/><br/></p><p><a id='anchor-reason'></a></p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><hr><p>Power Automate for desktop をインストールすると、Power Automate for desktop 用の証明書がインストールされます。<br>一方、Windows の証明書のフィルタリング機能を利用していない場合、Windows にて実装されているコンピューター証明書の自動選択基準に従い、<br>LAN 接続時の証明書が選択される動作となります。  </p><p>そのため、Power Automate for desktop のインストール後、自動選択基準で LAN 接続時の証明書が選択される際、<br>従来使用されていた LAN の証明書ではなく、Power Automate for desktop の証明書が選択される可能性があります。<br>その結果、LAN 接続時に必要な証明書が選択されず、社内 LAN に繋がらない事象が発生する可能性があります。  </p><p>証明書の自動選択基準についてはこちらの Windows サポートブログにてご説明しておりますので、ご参照いただけますと幸いです。<br><a href="https://jpwinsup.github.io/blog/2021/02/02/WirelessNetwork/Wi-Fi/Selection-criteria-for-certificates-used-for-wireless-LAN-connections/">無線 LAN 接続に利用されるコンピューター証明書の選択基準について</a><br><br/><br/></p><p><a id='anchor-measure'></a></p><h2 id="対応方法"><a href="#対応方法" class="headerlink" title="対応方法"></a>対応方法</h2><hr><p>端末ごとに証明書フィルタリング設定をすることで、ネットワークに繋がらない事象を防ぐことができます。<br>また、証明書フィルタリング設定を管理者にてグループ ポリシーとして設定できます。<br><br/></p><p><a id='anchor-measure-wireless-lan'></a></p><h3 id="1-端末ごとの証明書フィルタリング設定-無線-LAN-の場合"><a href="#1-端末ごとの証明書フィルタリング設定-無線-LAN-の場合" class="headerlink" title="1. 端末ごとの証明書フィルタリング設定 (無線 LAN の場合)"></a>1. 端末ごとの証明書フィルタリング設定 (無線 LAN の場合)</h3><p>無線 LAN 接続に利用されるフィルタリング機能の設定手順については、こちらの Windows サポートブログをご参照ください。<br><a href="https://jpwinsup.github.io/blog/2021/02/02/WirelessNetwork/Wi-Fi/Filtering-of-certificates-used-for-wireless-LAN-connections/">無線 LAN 接続に利用される証明書のフィルタリングについて</a><br><br/></p><p><a id='anchor-measure-wired-lan'></a></p><h3 id="2-端末ごとの証明書フィルタリング設定-有線-LAN-の場合"><a href="#2-端末ごとの証明書フィルタリング設定-有線-LAN-の場合" class="headerlink" title="2. 端末ごとの証明書フィルタリング設定 (有線 LAN の場合)"></a>2. 端末ごとの証明書フィルタリング設定 (有線 LAN の場合)</h3><ol><li><p> [Win] キー + [R] キー を押し、[ファイル名を指定して実行] のダイアログボックスを開きます。  </p></li><li><p><code>ncpa.cpl</code> と入力し、[Ctrl] キー + [Shift] キー + [Enter] キーを押します。<br><img src="/blog/powerautomate/power-automate-desktop-not-connected-to-lan/wired-lan-filter-setting1.png"></p></li><li><p>認証設定されている有線アダプタを右クリックして [プロパティ] をクリックします。  </p></li><li><p>[ネットワークの認証方法の選択] のコンボボックスの表示を確認して、以下の操作を行います。  </p><ul><li><p>コンボボックスの隣の [設定] をクリックします。<br><img src="/blog/powerautomate/power-automate-desktop-not-connected-to-lan/wired-lan-filter-setting2.png">  </p></li><li><p>[スマートカードまたはその他の証明書] の隣に表示されている [構成] をクリックします。<br><img src="/blog/powerautomate/power-automate-desktop-not-connected-to-lan/wired-lan-filter-setting3.png"></p></li></ul></li><li><p>以下の [詳細設定] ボタンをクリックします。<br><img src="/blog/powerautomate/power-automate-desktop-not-connected-to-lan/wired-lan-filter-setting4.png"></p></li><li><p>[証明書発行者] のチェックボックスを入れて、社内ネットワークで利用したい証明書の「ルート証明機関」のチェックを入れます。<br>(※ 以下は、社内 NW で利用する証明書のルート証明機関が “Microsoft Root Certificate Authority” の場合の設定例です。)<br><img src="/blog/powerautomate/power-automate-desktop-not-connected-to-lan/wired-lan-filter-setting5.png"></p></li><li><p>[OK] ボタンですべてのプロパティ画面を閉じます。  </p><br/></li></ol><p><a id='anchor-measure-gpo'></a></p><h3 id="3-グループ-ポリシーによる証明書フィルタリング設定"><a href="#3-グループ-ポリシーによる証明書フィルタリング設定" class="headerlink" title="3. グループ ポリシーによる証明書フィルタリング設定"></a>3. グループ ポリシーによる証明書フィルタリング設定</h3><p>グループ ポリシーにて無線 LAN / 有線 LAN プロファイルを配布されている場合、ドメイン コントローラー上の [グループポリシーの管理] 機能から設定を変更することで、管理者は証明書フィルタリング設定を一元管理できます。<br>なお、今回の設定は、Windows 8 以降で実装されたものであるため、ここでは、Windows Server 2012 以上のドメイン コントローラーを利用すると仮定します。  </p><h4 id="手順"><a href="#手順" class="headerlink" title="手順"></a>手順</h4><ol><li><p>グループ ポリシーの管理を開き、以下のグループ ポリシー オブジェクトを編集します。  </p><ul><li><p>無線 LAN の場合：<br>[コンピューターの構成] - [Windows の設定] - [セキュリティの設定] - [ワイヤレス ネットワーク (IEEE 802.11) ポリシー] を選択し、[&lt;ポリシー名&gt;] をダブルクリックします。  </p></li><li><p>有線 LAN の場合：<br>[コンピューターの構成] - [Windows の設定] - [セキュリティの設定] - [ ワイヤードポリシー] を選択し、[&lt;ポリシー名&gt;] をダブルクリックします。  </p></li></ul></li><li><p>[全般] タブより、該当のプロファイルを選択し、[編集] ボタンをクリックします。  </p></li><li><p>[セキュリティ] タブを選択します。ここでは、お客様が設定されている認証方式により、いずれかをご選択ください。</p><ul><li><p>[スマート カードまたはその他の証明書] が選択されている場合：<br>[プロパティ] をクリックします。  </p></li><li><p>[保護された EAP (PEAP)] が選択されている場合：<br>[プロパティ] をクリックし、次の画面で、さらに [スマート カードまたはその他の証明書] の右側の [構成] ボタンをクリックします。  </p></li></ul></li><li><p>“スマートカードまたはその他の証明書のプロパティ” が表示されますので、[詳細設定] をクリックします。  </p></li><li><p>当項目が Windows 8 以降より実装された機能となります。[証明書発行者] にチェックを入れて、証明書の発行元のルート証明書を選択ください。<br>(※ ルート証明書は、ローカル コンピューターの [信頼された証明機関] ストアを参照しておりますので、予めインストールを実施ください。)</p></li><li><p>クライアント側にて <code>gpupdate /force</code> を実施します。  </p></li></ol><p>なお、設定される項目に関しては、こちらの Windows サポートブログをご参照いただけますと幸いです。<br><a href="https://jpwinsup.github.io/blog/2021/02/02/WirelessNetwork/Wi-Fi/Filtering-of-certificates-used-for-wireless-LAN-connections/">無線 LAN 接続に利用される証明書のフィルタリングについて</a></p><hr><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>本手順は執筆時点でのユーザー インターフェイスを基に紹介しています。バージョンアップによって若干の UI の遷移など異なる場合があります。その場合は画面の指示に従って進めてください。</p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。Power Platform サポートの櫻井です。&lt;br&gt;本記事では Power Automate for desktop のインストール後に LAN が繋がらない場合の対応方法についてご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Desktop flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Desktop-flow/"/>
    
    <category term="Power Automate for desktop" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate-for-desktop/"/>
    
  </entry>
  
  <entry>
    <title>Dataverse テーブルに登録されている 5,000 件を超えるデータを FetchXML クエリを使用して取得する</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/fetch-xml/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/fetch-xml/</id>
    <published>2023-05-31T00:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.306Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポート 谷です。<br/><br>この記事では Dataverse テーブルに登録されている 5,000 件を超えるデータを取得する方法について、FetchXML クエリを使用した方法をご紹介します。</p><span id="more"></span><h2 id="Dataverse-テーブルから-5-000-件を超えるデータを取得する方法"><a href="#Dataverse-テーブルから-5-000-件を超えるデータを取得する方法" class="headerlink" title="Dataverse テーブルから 5,000 件を超えるデータを取得する方法"></a>Dataverse テーブルから 5,000 件を超えるデータを取得する方法</h2><p>Power Platform の Dataverse コネクタ「行を一覧にする」アクションを使用すると、取得する列の選択や行のフィルターなどを設定することで、取得されたいデータをローコードで絞り込むことができます。<br/><br>多くの場合、この方法で Dataverse からデータを取得していると思います。<br/><br>「行を一覧にする」アクションは 1 回の実行で最大 5,000 件のデータを取得しますので、 5,000 件を超えるデータを取得したい場合は、当アクションのオプション「改ページ」を設定します。<br/><br>複雑なフローを構成することなく、5,000 件を超える 100,000件(※) までのデータをページングしながら取得することができます。<br/><br>※ 100,000 件は Power Automate クラウド フローで取得可能なページ付けされた項目数の上限です。<br><br/><br><br/><br>アクションの 3 点メニュー &gt; 設定 にて改ページの設定を行います。</p><p><img src="/blog/powerautomate/fetch-xml/image01.png"> </p><p>さて、Dataverse では FetchXML という独自の XML ベースのクエリ言語を使用することができます。<br/><br>複雑なクエリでデータを検索したり、100,000 件を超える大量のデータを取得したり、柔軟できめ細やかな条件にてデータを取得することが可能になります。</p><p>しかし、FetchXML クエリをコーディングしたり、フロー側で <code>Do until</code> アクションを使用して 5,000 件を超えるデータをページングして取得するようフローを構成する必要があります。<br/><br>FetchXML を使用した実装方法をより身近に感じていただきたく、以降では、実際に FetchXML を使用して 5,000 件を超えるデータをページングしながら取得するサンプル フローをご紹介します。</p><h2 id="FetchXML-クエリで5-000-件を超えるデータを取得するサンプル-フロー"><a href="#FetchXML-クエリで5-000-件を超えるデータを取得するサンプル-フロー" class="headerlink" title="FetchXML クエリで5,000 件を超えるデータを取得するサンプル フロー"></a>FetchXML クエリで5,000 件を超えるデータを取得するサンプル フロー</h2><p>下図はサンプル フローの完成図です。 <code>Do until</code> アクションを使用して順次、対象ページのデータを取得します。</p><p><img src="/blog/powerautomate/fetch-xml/image02.png"> </p><h3 id="0-FetchXML-クエリをビルドする"><a href="#0-FetchXML-クエリをビルドする" class="headerlink" title="0. FetchXML クエリをビルドする"></a>0. FetchXML クエリをビルドする</h3><p>FetchXML クエリの作成方法は <a href="https://learn.microsoft.com/ja-jp/power-apps/developer/data-platform/use-fetchxml-construct-query">公開情報</a> に記載があるとおり、FetchXML 言語のスキーマ定義に従います。<br/></p><p><a href="https://make.powerapps.com/">Power Apps</a> や、環境の「詳細設定」から遷移できる従来の <a href="https://learn.microsoft.com/ja-jp/power-apps/user/advanced-find">高度な検索</a> を使用すると簡単にクエリをビルドできます。</p><p>i.  Power Apps 作成者 ポータル &gt; 歯車 アイコン &gt; [詳細設定] を選択します<br><img src="/blog/powerautomate/fetch-xml/image00-01.png"> </p><p>ii. フィルター アイコンを選択します<br><img src="/blog/powerautomate/fetch-xml/image00-02.png"></p><p>iii. 条件を設定し、[Fetch XML のダウンロード] を押下します<br><img src="/blog/powerautomate/fetch-xml/image00-03.png"></p><h3 id="1-ページ番号を格納するための変数を定義する"><a href="#1-ページ番号を格納するための変数を定義する" class="headerlink" title="1. ページ番号を格納するための変数を定義する"></a>1. ページ番号を格納するための変数を定義する</h3><p>次に読み込むべき、対象ページのページ番号を識別するための変数を定義します。<br>1 ページ目からデータを取得するため初期値は <code>1</code> です。</p><p>[名前] 任意の変数名を入力ください<br>[種類] 整数<br>[値] 1    </p><p><img src="/blog/powerautomate/fetch-xml/image03.png"> </p><h3 id="2-データ件数を格納するための変数を定義する"><a href="#2-データ件数を格納するための変数を定義する" class="headerlink" title="2. データ件数を格納するための変数を定義する"></a>2. データ件数を格納するための変数を定義する</h3><p>「行を一覧にする」アクションにて取得されたデータ件数を識別するための変数を定義します。<br/><br>取得されたデータ件数が 0 件になるまで後続のループ処理で Dataverse へのアクションを実行します。</p><p>[名前] 任意の変数名を入力ください<br>[種類] 整数<br>[値] 0    </p><p><img src="/blog/powerautomate/fetch-xml/image04.png"> </p><h3 id="3-全データを取得するよう繰り返しDataverseからデータを取得する"><a href="#3-全データを取得するよう繰り返しDataverseからデータを取得する" class="headerlink" title="3. 全データを取得するよう繰り返しDataverseからデータを取得する"></a>3. 全データを取得するよう繰り返しDataverseからデータを取得する</h3><p>手順 2 で定義した、 Dataverse から取得されたデータ件数が 0 件と判定されるまでループを実行し続けます。</p><p>[左辺] 手順 2 で定義した変数<br>[条件] 次の値に等しい<br>[右辺] 0    </p><p><img src="/blog/powerautomate/fetch-xml/image05.png"> </p><h3 id="4-FetchXML-を使用して-Dataverse-からデータを取得する"><a href="#4-FetchXML-を使用して-Dataverse-からデータを取得する" class="headerlink" title="4. FetchXML を使用して Dataverse からデータを取得する"></a>4. FetchXML を使用して Dataverse からデータを取得する</h3><p>FetchXML クエリを使用して Dataverse への検索を行います。<br/><br><code>page</code> プロパティに、手順 1 で定義した変数に格納しておいたページ番号を指定して、取得対象のページのデータを取得します。<br/><br>本サンプルでは検索条件などは設定していませんが、要件に応じて柔軟にクエリをカスタマイズできます。詳細は手順 0 にてご紹介しています。</p><p>[テーブル名] 対象の Dateverse テーブルを指定ください<br>[Fetch Xml クエリ]    </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fetch</span></span></span><br><span class="line"><span class="tag">   <span class="attr">page</span>=<span class="string">&quot;【ページ番号を定義した変数名】&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">entity</span> <span class="attr">name</span>=<span class="string">&quot;【Dataverse テーブル名】&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">attribute</span> <span class="attr">name</span>=<span class="string">&quot;【取得されたい列名】&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">entity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fetch</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>ページ番号</code>は動的コンテンツから手順 1 で定義した変数名をご指定ください</p><p><img src="/blog/powerautomate/fetch-xml/image06.png"> </p><h3 id="5-ページ番号をインクリメントする"><a href="#5-ページ番号をインクリメントする" class="headerlink" title="5. ページ番号をインクリメントする"></a>5. ページ番号をインクリメントする</h3><p>次に読み込むべきページ番号を 1 ずつ増分します。</p><p>[名前] 手順 1 で定義した変数<br>[値] 1    </p><p><img src="/blog/powerautomate/fetch-xml/image07.png"> </p><h3 id="6-データ件数を最新化する"><a href="#6-データ件数を最新化する" class="headerlink" title="6. データ件数を最新化する"></a>6. データ件数を最新化する</h3><p>今回の実行で取得されたデータ件数を格納します。<br/><br>データ件数が 0 件の場合、ループを抜け処理を終了します。</p><p>[名前] 手順 2 で定義した変数<br>[値] 式に以下の数式を設定ください。取得できたデータ件数で更新します。    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(outputs(&#x27;行を一覧にする&#x27;)?[&#x27;body/value&#x27;])</span><br></pre></td></tr></table></figure><p><img src="/blog/powerautomate/fetch-xml/image08.png"> </p><p>複雑な検索条件で Dataverse から取得したデータをもとにクラウド フローを実行されたい場合のご参考になりましたら幸いです。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><p><a href="https://learn.microsoft.com/ja-jp/power-apps/developer/data-platform/webapi/use-fetchxml-web-api#paging-with-fetchxml">Web API で FetchXml を使用する</a></p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポート 谷です。&lt;br/&gt;&lt;br&gt;この記事では Dataverse テーブルに登録されている 5,000 件を超えるデータを取得する方法について、FetchXML クエリを使用した方法をご紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
    <category term="Dataverse" scheme="https://jpdynamicscrm.github.io/blog/tags/Dataverse/"/>
    
  </entry>
  
  <entry>
    <title>デスクトップ フローを複製・共有する方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-shared-flow/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-shared-flow/</id>
    <published>2023-05-18T09:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.350Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの林です。<br>Power Automate for desktop で作成したデスクトップ フローを複製したり、他の方にも利用していただくため共有する方法についてご案内いたします。積極的に作業の自動化を推進して、業務の効率化を図りましょう。  </p><span id="more"></span><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>作成したデスクトップ フローを複製・共有する方法として、Power Automate for desktopから実行可能な方法とPower Automateポータルから実行可能な方法があります。一覧にすると以下の通りです。  </p><table><thead><tr><th>手法</th><th align="center">複製機能</th><th align="center">共同編集機能</th><th align="center">別環境への移行可</th><th align="center">要有償ライセンス※1</th></tr></thead><tbody><tr><td><strong>Power Automate for desktopから実行可能</strong></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td>1. デスクトップ フローのコピー</td><td align="center">〇</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td>2. フロー デザイナーでのコピー</td><td align="center">〇※2</td><td align="center"></td><td align="center">〇</td><td align="center"></td></tr><tr><td><strong>Power Automateポータルから実行可能</strong></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td>3. デスクトップ フローの共有</td><td align="center"></td><td align="center">〇</td><td align="center"></td><td align="center">〇</td></tr><tr><td>4. ソリューションでの移行</td><td align="center">〇※2</td><td align="center"></td><td align="center">〇</td><td align="center"></td></tr></tbody></table><p>※1 Power Automate Premium<br>※2 複製結果を所有者以外のユーザーと共有することが可能  </p><p>各手法について以降で詳細にご説明させていただきます。  </p><h2 id="1-デスクトップ-フローのコピー"><a href="#1-デスクトップ-フローのコピー" class="headerlink" title="1. デスクトップ フローのコピー"></a>1. デスクトップ フローのコピー</h2><p>Power Automate for desktopのデスクトップ フローの一覧画面から “コピーを作成する” を選択することで、簡単にデスクトップ フローを同じ環境に複製することができます。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/pad-list-copy1.png"></p><p>複製したデスクトップフローは任意の名前を付けることができます。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/pad-list-copy2.png"></p><h2 id="2-フロー-デザイナーでのコピー"><a href="#2-フロー-デザイナーでのコピー" class="headerlink" title="2. フロー デザイナーでのコピー"></a>2. フロー デザイナーでのコピー</h2><p>デスクトップ フローのフロー デザイナー（編集画面）から、フロー内のアクションをコピーすることができます。<br>コピーする方法は２つございます。いずれもコピーした内容はクリップ ボードに記録されるため、テキスト ファイルに保存し、他の方と共有することができます。また、デスクトップ フローの履歴やバックアップとしても保存することもできます。  </p><h4 id="サブフロー単位でコピーする"><a href="#サブフロー単位でコピーする" class="headerlink" title="サブフロー単位でコピーする"></a>サブフロー単位でコピーする</h4><ol><li><p>コピーしたいサブ フロー上で右クリックでメニューを開き、”コピー” を選択します。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/subflow-copy-paste1.png"></p></li><li><p>サブ フローを張り付けたいデスクトップ フローを開き、右クリックから “貼り付け” を選択します。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/subflow-copy-paste2.png"></p></li><li><p>張り付けることでサブ フロー名も含めてデスクトップ フローの内容をコピーすることができます。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/subflow-copy-paste3.png"></p></li></ol><h4 id="アクション単位でコピーする"><a href="#アクション単位でコピーする" class="headerlink" title="アクション単位でコピーする"></a>アクション単位でコピーする</h4><ol><li><p>コピーしたいアクションを選択し（複数選択可）、コピーします。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/action-copy-paste1.png"></p></li><li><p>張り付け先のデスクトップ フローを開き、張り付けたい箇所の次のアクションを選択します。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/action-copy-paste2.png"></p></li><li><p>張り付けることでアクション単位でコピーすることができます。上記2でアクションを選択しない場合、一番下にコピーしたアクションが追加されます。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/action-copy-paste3.png"></p></li></ol><h4 id="補足事項"><a href="#補足事項" class="headerlink" title="補足事項"></a>補足事項</h4><ul><li>コピー対象はデスクトップ フローのステップ情報です。そのため、入出力変数の定義やフロー内のアクションで使用していない UI 要素など一部の情報はコピーの対象外となります。  </li></ul><h2 id="3-デスクトップ-フローの共有"><a href="#3-デスクトップ-フローの共有" class="headerlink" title="3. デスクトップ フローの共有"></a>3. デスクトップ フローの共有</h2><p>Power Automate ポータルからデスクトップ フローを共有することができます。デスクトップ フローの共有となるため、デスクトップ フローを修正すると共有先全てに反映される動作となります。  </p><ol><li><p>Power Automate ポータル  &gt; マイフロー &gt;  にアクセスします。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/premium1.png"></p></li><li><p>共有したいデスクトップ フローを選択し、 “共有” を押下します。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/premium2.png"></p></li><li><p>共有したいユーザーを選択し、 “保存” を押下します。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/premium3.png"></p></li></ol><p>公開情報にも手順の記載がございますので、ご参照いただけますと幸いです。<br><a href="https://learn.microsoft.com/ja-jp/power-automate/desktop-flows/manage#share-desktop-flows">デスクトップ フローの管理 - Power Automate | Microsoft Learn</a>  </p><h4 id="補足事項-1"><a href="#補足事項-1" class="headerlink" title="補足事項"></a>補足事項</h4><ul><li><p>デスクトップ フローの共有操作をするためには有償ライセンスが必要となり、有償ライセンスがない場合は以下の画面となり操作できません。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/premium4.png"></p></li><li><p>共有時点では共有先ユーザーに有償ライセンスは不要ですが、実際にデスクトップ フローを利用する時点で必要となりますのでご注意ください。有償ライセンスがない場合、共有されたデスクトップ フローを参照することができません。<br><img src="/blog/powerautomate/power-automate-desktop-shared-flow/premium5.png"></p></li></ul><h2 id="4-ソリューションでの移行"><a href="#4-ソリューションでの移行" class="headerlink" title="4. ソリューションでの移行"></a>4. ソリューションでの移行</h2><p>ソリューションにデスクトップ フローを追加することで、ソリューション単位でエクスポート、インポートによりデスクトップ フローを別環境に移行することができます。ソリューションの概要や操作方法については以下の公開情報をご確認下さい。  </p><p><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/solutions-overview">Power Apps のソリューション - Power Apps | Microsoft Learn</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/create-solution">Power Apps でソリューションを作成する - Power Apps | Microsoft Learn</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/export-solutions">ソリューションのエクスポート - Power Apps | Microsoft Learn</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/import-update-export-solutions">ソリューションのインポート - Power Apps | Microsoft Learn</a>  </p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの林です。&lt;br&gt;Power Automate for desktop で作成したデスクトップ フローを複製したり、他の方にも利用していただくため共有する方法についてご案内いたします。積極的に作業の自動化を推進して、業務の効率化を図りましょう。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
    <category term="Desktop flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Desktop-flow/"/>
    
    <category term="Power Automate for desktop" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate-for-desktop/"/>
    
  </entry>
  
  <entry>
    <title>低速フローのトラブル シューティング</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/troubleshoot-throttling-flow/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/troubleshoot-throttling-flow/</id>
    <published>2023-05-16T15:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.362Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの瀬戸です。<br>今回は、「クラウド フローの処理がいつまで経っても終わらない」ときに試していただける改善策をご案内いたします。</p><span id="more"></span><p>時間がかかるようなアクションは使っていないはずなのに、今まではすぐに処理が完了していたのに、クラウド フローが何日経っても完了しない。</p><p>そんなときは、フローが Power Automate の制限に抵触した可能性が考えられます。フローが制限に抵触すると、そのフローは実行中でも低速の状態になります。制限を超えないような速度で実行されるようになるので、数日たってもフローが実行中…ということがよくあります。</p><p>そこで今回は、フローの低速状態を避けるための改善策をご案内いたします。</p><p>＜目次＞</p><ol><li><a href="#Power-Automate-%E3%81%AE%E5%88%B6%E9%99%90">Power Automate の制限</a><ol><li><a href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E8%A6%81%E6%B1%82%E6%95%B0%E3%82%92%E6%95%B0%E3%81%88%E3%81%A6%E3%81%BF%E3%82%8B">フローのアクション要求数を数えてみる</a></li></ol></li><li><a href="#%E6%94%B9%E5%96%84%E7%AD%96">改善策</a><ol><li><a href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%81%AE%E5%AE%9F%E8%A1%8C%E5%9B%9E%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99">フローの実行回数を減らす</a></li><li><a href="#%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%97%E3%81%AE%E5%9B%9E%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99">繰り返しの回数を減らす</a><ol><li><a href="#%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC-%E3%82%AF%E3%82%A8%E3%83%AA%E3%82%92%E4%BD%BF%E3%81%86">フィルター クエリを使う</a></li><li><a href="#%E3%82%A2%E3%83%AC%E3%82%A4%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC%E5%87%A6%E7%90%86%E3%82%92%E4%BD%BF%E3%81%86">アレイのフィルター処理を使う</a></li><li><a href="#1-%E5%BA%A6%E3%81%AB%E7%B9%B0%E3%82%8A%E8%BF%94%E3%81%99%E5%9B%9E%E6%95%B0%E3%82%92%E6%B8%9B%E3%82%89%E3%81%99">1 度に繰り返す回数を減らす</a></li><li><a href="#%E9%9B%86%E8%A8%88%E3%81%AB-XPath-%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B">集計に XPath を活用する</a></li></ol></li><li><a href="#CSV-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%88%A9%E7%94%A8%E3%82%92%E9%81%BF%E3%81%91%E3%82%8B">CSV ファイルの利用を避ける</a></li><li><a href="#%E3%83%95%E3%83%AD%E3%83%BC%E3%82%92%E5%88%86%E5%89%B2%E3%81%99%E3%82%8B">フローを分割する</a></li><li><a href="#%E9%96%A2%E6%95%B0%E3%82%92%E6%B4%BB%E7%94%A8%E3%81%99%E3%82%8B">関数を活用する</a></li><li><a href="#%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%82%92%E8%B3%BC%E5%85%A5%E3%81%99%E3%82%8B">ライセンスを購入する</a></li></ol></li><li><a href="#%E6%9C%80%E5%BE%8C%E3%81%AB">最後に</a></li></ol><h2 id="Power-Automate-の制限"><a href="#Power-Automate-の制限" class="headerlink" title="Power Automate の制限"></a>Power Automate の制限</h2><p>改善策の前に、Power Automate の制限についてご案内いたします。<br>Power Automate には、サービスを皆さまへ安定的に提供するために、様々な制限が設けられています。</p><p>参考：<a href="https://learn.microsoft.com/ja-jp/power-automate/limits-and-config">制限と構成 - Power Automate | Microsoft Learn</a></p><p>特にフローの実行速度に影響を与えるのは、主に以下 3 点のスループットの制限です。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/power-automate/limits-and-config#action-request-limits">アクション要求数の制限</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-automate/limits-and-config#runtime-endpoint-request-limits">ランタイム エンドポイント要求の制限</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-automate/limits-and-config#content-throughput-limits">コンテンツ スループットの制限</a></li></ul><p>これらの制限に抵触すると、フローが低速になり、かつ、フローが最後まで実行されるかどうかが保証されなくなります。そのため、制限の範囲内で Power Automate をご利用いただくことが重要です。</p><h3 id="アクション要求数の制限"><a href="#アクション要求数の制限" class="headerlink" title="アクション要求数の制限"></a>アクション要求数の制限</h3><p>中でも、抵触することが多い制限として「24 時間あたりのアクション要求数」が挙げられます。今回の記事では、この「24 時間あたりのアクション要求数」の制限と、それに抵触しないようにする改善策を重点的に解説します。</p><p>まず、2023 年 5 月時点での「24 時間あたりのアクション要求数」の制限は下記の通りです。</p><table><thead><tr><th>ライセンス</th><th>パフォーマンス プロファイル</th><th>フローごとの 24 時間あたりのアクション要求数</th></tr></thead><tbody><tr><td>Power Automate Free<br>Office 365 に含まれる使用権　など</td><td>低</td><td>10,000</td></tr><tr><td>Power Automate Premium など</td><td>中</td><td>200,000</td></tr><tr><td>Power Automate Process</td><td>高</td><td>500,000</td></tr></tbody></table><p>パフォーマンス プロファイルが「低」の場合、制限値は「10,000」です。<br>例えば、1,000 行の CSV ファイルを読み込み、Apply to each で行ごとに処理をする場合、Apply to each の内側のアクションが 10 個あるだけで、実行されるアクション要求数が 10,000 を超えてしまいます。</p><div class="alert is-info"><p class="alert-title">Note</p><p>環境の従量課金を有効にすると、アクション要求数 (Power Platform 要求数) の制限が無くなります。詳細は、下記公開情報の Power Platform 要求メーター をご参照ください。</p><p>※ 2023 年 5 月現在、プレビューの機能です。</p><p><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/pay-as-you-go-overview">従量課金制プランの概要 - Power Platform | Microsoft Learn</a></p></div><div class="alert is-info"><p class="alert-title">Note</p><p>今後、アクション要求数の制限は「Power Platform 要求数の制限」になり、制限の集計単位が <strong>ユーザーごと</strong> へ移行する予定です。2023 年 5 月現在、移行時期は未定ですが、移行の予定があることをご留意ください。</p><p><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/api-request-limits-allocations">要求の制限と割り当て - Power Platform | Microsoft Learn</a></p></div><h3 id="フローのアクション要求数を数えてみる"><a href="#フローのアクション要求数を数えてみる" class="headerlink" title="フローのアクション要求数を数えてみる"></a>フローのアクション要求数を数えてみる</h3><p>「アクション要求数」は、大まかに言うと「実行されたアクションの数」です。実行したフローのアクション要求数は、フローごとの分析のページ、または Power Platform 管理センターで確認できます。</p><ul><li><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/power-automate-licensing/types#as-a-maker-what-tools-do-i-have-to-analyze-my-usage">作成者が使用状況を分析するためのどんなツールがありますか?</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/power-automate-licensing/types#as-an-admin-what-tools-do-i-have-to-analyze-my-environments-usage">管理者が環境の使用状況を分析するためのどのようなツールがありますか?</a></li></ul><p>※ フローの分析のページの例 (上記公開情報より)<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image15.png"></p><p>フローをまだ実行していない、または机上でアクション要求数を求めたい場合は、下記公開情報の Power Platform 要求数の数え方をご参照ください。(アクション要求数と Power Platform 要求数は数え方が同じです)  </p><p><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/power-automate-licensing/faqs#what-counts-as-power-platform-request">何が Power Platform 要求と見なされますか?</a></p><p>実際のアクション要求数は再試行やページングで増えるので、見積もりの時点でフローの制限値を超えている場合は、対策が必要です。</p><h2 id="改善策"><a href="#改善策" class="headerlink" title="改善策"></a>改善策</h2><h3 id="フローの実行回数を減らす"><a href="#フローの実行回数を減らす" class="headerlink" title="フローの実行回数を減らす"></a>フローの実行回数を減らす</h3><p>例えば、1 時間に 1 回起動するスケジュールトリガーを、2 時間に 1 回起動するよう変更します。1 番簡単に実施できて最も効果がありますので、実行頻度の削減はぜひご検討ください。</p><p>自動トリガーの場合は、トリガー条件を設定して不要な起動を抑えることで、フローの実行回数を減らせます。<br>フローの先頭で、「条件」や「終了」アクションを使ってフローを中断させている場合は、トリガー条件への置き換えをご検討ください。<br>トリガー条件の詳しい情報は、当サポート チームのブログでもご案内しています。</p><p><a href="/blog/powerautomate/cloudflow-trigger-condition/">クラウド フローのトリガー条件を設定してトリガーの実行を制御する方法 | Japan Dynamics CRM &amp; Power Platform Support Blog</a></p><h3 id="繰り返しの回数を減らす"><a href="#繰り返しの回数を減らす" class="headerlink" title="繰り返しの回数を減らす"></a>繰り返しの回数を減らす</h3><p>Apply to each や Do until で処理するデータが数百件、数千件に及ぶ場合は、その繰り返し回数を減らすことをご検討ください。以下に、繰り返し回数を減らすための案をご紹介します。</p><h4 id="フィルター-クエリを使う"><a href="#フィルター-クエリを使う" class="headerlink" title="フィルター クエリを使う"></a>フィルター クエリを使う</h4><p>繰り返しを行う前に対象のデータ件数を減らしておけば、繰り返しの回数を減らせます。<br>SharePoint コネクタの「複数の項目の取得」アクションなど、フィルター クエリを指定できるアクションでは、できる限りフィルター クエリを使用して不要なデータを取得しないようにしましょう。</p><p>※ フィルター クエリを使った例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image06.png"></p><p>参考：</p><ul><li>SharePoint<ul><li><a href="https://learn.microsoft.com/ja-jp/sharepoint/dev/business-apps/power-automate/guidance/working-with-get-items-and-get-files#filter-queries">フィルター クエリの例</a></li><li><a href="https://learn.microsoft.com/ja-jp/sharepoint/dev/sp-add-ins/use-odata-query-operations-in-sharepoint-rest-requests#odata-query-operators-supported-in-the-sharepoint-rest-service">SharePoint REST サービスでサポートされる OData クエリ演算子</a></li></ul></li><li>Excel<ul><li><a href="https://learn.microsoft.com/ja-jp/connectors/excelonlinebusiness/#known-issues-and-limitations-with-actions">Excel Online (Business) コネクタ アクションの既知の問題と制限</a><ul><li>「フィルタリング機能」の行に、サポートされる OData クエリの記載があります。</li></ul></li></ul></li><li>Dataverse<ul><li><a href="https://learn.microsoft.com/ja-jp/power-automate/dataverse/list-rows#filter-rows">行を一覧にする アクションの使用例</a></li><li><a href="https://learn.microsoft.com/ja-jp/power-apps/developer/data-platform/webapi/query-data-web-api#%E7%B5%90%E6%9E%9C%E3%81%AE%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%BC">Web API の観点での OData クエリの例</a></li></ul></li></ul><h4 id="アレイのフィルター処理を使う"><a href="#アレイのフィルター処理を使う" class="headerlink" title="アレイのフィルター処理を使う"></a>アレイのフィルター処理を使う</h4><p>フィルター クエリを使えない場合は、代わりに「データ操作」コネクタの「アレイのフィルター処理」アクションを使って、繰り返しを行う前にデータ件数を減らすことができます。</p><div class="alert is-info"><p class="alert-title">Note</p><p>繰り返しで実行されるアクション要求数の削減には役に立ちますが、データ件数や列数が多い場合は、コンテンツ スループットの制限に抵触してしまう可能性があります。</p></div><p>※ アレイのフィルター処理を使った例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image08.png"></p><p>「アレイのフィルター処理」アクションは、この他にも、処理が異なるリストをあらかじめ 2 つに分けておく、といった活用もできます。繰り返し処理内の「条件」アクションが必要なくなるので、アクション要求数の削減になります。</p><p>※ 処理が異なるリストを分けておく例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image09.png"></p><p>参考：<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-filter-array-action">Power Automate でデータ操作を使用する (ビデオを含む) - Power Automate | Microsoft Learn</a></p><h4 id="1-度に繰り返す回数を減らす"><a href="#1-度に繰り返す回数を減らす" class="headerlink" title="1 度に繰り返す回数を減らす"></a>1 度に繰り返す回数を減らす</h4><p>例えば、1 度に全件処理するのではなく、10 件の データを 1 時間に 1 回処理するよう設計します。</p><p>フローが制限に抵触しないよう、意図的に処理をゆっくりにする考え方です。フィルター クエリと合わせて使用し、未処理のデータだけを取得する必要があります。</p><p>※ 10 件だけ処理する例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image10.png"></p><h4 id="集計に-XPath-を活用する"><a href="#集計に-XPath-を活用する" class="headerlink" title="集計に XPath を活用する"></a>集計に XPath を活用する</h4><p>例えば SharePoint リストの特定の列の合計を求めたい場合、Power Automate には配列を 1 度に集計するようなアクションや関数が無いため、繰り返し処理で集計する必要があります。しかし、Power Automate の関数、xml と xpath を活用すると繰り返し処理無しで集計ができます。つまりアクション要求数の削減になります。<br>詳しい実現方法は以下の記事で解説しています。</p><p><a href="/blog/powerautomate/aggregation-using-xpath/">XPath を活用した集計 | Japan Dynamics CRM &amp; Power Platform Support Blog</a></p><h3 id="CSV-ファイルの利用を避ける"><a href="#CSV-ファイルの利用を避ける" class="headerlink" title="CSV ファイルの利用を避ける"></a>CSV ファイルの利用を避ける</h3><p>アクション要求数を削減する観点では、フローでの CSV ファイルの読み込みは避けることをお勧めします。Power Automate には CSV ファイルを 1 つのアクションで読み込むような機能はご用意がありません。そのため、CSV ファイルを読み込む処理を作りこむ必要があります。</p><p>参考：<a href="/blog/powerautomate/Import-Csv-With-Standard-Connectors/">Power Automate で CSV ファイルを取り込む | Japan Dynamics CRM &amp; Power Platform Support Blog</a></p><p>上記記事の例からも分かる通り、変数を用意して…条件分岐して…とやっているだけでアクション要求数を消費してしまいます。</p><p>アクション要求数を削減したい場合は、SharePoint リスト、Dataverse をはじめとしたデータベース、または、Excel ファイルなどの利用をお勧めします。これらは、各コネクタにデータ読み込みのためのアクションが用意されているため、読み込み処理を自分で作る必要がありません。</p><p>活用できるアクション：</p><ul><li>Microsoft Dataverse コネクタ<ul><li><a href="https://learn.microsoft.com/ja-jp/connectors/commondataserviceforapps/#%E8%A1%8C%E3%82%92%E4%B8%80%E8%A6%A7%E3%81%AB%E3%81%99%E3%82%8B">行を一覧にする</a></li></ul></li><li>SharePoint コネクタ<ul><li><a href="https://learn.microsoft.com/ja-jp/connectors/sharepointonline/#%E9%A0%85%E7%9B%AE%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B">複数の項目の取得</a></li></ul></li><li>Excel Online (Business) コネクタ<ul><li><a href="https://learn.microsoft.com/ja-jp/connectors/excelonlinebusiness/#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E5%86%85%E3%81%AB%E5%AD%98%E5%9C%A8%E3%81%99%E3%82%8B%E8%A1%8C%E3%82%92%E4%B8%80%E8%A6%A7%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B">表内に存在する行を一覧表示</a></li></ul></li></ul><h3 id="フローを分割する"><a href="#フローを分割する" class="headerlink" title="フローを分割する"></a>フローを分割する</h3><p>2023 年 5 月時点の Power Automate の制限は、<strong>フローごと</strong>の制限となっています。1 つの長いフローが制限に抵触しているのであれば、それをいくつかに分割して順番に実行させることで制限を回避できる可能性があります。</p><p>※ イメージ図<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image11.png"></p><p>注意点としては、非ソリューションフローの場合は子フローの実行などができないため、それぞれのフローの最後で、次のフローの起動トリガーとなるような処理をしてあげる必要があります。<br>例えば、1番目のフローの最後に SharePoint リストへの「項目の作成」アクションを実行し、2番目のフローの「項目が作成されたとき」トリガーでその SharePoint リストを指定すれば、フローをつなげて実行する仕組みになります。</p><h3 id="関数を活用する"><a href="#関数を活用する" class="headerlink" title="関数を活用する"></a>関数を活用する</h3><p>アクションを組み合わせて作った処理が、実は関数 1 つで実現できるものだったりすることがあります。<br>Power Automate には式の入力時に使用できる関数が色々ありますので、関数の一覧のページに目を通しておくだけでも、新しい発見があるかもしれません。</p><p><a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference">式関数のリファレンス ガイド - Azure Logic Apps | Microsoft Learn</a></p><p>意外と活用できる関数の例に、<a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#join">join</a> 関数があります。配列の全ての要素をくっつけて 1 つの文字列にする関数です。例えば、SharePoint リストに保存されているメールアドレスにメールを送りたいとき、行ごとのメールアドレスをセミコロンでくっつけて送信先アドレスとしたくなります。</p><p>※ イメージ図<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image12.png"></p><p>join 関数を使わなくても、Apply to each と「文字列変数に追加」アクションを使えばやりたいことは実現できます。しかし、これまでに解説したように、繰り返しの処理はアクション要求数が多くなりがちなので避けたいところです。</p><p>※ join 関数を使わない例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image13.png"></p><p>そこで、join 関数を使うと、2 つのアクションのみでメールアドレスをセミコロンでくっつけることができます。join 関数を使う前に「選択」アクションを使う必要がありますが、メールアドレスを 1 つずつ繋げるよりは手順が減ります。</p><p>※ join 関数を使う例<br><img src="/blog/powerautomate/troubleshoot-throttling-flow/image14.png"></p><p>このように、関数を使いこなせると、より効率のよいフローの作り方ができますし、それがアクション要求数を減らすことに繋がることがあります。</p><h3 id="ライセンスを購入する"><a href="#ライセンスを購入する" class="headerlink" title="ライセンスを購入する"></a>ライセンスを購入する</h3><p>最初にご案内したように、制限値はパフォーマンス プロファイルによって決まり、パフォーマンス プロファイルはライセンスによって決まります。<br>もしパフォーマンス プロファイル「低」で制限に抵触しているのであれば、パフォーマンスプロファイル「中」や「高」に該当するライセンスの利用をご検討ください。</p><h2 id="最後に"><a href="#最後に" class="headerlink" title="最後に"></a>最後に</h2><p>制限に抵触するほど Power Automate を活用いただいているのは嬉しい限りではありますが、サービスの特性を理解して上手く付き合っていただけますと、より嬉しく思います。<br>この記事が皆様の Power Automate の運用にお役に立ちましたら幸いです。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの瀬戸です。&lt;br&gt;今回は、「クラウド フローの処理がいつまで経っても終わらない」ときに試していただける改善策をご案内いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
  </entry>
  
  <entry>
    <title>XPath を活用した集計</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/aggregation-using-xpath/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/aggregation-using-xpath/</id>
    <published>2023-05-15T15:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.294Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの瀬戸です。<br>今回は、クラウド フローで、なるべく少ない手順で集計をしたいときに活用いただける Tips をご紹介いたします。</p><span id="more"></span><h2 id="基本的な集計方法"><a href="#基本的な集計方法" class="headerlink" title="基本的な集計方法"></a>基本的な集計方法</h2><p>例えば、下図のような数値の列を持つ SharePoint リストがあるとします。<br><img src="/blog/powerautomate/aggregation-using-xpath/image01.png"></p><p>この amount1、amount2 の列の合計を求めたい場合、素直に考えると Apply to each で数を集計することを考えます。</p><p>※ Apply to each を使った集計の例<br><img src="/blog/powerautomate/aggregation-using-xpath/image02.png"></p><p>合計値を求めるならこれでも良いのですが、この方法では、集計するだけで少なくとも リストの行数 × 集計したい列の数 の回数アクションが実行されます。データ件数が多いときや、他にもフローで行いたい処理があるときは、アクション要求数が気になってしまいます。</p><h2 id="XPath-を使った集計方法"><a href="#XPath-を使った集計方法" class="headerlink" title="XPath を使った集計方法"></a>XPath を使った集計方法</h2><p>XPath は、XML という形式のデータの位置を指定できる言語です。関数も用意されていて、集計 (sum) や個数のカウント (count) ができます。</p><p>Power Automate 上のデータは基本的に JSON 形式で扱われます。ですが、Power Automate には、JSON 形式を XML 形式へ変換する関数と、XPath の処理を行える関数がありますので、それらを使って集計を求められます。</p><p>以下に、XML と XPath を使って、先ほどの SharePoint リストを集計するサンプルを記載いたします。Apply to each を使用していない点にご注目ください。</p><h3 id="フローの例"><a href="#フローの例" class="headerlink" title="フローの例"></a>フローの例</h3><p>※フロー全体図<br><img src="/blog/powerautomate/aggregation-using-xpath/image03.png"></p><h4 id="1-複数の項目の取得"><a href="#1-複数の項目の取得" class="headerlink" title="(1) 複数の項目の取得"></a>(1) 複数の項目の取得</h4><p><img src="/blog/powerautomate/aggregation-using-xpath/image04.png"></p><p>SharePoint コネクタの「<a href="https://learn.microsoft.com/ja-jp/connectors/sharepointonline/#%E9%A0%85%E7%9B%AE%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B">複数の項目の取得</a>」アクションを使用し、リストを取得します。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>サイトのアドレス</td><td>リストがあるサイトを選択します。</td></tr><tr><td>リスト名</td><td>リストの名前を選択します。</td></tr></tbody></table><h4 id="2-選択"><a href="#2-選択" class="headerlink" title="(2) 選択"></a>(2) 選択</h4><p><img src="/blog/powerautomate/aggregation-using-xpath/image05.png"></p><p>データ操作コネクタの「<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-select-action">選択</a>」アクションを使用し、集計に必要な列のみの配列を作成します。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>開始</td><td>「(1) 複数の項目の取得」アクションの出力「value」</td></tr><tr><td>マップ</td><td>集計に必要な列の列名と値を指定します。</td></tr></tbody></table><p>この例では amount1 列と amount2 列を集計したいので、その2つを指定します。</p><table><thead><tr><th>マップ-キー</th><th>マップ-値</th></tr></thead><tbody><tr><td>amount1</td><td>「(1) 複数の項目の取得」アクションの出力「amount1」</td></tr><tr><td>amount2</td><td>「(1) 複数の項目の取得」アクションの出力「amount2」</td></tr></tbody></table><h4 id="3-作成1"><a href="#3-作成1" class="headerlink" title="(3) 作成1"></a>(3) 作成1</h4><p><img src="/blog/powerautomate/aggregation-using-xpath/image06.png"></p><p>データ操作コネクタの「<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-compose-action">作成</a>」アクションを使用し、配列をXML へ変換できる形へ整形します。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>入力</td><td><code>&#123;&quot;root&quot;: &#123;&quot;numbers&quot;:「(2) 選択」アクションの出力  &#125;&#125;</code></td></tr></tbody></table><p>XML はルート要素が 1 つという決まりがあるため、JSON のルートプロパティも 1 つにします。そして、ルート要素を配列にすることもできないため、もう 1 つ <code>numbers</code> というプロパティを加え、<code>numbers</code> を配列にします。</p><p>良い例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;root&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;numbers&quot;</span>: [</span><br><span class="line">       &#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">2</span> &#125;</span><br><span class="line">      ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">4</span> &#125;</span><br><span class="line">      ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">6</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上記の XML 変換後：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">numbers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount1</span>&gt;</span>1<span class="tag">&lt;/<span class="name">amount1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount2</span>&gt;</span>2<span class="tag">&lt;/<span class="name">amount2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">numbers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">numbers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount1</span>&gt;</span>3<span class="tag">&lt;/<span class="name">amount1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount2</span>&gt;</span>4<span class="tag">&lt;/<span class="name">amount2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">numbers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">numbers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount1</span>&gt;</span>5<span class="tag">&lt;/<span class="name">amount1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">amount2</span>&gt;</span>6<span class="tag">&lt;/<span class="name">amount2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">numbers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure><p>エラーになる例 1：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;root&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;numbers&quot;</span>: [</span><br><span class="line">       &#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">2</span> &#125;</span><br><span class="line">      ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">4</span> &#125;</span><br><span class="line">      ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">6</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">  ,<span class="attr">&quot;root2&quot;</span>: &#123; <span class="comment">// ルート要素が2つになってしまうので NG</span></span><br><span class="line">    <span class="attr">&quot;numbers&quot;</span> : []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>エラーになる例 2：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;root&quot;</span>: [ <span class="comment">// ルート要素は配列にできないので NG</span></span><br><span class="line">     &#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">1</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">2</span> &#125;</span><br><span class="line">    ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">3</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">4</span> &#125;</span><br><span class="line">    ,&#123; <span class="attr">&quot;amount1&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;amount2&quot;</span>: <span class="number">6</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-作成2"><a href="#4-作成2" class="headerlink" title="(4) 作成2"></a>(4) 作成2</h4><p>データ操作コネクタの「<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-compose-action">作成</a>」アクションを使用し、先のアクションの出力を XML へ変換します。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>入力</td><td>以下を式として入力：<br><code>xml(outputs(&#39;作成1&#39;))</code>　※1</td></tr></tbody></table><p>※1 「作成1」は「(3) 作成1」アクションのアクション名です。</p><p>参考 (xml 関数)：<a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#xml">https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#xml</a></p><h4 id="5-作成-amount1"><a href="#5-作成-amount1" class="headerlink" title="(5) 作成-amount1"></a>(5) 作成-amount1</h4><p>データ操作コネクタの「<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-compose-action">作成</a>」アクションを使用し、XML へ変換した内容と XPath を使用して amount1 列の集計を求めます。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>入力</td><td>以下を式として入力：<br><code>xpath(outputs(&#39;作成2&#39;), &#39;sum(/root/numbers/amount1)&#39;)</code>　※1</td></tr></tbody></table><p>※1 「作成2」は「(4) 作成2」アクションのアクション名です。</p><p>参考 (xpath 関数)：<a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#xpath">https://learn.microsoft.com/ja-jp/azure/logic-apps/workflow-definition-language-functions-reference#xpath</a></p><h4 id="6-作成-amount2"><a href="#6-作成-amount2" class="headerlink" title="(6) 作成-amount2"></a>(6) 作成-amount2</h4><p>データ操作コネクタの「<a href="https://learn.microsoft.com/ja-jp/power-automate/data-operations#use-the-compose-action">作成</a>」アクションを使用し、amount1 と同じく amount2 の集計を求めます。</p><table><thead><tr><th>パラメータ</th><th>値</th></tr></thead><tbody><tr><td>入力</td><td>以下を式として入力：<br><code>xpath(outputs(&#39;作成2&#39;), &#39;sum(/root/numbers/amount2)&#39;)</code>　※1</td></tr></tbody></table><p>※1 「作成2」は「(4) 作成2」アクションのアクション名です。</p><p>実行結果：</p><p><img src="/blog/powerautomate/aggregation-using-xpath/image07.png"></p><p>amout1 と amount2 の集計を求められました。</p><h2 id="最後に"><a href="#最後に" class="headerlink" title="最後に"></a>最後に</h2><p>ローコード ツールである Power Automate はできることが少ないと思いがちですが、やりたいことを意外な方法で解決できることもあります。ぜひご活用ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの瀬戸です。&lt;br&gt;今回は、クラウド フローで、なるべく少ない手順で集計をしたいときに活用いただける Tips をご紹介いたします。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
  </entry>
  
  <entry>
    <title>クラウド フローとオンプレミス環境間でデータ連携する方法</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/gateway-install/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/gateway-install/</id>
    <published>2023-05-08T03:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.310Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートの林です。<br>本記事では クラウド フローとオンプレミス環境間でデータ連携する方法と、一例としてローカル ファイルをクラウド フローで扱う方法についてもご紹介します。  </p><span id="more"></span><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>クラウド フローはクラウド サービスの自動化を実現するイメージをお持ちの方が多いのですが、オンプレミス環境と通信することもできます。クラウド フローとの通信を実現するには、オンプレミス環境のローカル マシンにオンプレミス データ ゲートウェイ (以下、ゲートウェイ) をインストールします。</p><p>これによりローカル ファイルが格納されたことをトリガーにクラウド フローを実行することや、クラウド フローで扱ったファイルをローカル マシンに保存することができます。その他、ローカル マシンから接続できるデータソース (SQL Server や Oracleなど) のデータ操作もできるようになります。  </p><p>今回はローカル マシンにファイルが格納されたことをトリガーにクラウド フローで SharePoint のドキュメント ライブラリにファイルを格納する方法をご紹介させていただきます。  </p><ol><li><a href="#install">ゲートウェイのインストール方法</a>  </li><li><a href="#filesystem">利用例) ファイルシステムコネクタを利用したフローの構築</a>  </li><li><a href="#trouble-shooting">よくあるトラブル</a>  </li><li><a href="#faq">FAQ</a>  </li></ol><hr><p><a id='install'></a></p><h2 id="ゲートウェイのインストール方法"><a href="#ゲートウェイのインストール方法" class="headerlink" title="ゲートウェイのインストール方法"></a>ゲートウェイのインストール方法</h2><h3 id="1-前提"><a href="#1-前提" class="headerlink" title="1. 前提"></a>1. 前提</h3><ol><li><p>要件<br>Windows 8 以降、Windows Server 2012 R2 以降の端末にインストールできます。詳細は以下の公開情報をご確認いただき、要件を満たしているかご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-install#requirements">オンプレミス データ ゲートウェイをインストールする | Microsoft Learn</a>   </p></li><li><p>必要なエンド ポイント<br>ゲートウェイは送信ポートのみを利用してクラウドサービスと通信します。<br>以下の公開情報をご確認いただき、送信ポートから全てのエンド ポイントに接続できる状態となっているかご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-communication#ports">オンプレミス データ ゲートウェイの通信設定を調整する | Microsoft Learn</a>  </p></li><li><p>有償ライセンス<br>ゲートウェイのインストール自体にライセンス要件はありません。ただし、ゲートウェイを Power Automate、Power Apps で利用するには、Microsoft 365 のライセンスでは利用できず、Power Platform の有償ライセンスが必要となります。<br>有償ライセンスについては以下をご確認ください。<br>・<a href="https://powerautomate.microsoft.com/ja-jp/pricing/">Power Automate の有償ライセンス</a><br>・<a href="https://powerapps.microsoft.com/ja-jp/pricing/">Power Apps の有償ライセンス</a>  </p></li></ol><h3 id="2-ゲートウェイをインストールする"><a href="#2-ゲートウェイをインストールする" class="headerlink" title="2. ゲートウェイをインストールする"></a>2. ゲートウェイをインストールする</h3><p>ゲートウェイをダウンロードしインストールします。手順については、以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-install#download-and-install-a-standard-gateway">オンプレミス データ ゲートウェイをインストールする | Microsoft Learn</a>  </p><h5 id="補足事項"><a href="#補足事項" class="headerlink" title="補足事項"></a>補足事項</h5><ul><li><p>設定時にメール アドレスを入力しますが、入力したアドレスのユーザーが管理者となります。管理者はゲートウェイの利用者の追加、複数のゲートウェイをクラスター化する権限を有します。<br><img src="/blog/powerautomate/gateway-install/address.png">  </p></li><li><p>ゲートウェイの登録情報はクラウド上に記録されます。テナントが日本の場合、登録先リージョン(以下、赤枠) が Japan East と表示されているかご確認ください。仮に、Power Platform のリージョンと異なっている場合、ゲートウェイが認識されず利用できないため、ご注意ください。<br><img src="/blog/powerautomate/gateway-install/region.png">  </p></li></ul><h3 id="3-プロキシ設定をする"><a href="#3-プロキシ設定をする" class="headerlink" title="3. プロキシ設定をする"></a>3. プロキシ設定をする</h3><p>プロキシ サーバー経由でネットワーク通信をする必要がある場合、インストールされた設定ファイルを修正します。修正対象、修正内容は以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-proxy">オンプレミス データ ゲートウェイのプロキシ設定を構成する | Microsoft Learn</a></p><hr><p><a id='filesystem'></a></p><h2 id="利用例-ファイルシステムコネクタを利用したフローの構築"><a href="#利用例-ファイルシステムコネクタを利用したフローの構築" class="headerlink" title="利用例) ファイルシステムコネクタを利用したフローの構築"></a>利用例) ファイルシステムコネクタを利用したフローの構築</h2><p>サンプルとして、以下のフォルダに追加されたファイルを SharePoint のドキュメント ライブラリに格納します。<br><img src="/blog/powerautomate/gateway-install/folder.png">  </p><h3 id="1-ファイルシステムコネクタの接続作成"><a href="#1-ファイルシステムコネクタの接続作成" class="headerlink" title="1. ファイルシステムコネクタの接続作成"></a>1. ファイルシステムコネクタの接続作成</h3><p>Power Automate ポータルの接続メニューからファイル システム コネクタの接続を作成します。<br><img src="/blog/powerautomate/gateway-install/connection.png">  </p><table><thead><tr><th>パラメータ名</th><th>値</th></tr></thead><tbody><tr><td>Root folder</td><td>連携したいファイルの親フォルダを指定します。アクションにてサブフォルダを指定することができます。</td></tr><tr><td>Authentication Type</td><td>Windows 固定</td></tr><tr><td>Username</td><td>Windowsにログインする際のドメイン名とユーザー名を「ドメイン名\ユーザー名」の形式でご指定ください。<br>端末にログオンしているユーザーのドメインとユーザーの名は whoami コマンドから確認いただけます。<br>※ Power Automate のログインアカウントではございませんので、ご注意ください。<br>※ ドメイン名とユーザー名の間は \ (バックスラッシュ)です。/ (スラッシュ) ではない点ご注意ください。</td></tr><tr><td>Password</td><td>上記で指定したユーザーのパスワードをご指定ください。</td></tr><tr><td>ゲートウェイの選択</td><td>インストールしたゲートウェイを選択ください。</td></tr></tbody></table><h3 id="2-クラウド-フローの作成"><a href="#2-クラウド-フローの作成" class="headerlink" title="2. クラウド フローの作成"></a>2. クラウド フローの作成</h3><h5 id="全体図"><a href="#全体図" class="headerlink" title="全体図"></a>全体図</h5><p>クラウド フローの全体図です。<br><img src="/blog/powerautomate/gateway-install/overview.png">  </p><h4 id="1-ファイルが作成されたことをトリガーに起動"><a href="#1-ファイルが作成されたことをトリガーに起動" class="headerlink" title="(1) ファイルが作成されたことをトリガーに起動"></a>(1) ファイルが作成されたことをトリガーに起動</h4><p>ファイル システム コネクタの「<a href="https://learn.microsoft.com/ja-jp/connectors/filesystem/#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E4%BD%9C%E6%88%90%E3%81%95%E3%82%8C%E3%81%9F%E3%81%A8%E3%81%8D-(%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%81%AE%E3%81%BF)">ファイルが作成されたとき (プロパティのみ)</a>」トリガーを使用します。<br><img src="/blog/powerautomate/gateway-install/trigger.png">  </p><table><thead><tr><th>パラメータ名</th><th>値</th></tr></thead><tbody><tr><td>フォルダー</td><td>接続で指定した Root folder 配下のトリガー対象のフォルダを指定します。<br>対象フォルダのサブフォルダ内にファイルが追加された場合はトリガーしないので注意してください。</td></tr></tbody></table><h4 id="2-ファイルコンテンツの取得"><a href="#2-ファイルコンテンツの取得" class="headerlink" title="(2) ファイルコンテンツの取得"></a>(2) ファイルコンテンツの取得</h4><p>ファイル システム コネクタの「<a href="https://learn.microsoft.com/ja-jp/connectors/filesystem/#%E3%83%91%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB-%E3%82%B3%E3%83%B3%E3%83%86%E3%83%B3%E3%83%84%E3%82%92%E5%8F%96%E5%BE%97">パスを使用してファイル コンテンツを取得</a>」アクションを使用します。<br><img src="/blog/powerautomate/gateway-install/filecontents.png"></p><table><thead><tr><th>パラメータ名</th><th>値</th></tr></thead><tbody><tr><td>ファイルパス</td><td>追加したファイルのファイル コンテンツを取得します。ファイル パスにはトリガーで取得した “Path” を指定します。</td></tr></tbody></table><h4 id="3-SharePoint-のドキュメント-ライブラリにファイルを格納"><a href="#3-SharePoint-のドキュメント-ライブラリにファイルを格納" class="headerlink" title="(3) SharePoint のドキュメント ライブラリにファイルを格納"></a>(3) SharePoint のドキュメント ライブラリにファイルを格納</h4><p>SharePoint コネクタの「<a href="https://learn.microsoft.com/ja-jp/connectors/sharepointonline/#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E4%BD%9C%E6%88%90">ファイルの作成</a>」アクションを使用します。<br><img src="/blog/powerautomate/gateway-install/filecreate.png"></p><table><thead><tr><th>パラメータ名</th><th>値</th></tr></thead><tbody><tr><td>サイトのアドレス</td><td>任意のサイトを指定してください。</td></tr><tr><td>フォルダーのパス</td><td>格納先のパスを指定してください。</td></tr><tr><td>ファイル名</td><td>トリガーで取得した “Name” を指定します。</td></tr><tr><td>ファイル コンテンツ</td><td>「パスによるファイル コンテンツ」で取得した”ファイル コンテンツ”を指定します。</td></tr></tbody></table><p>フローの各アクションの設定は以上です。  </p><hr><p><a id='trouble-shooting'></a></p><h2 id="よくあるトラブル"><a href="#よくあるトラブル" class="headerlink" title="よくあるトラブル"></a>よくあるトラブル</h2><h3 id="Q-ゲートウェイがオフラインのままで利用できない"><a href="#Q-ゲートウェイがオフラインのままで利用できない" class="headerlink" title="Q. ゲートウェイがオフラインのままで利用できない"></a>Q. ゲートウェイがオフラインのままで利用できない</h3><p>ゲートウェイがオフラインとなる原因はいくつかあります。よくある原因としては、以下の通りです。また最新バージョンのご利用や、再インストールを実施いただくことでも解消することがございますので、ぜひお試しください。  </p><ol><li><p>ネットワーク要件を満たしていない<br>以下の公開情報をご確認いただき、送信ポートから全てのエンドポイントに接続できる状態となっているかご確認ください。その際、マシンからのネットワークとして、プロキシ サーバーをご利用の場合はプロキシ サーバーにて通信可能となっているかも併せてご確認下さい。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-communication#ports">オンプレミス データ ゲートウェイの通信設定を調整する | Microsoft Learn</a>  </p></li><li><p>プロキシの設定がされていない<br>プロキシ サーバー経由でネットワーク通信をする必要がある場合、インストールされた設定ファイルを修正します。修正対象、修正内容は以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-proxy">オンプレミス データ ゲートウェイのプロキシ設定を構成する | Microsoft Learn</a>  </p></li><li><p>ゲートウェイのサービスが起動していない<br>以下の On-premises data gateway service サービスが起動しているかご確認いただき、起動していない場合は起動します。<br><img src="/blog/powerautomate/gateway-install/service.png">  </p></li></ol><h3 id="Q-ゲートウェイをインストールしたにもかかわらず、接続作成時に表示されない"><a href="#Q-ゲートウェイをインストールしたにもかかわらず、接続作成時に表示されない" class="headerlink" title="Q. ゲートウェイをインストールしたにもかかわらず、接続作成時に表示されない"></a>Q. ゲートウェイをインストールしたにもかかわらず、接続作成時に表示されない</h3><ol><li><p>ゲートウェイの登録先リージョンが異なっている<br>ゲートウェイはインストールすることでクラウド側に登録されますが、Power Platform のリージョンと同じリージョンに存在していないと表示されません。リージョンの確認方法と対応方法については以下の公開情報をご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/troubleshoot/power-platform/power-automate/check-if-gateway-is-the-right-region">ゲートウェイが適切なリージョンにあるかどうかを確認する - Power Automate | Microsoft Learn</a>  </p></li><li><p>ゲートウェイが共有されていない<br>ゲートウェイは管理者以外でも共有することでご利用できます。ゲートウェイの共有は Power Platform 管理センターから実施可能です。ゲートウェイの共有方法は以下の公開情報をご確認下さい。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/onpremises-data-gateway-management#manage-users">オンプレミスのデータ ゲートウェイの表示と管理 (プレビュー) - Power Platform | Microsoft Learn</a><br><br>現在、ユーザーへの共有時に指定できるカテゴリは以下の通りです。 </p></li></ol><table><thead><tr><th>カテゴリ</th><th>説明</th></tr></thead><tbody><tr><td>接続作成機能</td><td>データ ソースの接続作成時に当該ゲートウェイを指定することができます。</td></tr><tr><td>再共有による接続作成機能</td><td>接続作成機能に加え、ゲートウェイを共有することができます。</td></tr><tr><td>管理者</td><td>ゲートウェイの作成、削除、利用を含めたフルコントロール権限を有することができます。カスタムコネクタをゲートウェイ経由でご利用する場合は、管理者のカテゴリを指定して共有する必要があるのでご注意ください。</td></tr></tbody></table><h3 id="Q-ゲートウェイでデータ-ソース間の通信が失敗する様になった"><a href="#Q-ゲートウェイでデータ-ソース間の通信が失敗する様になった" class="headerlink" title="Q. ゲートウェイでデータ ソース間の通信が失敗する様になった"></a>Q. ゲートウェイでデータ ソース間の通信が失敗する様になった</h3><p>ゲートウェイ経由でのデータ ソースとの通信が失敗となる原因はいくつかあります。よくある原因としては、以下の通りです。エラー メッセージにも出ていることが多いので、ご確認をお願いします。  </p><ol><li>ゲートウェイがオフラインとなっている  </li><li>データ ソースが起動していない  </li><li>データ ソース側の認証情報が変わった  </li></ol><h3 id="上記以外のトラブルについては以下の公開情報もご参照ください"><a href="#上記以外のトラブルについては以下の公開情報もご参照ください" class="headerlink" title="上記以外のトラブルについては以下の公開情報もご参照ください"></a>上記以外のトラブルについては以下の公開情報もご参照ください</h3><p> <a href="https://learn.microsoft.com/ja-jp/data-integration/gateway/service-gateway-tshoot">オンプレミス データ ゲートウェイのトラブルシューティング | Microsoft Learn</a>  </p><hr><p><a id='faq'></a></p><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="Q-ゲートウェイは自動でバージョンアップされますか"><a href="#Q-ゲートウェイは自動でバージョンアップされますか" class="headerlink" title="Q. ゲートウェイは自動でバージョンアップされますか"></a>Q. ゲートウェイは自動でバージョンアップされますか</h3><p>自動ではバージョンアップされません。Microsoft は最新の 6 リリースのみを積極的にサポートしています。月に一度程度バージョン アップされるため、定期的なバージョン アップをお勧めいたします。  </p><h3 id="Q-ゲートウェイ利用時はアプリの起動が必要ですか"><a href="#Q-ゲートウェイ利用時はアプリの起動が必要ですか" class="headerlink" title="Q. ゲートウェイ利用時はアプリの起動が必要ですか"></a>Q. ゲートウェイ利用時はアプリの起動が必要ですか</h3><p>不要です。マシン起動と同時に必要なサービスが立ち上がるため、インストール後はゲートウェイを利用するための操作は不要です。  </p><h3 id="Q-ゲートウェイを利用して接続できるデータ-ソースは何ですか"><a href="#Q-ゲートウェイを利用して接続できるデータ-ソースは何ですか" class="headerlink" title="Q. ゲートウェイを利用して接続できるデータ ソースは何ですか"></a>Q. ゲートウェイを利用して接続できるデータ ソースは何ですか</h3><p>2023/5/8 現時点では以下のデータ ソースがご利用いただけます。また、カスタム コネクタについてもゲートウェイ経由で利用できます。  </p><ul><li>Apache Impala</li><li>BizTalk Server</li><li>ファイル システム</li><li>HTTP with Azure AD</li><li>IBM DB2</li><li>IBM Informix</li><li>IBM MQ</li><li>MySQL</li><li>Oracle データベース</li><li>PostgreSQL</li><li>SAP</li><li>SharePoint Server</li><li>SQL Server</li><li>Teradata</li></ul><p><a href="https://learn.microsoft.com/ja-jp/azure/logic-apps/logic-apps-gateway-connection?WT.mc_id=Portal-Microsoft_Azure_EMA">オンプレミス データ ソースに接続する - Azure Logic Apps | Microsoft Learn</a>  </p><h3 id="Q-利用可能なデータ-ソースを制限することはできますか"><a href="#Q-利用可能なデータ-ソースを制限することはできますか" class="headerlink" title="Q. 利用可能なデータ ソースを制限することはできますか"></a>Q. 利用可能なデータ ソースを制限することはできますか</h3><p>ゲートウェイ共有時に、利用可能なデータ ソースのみ指定することができます。<br><img src="/blog/powerautomate/gateway-install/restrictdatasource.png">  </p><h3 id="上記以外の-FAQ-については以下の公開情報もご参照ください"><a href="#上記以外の-FAQ-については以下の公開情報もご参照ください" class="headerlink" title="上記以外の FAQ については以下の公開情報もご参照ください"></a>上記以外の FAQ については以下の公開情報もご参照ください</h3><p> <a href="https://learn.microsoft.com/ja-jp/power-bi/connect-data/service-gateway-power-bi-faq">オンプレミス データ ゲートウェイに関するよく寄せられる質問 (FAQ) - Power BI | Microsoft Learn</a></p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートの林です。&lt;br&gt;本記事では クラウド フローとオンプレミス環境間でデータ連携する方法と、一例としてローカル ファイルをクラウド フローで扱う方法についてもご紹介します。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="Cloud flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Cloud-flow/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
    <category term="オンプレミス データ ゲートウェイ" scheme="https://jpdynamicscrm.github.io/blog/tags/%E3%82%AA%E3%83%B3%E3%83%97%E3%83%AC%E3%83%9F%E3%82%B9-%E3%83%87%E3%83%BC%E3%82%BF-%E3%82%B2%E3%83%BC%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A4/"/>
    
  </entry>
  
  <entry>
    <title>テーブルのリレーションシップとカスケード</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerplatform/table-relationship-behavior/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerplatform/table-relationship-behavior/</id>
    <published>2023-04-21T03:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.482Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Power Platform サポートチーム鈴木です。  </p><p>Dataverse のテーブルとテーブルは、1:N、もしくは N:N の関連付けが可能です。<br>関連付けされたテーブル定義のことを、リレーションシップと呼びますが、今回はテーブル間のリレーションシップにおける、カスケード (伝播) 処理について、具体的な動作とともにご紹介します。  </p><span id="more"></span><h2 id="リレーションシップの確認"><a href="#リレーションシップの確認" class="headerlink" title="リレーションシップの確認"></a>リレーションシップの確認</h2><hr><p>テーブル間のリレーションシップの作成、変更、確認は、Power Apps にてテーブル &gt; リレーションシップから確認できます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image001.png">  </p><p>1:N の 1 側のテーブルから確認する場合も、N 側のテーブルから確認する場合も同じで、どちらか一方で設定を変更した場合は、もう一方の設定に引き継がれます。  </p><h2 id="カスケード設定について"><a href="#カスケード設定について" class="headerlink" title="カスケード設定について"></a>カスケード設定について</h2><hr><p>各リレーションシップのカスケード処理は、リレーションシップをクリックして表示される詳細オプションから確認できます。  </p><p>動作の種類と選択可能なカスケード処理は、以下の通りです。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image002.png"><br>    <img src="/blog/powerplatform/table-relationship-behavior/image003.png">  </p><h3 id="親子-上位下位"><a href="#親子-上位下位" class="headerlink" title="親子(上位下位)"></a>親子(上位下位)</h3><p>リレーションシップが親子に設定されているときは、親レコードから子レコードへすべての処理がカスケードされます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image004.png">  </p><h3 id="参照"><a href="#参照" class="headerlink" title="参照"></a>参照</h3><p>リレーションシップが参照に設定されているときは、削除処理のみ「リンクの削除」か「制限」を選択できます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image005.png">  </p><h3 id="カスタム"><a href="#カスタム" class="headerlink" title="カスタム"></a>カスタム</h3><p>リレーションシップがカスタムに設定されているときは、各処理を自由に定義できます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image006.png">  </p><h2 id="カスケード設定の各動作について"><a href="#カスケード設定の各動作について" class="headerlink" title="カスケード設定の各動作について"></a>カスケード設定の各動作について</h2><hr><p>各カスケード処理について 1:N の場合の動作を説明します。  </p><h3 id="削除"><a href="#削除" class="headerlink" title="削除"></a>削除</h3><hr><p>1 側のレコードを削除したときに、関連付けられた N 側のレコードはどうなるでしょうか？  </p><h4 id="・すべてにカスケード"><a href="#・すべてにカスケード" class="headerlink" title="・すべてにカスケード"></a>・すべてにカスケード</h4><p>1 側のレコードを削除すると、N 側のレコードも削除されます。  </p><h4 id="・リンクの削除"><a href="#・リンクの削除" class="headerlink" title="・リンクの削除"></a>・リンクの削除</h4><p>1 側のレコードを削除すると、N 側のレコードは削除されませんが、関連付けが解除されます。<br>つまり 1 側の参照先をもたない、N 側のレコードが残ります。  </p><h4 id="・制限"><a href="#・制限" class="headerlink" title="・制限"></a>・制限</h4><p>1側のレコードを削除しようとすると、関連付けられた N 側のレコードが存在するため、削除できません。<br>以下のようなエラーメッセージが表示されます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image007.png">  </p><h3 id="割り当て"><a href="#割り当て" class="headerlink" title="割り当て"></a>割り当て</h3><hr><p>1 側のレコードの所有者を変更したときに、関連付けられた N 側の所有者はどうなるでしょうか？  </p><h4 id="・すべてにカスケード-1"><a href="#・すべてにカスケード-1" class="headerlink" title="・すべてにカスケード"></a>・すべてにカスケード</h4><p>1 側のレコードの所有者を変更すると、N 側のレコードの所有者も 1 側と同じ所有者に変更されます。<br>※変更する所有者にN側のアクセス権がない場合は、1 側の所有者として指定することはできません。  </p><h4 id="・アクティブにカスケード"><a href="#・アクティブにカスケード" class="headerlink" title="・アクティブにカスケード"></a>・アクティブにカスケード</h4><p>1 側のレコードの所有者を変更すると、N 側のアクティブレコードの所有者は、1 側と同じ所有者に変更されます。<br>N 側が非アクティブレコードだった場合は、N 側のレコードの所有者は変更されません。<br>※変更する所有者に N 側のアクセス権がない場合は、1 側の所有者として指定することはできません。  </p><h4 id="・ユーザー所有にカスケード"><a href="#・ユーザー所有にカスケード" class="headerlink" title="・ユーザー所有にカスケード"></a>・ユーザー所有にカスケード</h4><p>1 側のレコードの所有者を変更すると、N 側のレコードの所有者が 1 側の元の所有者と同じだった場合は、1 側と同じ所有者に変更されます。<br>N 側が 1 側のレコードの元の所有者と異なる場合は、N 側のレコードの所有者は変更されません。<br>※変更する所有者に N 側のアクセス権がない場合は、1 側の所有者として指定することはできません。  </p><h4 id="・カスケードなし"><a href="#・カスケードなし" class="headerlink" title="・カスケードなし"></a>・カスケードなし</h4><p>1 側のレコードの所有者を変更しても、N 側のレコードの所有者は変更されません。  </p><h3 id="共有"><a href="#共有" class="headerlink" title="共有"></a>共有</h3><hr><p>テーブルにアクセス権のないユーザーやチームに対して、レコード毎に共有設定を行うことができます。<br>レコードの 共有 &gt; アクセスの管理 から設定できます。<br>    <img src="/blog/powerplatform/table-relationship-behavior/image008.png"><br>    <img src="/blog/powerplatform/table-relationship-behavior/image009.png">  </p><p>では、1 側のレコードを他者 (ユーザー A) に共有した場合、関連付けられた N 側のレコードへのアクセス権はどうなるでしょうか？  </p><h4 id="・すべてにカスケード-2"><a href="#・すべてにカスケード-2" class="headerlink" title="・すべてにカスケード"></a>・すべてにカスケード</h4><p>1 側のレコードをユーザー A に共有すると、ユーザー A は N 側のレコードにもアクセス権をもちます。<br>例えば、1 側に読み込み、書き込み特権を付けると、N 側のレコードにも同じく読み込み、書き込み特権をもちます。  </p><div class="alert is-success"><p class="alert-title">ヒント</p><p>1 側の共有設定 (共有設定から確認できます。)</p><p>    <img src="/blog/powerplatform/table-relationship-behavior/image010.png">  </p><p>N 側のアクセス権 (アクセスの確認からユーザーを検索して確認できます。)</p><p>    <img src="/blog/powerplatform/table-relationship-behavior/image011.png">  </p></div><h4 id="・アクティブにカスケード-1"><a href="#・アクティブにカスケード-1" class="headerlink" title="・アクティブにカスケード"></a>・アクティブにカスケード</h4><p>1 側のレコードをユーザー A に共有すると、ユーザー A は N 側のアクティブレコードにもアクセス権をもちます。<br>N 側が非アクティブレコードだった場合、ユーザー A は N 側のレコードのアクセス権をもちません。  </p><h4 id="・ユーザー所有にカスケード-1"><a href="#・ユーザー所有にカスケード-1" class="headerlink" title="・ユーザー所有にカスケード"></a>・ユーザー所有にカスケード</h4><p>1 側のレコードのユーザー A に共有すると、N 側のレコードの所有者が 1 側の元の所有者と同じだった場合、ユーザー A は N 側のレコードにもアクセス権をもちます。<br>N 側が 1 側のレコードの元の所有者と異なる場合は、1 側のレコードをユーザー A に共有しても、ユーザー A は N 側のレコードのアクセス権をもちません。  </p><h4 id="・カスケードなし-1"><a href="#・カスケードなし-1" class="headerlink" title="・カスケードなし"></a>・カスケードなし</h4><p>1 側のレコードをユーザー A に共有しても、ユーザー A は、N 側のレコードのアクセス権をもちません。  </p><h3 id="共有の解除"><a href="#共有の解除" class="headerlink" title="共有の解除"></a>共有の解除</h3><hr><p>1 側のレコードを他者 (ユーザー A) に共有し、その後共有を解除すると、関連付けられた N 側のレコードへのアクセス権はどうなるでしょうか？<br>※共有設定はカスケードされる設定を想定しています。  </p><h4 id="・すべてにカスケード-3"><a href="#・すべてにカスケード-3" class="headerlink" title="・すべてにカスケード"></a>・すべてにカスケード</h4><p>1 側のレコードをユーザー A に共有し、その後共有解除すると、ユーザー A は N 側のレコードのアクセス権も解除され、アクセスできません。  </p><h4 id="・アクティブにカスケード-2"><a href="#・アクティブにカスケード-2" class="headerlink" title="・アクティブにカスケード"></a>・アクティブにカスケード</h4><p>1 側のレコードをユーザー A に共有し、その後共有解除すると、ユーザー A は N 側のアクティブレコードのアクセス権も解除され、アクセスできません。<br>N 側が非アクティブレコードだった場合、ユーザー A は N 側のレコードのアクセス権をもち続けます。  </p><h4 id="・ユーザー所有にカスケード-2"><a href="#・ユーザー所有にカスケード-2" class="headerlink" title="・ユーザー所有にカスケード"></a>・ユーザー所有にカスケード</h4><p>1 側のレコードをユーザー A に共有し、その後共有解除すると、N 側のレコードの所有者が 1 側の元の所有者と同じだった場合、ユーザー A は N 側のレコードのアクセス権も解除され、アクセスできません。<br>N 側が 1 側のレコードの元の所有者と異なる場合は、1 側のレコードをユーザー A に共有し、その後共有解除しても、ユーザー A は N 側のレコードのアクセス権をもち続けます。  </p><h4 id="・カスケードなし-2"><a href="#・カスケードなし-2" class="headerlink" title="・カスケードなし"></a>・カスケードなし</h4><p>1 側のレコードをユーザー A に共有し、その後共有解除しても、ユーザー A は N 側のレコードのアクセス権をもち続けます。  </p><h3 id="親の関連付けの再設定-リペアレント"><a href="#親の関連付けの再設定-リペアレント" class="headerlink" title="親の関連付けの再設定(リペアレント)"></a>親の関連付けの再設定(リペアレント)</h3><hr><p>「1 側に N 側のレコードを関連付けする設定時」に N 側レコードへのアクセスに対して、1 側レコードのものを継承させるかどうか、という設定になります。<br>「共有」と「親の関連付けの再設定」の違いは、「共有」は「1 側のレコードで共有設定を行ったときにすでに関連づけられている N 側レコードに対して共有を継承させるかどうか」であることに対して、「親の関連付けの再設定」は「1 側のレコードで N 側レコードに対する関連付けを行ったときに存在する共有設定を N 側レコードに対して継承させるかどうか」です。  </p><p>では、1 側のレコードをすでに他者 (ユーザー A) に共有している場合、共有設定後に関連付けられた N 側のレコードへのアクセス権はどうなるでしょうか？  </p><h4 id="・すべてにカスケード-4"><a href="#・すべてにカスケード-4" class="headerlink" title="・すべてにカスケード"></a>・すべてにカスケード</h4><p>1 側のレコードに N 側のレコードを関連付けると、ユーザー A は N 側のレコードにアクセスできます。  </p><h4 id="・アクティブにカスケード-3"><a href="#・アクティブにカスケード-3" class="headerlink" title="・アクティブにカスケード"></a>・アクティブにカスケード</h4><p>1 側のレコードに N 側のレコードを関連付けると、ユーザー A は N 側のアクティブなレコードにアクセスできます。<br>N 側が非アクティブレコードだった場合、ユーザー A は N 側のレコードのアクセス権をもちません。  </p><h4 id="・ユーザー所有にカスケード-3"><a href="#・ユーザー所有にカスケード-3" class="headerlink" title="・ユーザー所有にカスケード"></a>・ユーザー所有にカスケード</h4><p>1 側のレコードに N 側のレコードを関連付けると、N 側のレコードの所有者が 1 側の元の所有者と同じだった場合、ユーザー A は N 側のレコードにもアクセス権をもちます。<br>N 側が 1 側のレコードの元の所有者と異なる場合は、1 側のレコードをユーザー A に共有しても、ユーザー A は N 側のレコードのアクセス権をもちません。  </p><h4 id="・カスケードなし-3"><a href="#・カスケードなし-3" class="headerlink" title="・カスケードなし"></a>・カスケードなし</h4><p>1 側のレコードに N 側のレコードを関連付けても、ユーザー A は N 側のレコードのアクセス権をもちません。  </p><h2 id="よくあるご質問"><a href="#よくあるご質問" class="headerlink" title="よくあるご質問"></a>よくあるご質問</h2><hr><h4 id="・カスケード処理の「共有」を「すべてにカスケード」から「カスケードなし」に変更しました。既存の共有設定はどうなりますか？"><a href="#・カスケード処理の「共有」を「すべてにカスケード」から「カスケードなし」に変更しました。既存の共有設定はどうなりますか？" class="headerlink" title="・カスケード処理の「共有」を「すべてにカスケード」から「カスケードなし」に変更しました。既存の共有設定はどうなりますか？"></a>・カスケード処理の「共有」を「すべてにカスケード」から「カスケードなし」に変更しました。既存の共有設定はどうなりますか？</h4><p>カスケード処理変更前に既に共有されたレコードは、既に共有レコードを管理するテーブルに共有情報が登録されているため、カスケード処理を変更しても動作が変わりません。<br>カスケード処理変更前に共有されたレコードは、一度共有を解除し、再度共有設定することで、変更後のカスケード処理を伝播します。<br>注意事項として、「共有の解除」が「カスケードなし」の設定になっている場合には共有解除したことがカスケードされないため、再共有した場合に N 側レコードの参照ができてしまいます。<br>これを防ぐためには、「共有の解除」は「カスケード」される設定にしておく必要があります。  </p><h4 id="・1-側のレコードの所有者がユーザー-A-で、N-側のレコードの所有者がユーザー-B-です。ユーザー-A-は-N-側のレコードへアクセス権をもちますか？"><a href="#・1-側のレコードの所有者がユーザー-A-で、N-側のレコードの所有者がユーザー-B-です。ユーザー-A-は-N-側のレコードへアクセス権をもちますか？" class="headerlink" title="・1 側のレコードの所有者がユーザー A で、N 側のレコードの所有者がユーザー B です。ユーザー A は N 側のレコードへアクセス権をもちますか？"></a>・1 側のレコードの所有者がユーザー A で、N 側のレコードの所有者がユーザー B です。ユーザー A は N 側のレコードへアクセス権をもちますか？</h4><p>※ユーザー A は、N 側テーブルのアクセス権をもっていない、かつ共有設定は行われていない前提です。<br>親の関連付けの再設定が「カスケード」の場合、ユーザー A は所有者の異なる N 側のレコードへアクセス権をもちます。<br>親の関連付けの再設定が「カスケードなし」の場合は、ユーザー A は所有者の異なる N 側のレコードへアクセス権をもちません。  </p><h2 id="おわりに"><a href="#おわりに" class="headerlink" title="おわりに"></a>おわりに</h2><hr><p>今回ご説明した内容に関連した公開情報について、ご紹介します。<br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/create-edit-entity-relationships#table-relationship-behavior">テーブル リレーションシップ</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/maker/data-platform/data-platform-entity-lookup#add-advanced-relationship-behavior">テーブル間に関連付けを作成する</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/user/assign-or-share-records">行の割り当てまたは共有</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/user/share-row">ユーザーまたはチームと行を共有する</a><br><a href="https://learn.microsoft.com/ja-jp/power-apps/user/access-checker">行に対するユーザー アクセスを確認する</a>    </p><p>今回は、テーブル間のリレーションシップにおけるカスケード処理の具体的な動作についてご案内しました。<br>テーブルによっては、事前定義されたアプリケーション動作を担保するためにシステム側で予め設定されたカスケード処理が存在する場合や、カスケードは設定がない場合も製品プラグインによってカスケードに近い処理を実施している場合もありますので、ご留意ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Power Platform サポートチーム鈴木です。  &lt;/p&gt;
&lt;p&gt;Dataverse のテーブルとテーブルは、1:N、もしくは N:N の関連付けが可能です。&lt;br&gt;関連付けされたテーブル定義のことを、リレーションシップと呼びますが、今回はテーブル間のリレーションシップにおける、カスケード (伝播) 処理について、具体的な動作とともにご紹介します。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Dataverse" scheme="https://jpdynamicscrm.github.io/blog/tags/Dataverse/"/>
    
    <category term="Model-driven app" scheme="https://jpdynamicscrm.github.io/blog/tags/Model-driven-app/"/>
    
    <category term="Dynamics" scheme="https://jpdynamicscrm.github.io/blog/tags/Dynamics/"/>
    
  </entry>
  
  <entry>
    <title>Power Automate for desktop で作成したデスクトップ フローをクラウド フローから実行する方法 (有人実行)</title>
    <link href="https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-attand-automation/"/>
    <id>https://jpdynamicscrm.github.io/blog/powerautomate/power-automate-desktop-attand-automation/</id>
    <published>2023-04-20T08:00:00.000Z</published>
    <updated>2024-11-26T00:36:26.326Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Power Platform サポートの原野です。<br>本記事では Power Automate for desktop で作成したデスクトップ フローをクラウド フローから呼び出して、アテンド型 (有人) でフローを実行する方法についてご案内いたします。  </p><span id="more"></span><ol><li><a href="#anchor-intro">概要</a></li><li><a href="#anchor-attend-and-unattended-automation">有人実行(アテンド型)と無人実行(非アテンド型)の違い</a></li><li><a href="#anchor-licence-for-attended-automation">有人実行に必要なライセンスについて</a></li><li><a href="#anchor-attended-automation">デスクトップ フローを有人実行する方法</a><ol><li><a href="#anchor-register-computers">端末の登録方法</a></li><li><a href="#anchor-call-desktopflow-from-cloudflow">クラウド フローからデスクトップ フローを呼び出す方法</a></li><li><a href="#anchor-notes-on-attended-automation">有人実行の際の注意事項について</a></li><li><a href="#anchor-result-of-attended-automation-flow">実行結果</a></li></ol></li></ol><p><a id='anchor-intro'></a></p><h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>クラウド フローから Power Automate for desktop を呼び出して、デスクトップ フローを有人実行する方法についてご案内いたします。  </p><p><a id='anchor-attend-and-unattended-automation'></a></p><h1 id="有人実行-アテンド型-と無人実行-非アテンド型-の違い"><a href="#有人実行-アテンド型-と無人実行-非アテンド型-の違い" class="headerlink" title="有人実行 (アテンド型) と無人実行 (非アテンド型) の違い"></a>有人実行 (アテンド型) と無人実行 (非アテンド型) の違い</h1><p>クラウド フローから Power Automate for desktop を呼び出す方法として以下の 2 種類がございます。  </p><ul><li>有人実行 (アテンド型) ：<br>ユーザーが端末にサインインしている状態でデスクトップ フローを実行します。デスクトップ フローの実行時に画面をリアルタイムで確認することができます。  </li><li>無人実行 (非アテンド型) ：<br>ユーザーが端末からサインアウトしている状態でデスクトップ フローを実行します。  </li></ul><p>有人実行と無人実行の違いについて、公開情報もございますのでご確認いただけますと幸いです。<br><a href="https://learn.microsoft.com/ja-jp/power-automate/guidance/planning/attended-unattended">プロセス自動化のための有人および無人のシナリオ - Power Automate | Microsoft Learn</a></p><p><a id='anchor-licence-for-attended-automation'></a></p><h1 id="有人実行に必要なライセンスについて"><a href="#有人実行に必要なライセンスについて" class="headerlink" title="有人実行に必要なライセンスについて"></a>有人実行に必要なライセンスについて</h1><p>クラウド フローからデスクトップ フローを有人実行で呼び出す際には、下記のいずれかの Power Automate 有償ライセンスが必要になります。  </p><ul><li>Power Automate Premium  </li><li>従量課金制  </li></ul><p><a id='anchor-attended-automation'></a></p><h1 id="デスクトップ-フローを有人実行する方法"><a href="#デスクトップ-フローを有人実行する方法" class="headerlink" title="デスクトップ フローを有人実行する方法"></a>デスクトップ フローを有人実行する方法</h1><p>以下の方法について、順にご案内いたします。  </p><ul><li>端末の登録方法  </li><li>クラウド フローからデスクトップ フローを呼び出す方法  </li></ul><p><a id='anchor-register-computers'></a></p><h2 id="端末の登録方法"><a href="#端末の登録方法" class="headerlink" title="端末の登録方法"></a>端末の登録方法</h2><p>Power Automate コンピュータ ランタイム アプリを使用して、該当の環境にデスクトップ フローを実行する端末を登録を行います。  </p><ol><li><p>事前準備  </p><ul><li><p>セキュリティ ロール<br>コンピュータ登録には「環境作成者」または「デスクトップ フローコンピュータ所有者」のセキュリティ ロールが必要となります。<br>そのため、登録したい環境において、コンピュータ登録を実行しているアカウントに「環境作成者」または「デスクトップ フロー コンピュータ所有者」のセキュリティ ロールが付与されているかご確認ください。<br>セキュリティ ロールに関して以下の公開情報がございますので、ご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/power-platform/admin/security-roles-privileges">セキュリティ ロールおよび特権 - Power Platform | Microsoft Learn</a> </p></li><li><p>必要なエンドポイント<br>コンピュータを登録する際のネットワーク要件として、「ランタイムに必要なデスクトップ フロー サービス」がございます。<br>以下の公開情報をご確認いただき、グローバル エンドポイントと公開エンドポイントに接続できる状態となっているかご確認ください。<br><a href="https://learn.microsoft.com/ja-jp/power-automate/ip-address-configuration#desktop-flows-services-required-for-runtime">IP アドレスの構成 - Power Automate | Microsoft Learn</a>  </p></li></ul></li><li><p>Power Automate コンピュータ ランタイム アプリケーションをインストールする  </p><ul><li>Power Automate for desktop をまだインストールしていない場合<br>Power Automate for desktop のインストール時に「Power Automate コンピュータ ランタイム アプリをインストールして、Power Automate クラウド ポータルに接続する 」にチェックを入れます。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/register-computers3.png"></li><li>既にPower Automate for desktop インストールしている場合<br>設定 &gt; コンピューターの設定を開く &gt; アプリのインストールを選択します。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/register-computers.png">  </li></ul></li><li><p>Power Automate コンピュータ ランタイム アプリケーションを起動すると端末が自動的に現在の環境に登録されます。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/register-computers2.png"><br>上記の手順について公開情報にも記載がございますので、ご参照ください。<br><a href="https://learn.microsoft.com/ja-jp/power-automate/desktop-flows/manage-machines#register-a-new-machine">コンピュータの管理 - Power Automate | Microsoft Learn</a>  </p></li></ol><p><a id='anchor-call-desktopflow-from-cloudflow'></a></p><h2 id="クラウド-フローからデスクトップ-フローを呼び出す方法"><a href="#クラウド-フローからデスクトップ-フローを呼び出す方法" class="headerlink" title="クラウド フローからデスクトップ フローを呼び出す方法"></a>クラウド フローからデスクトップ フローを呼び出す方法</h2><p>デスクトップ フローをクラウド フローから有人実行で呼び出す方法についてご案内いたします。  </p><ol><li><p>デスクトップ フローを作成します。<br>既にデスクトップ フローを作成済みの場合は手順 2 にお進みください。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/call-desktopflow-from-cloudflow.png">  </p></li><li><p>デスクトップ フローを呼び出すためのクラウド フローを作成し、新しいステップ &gt; 「Desktop flows」コネクタの「デスクトップ用 Power Automate で構築したフローを実行する」アクションを選択します。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/call-desktopflow-from-cloudflow4.png">  </p></li><li><p>デスクトップ フローへの接続を設定します。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/call-desktopflow-from-cloudflow5.png">  </p><ul><li>接続：コンピューターに直接送信をご指定ください。  </li><li>コンピューターまたはコンピューター グループ：登録済みの端末をご指定ください。  </li><li>ドメインとユーザー名：「ドメイン名\ユーザー名」の形式でご指定ください。<br>現在端末ログオンしているユーザーのドメインとユーザーの名は <code>whoami</code> コマンドから確認いただけます。<br>※ Web 版 Power Automate のログインアカウントではございませんので、ご注意ください。 </li><li>パスワード：上記で指定したユーザーのパスワードをご指定ください。  </li></ul><p> whoami コマンドについて、公開情報に詳細な記載がございますのでご確認ください。<br> <a href="https://learn.microsoft.com/ja-jp/windows-server/administration/windows-commands/whoami">whoami | Microsoft Learn</a><br> また接続の作成方法についても、公開情報に詳細な記載がございますのでご確認ください。<br> <a href="https://learn.microsoft.com/ja-jp/power-automate/desktop-flows/manage-machines#trigger-a-desktop-flow-to-run-on-your-machine">コンピュータの管理 - Power Automate | Microsoft Learn</a>  </p></li><li><p>「デスクトップ用 Power Automate で構築したフローを実行する」アクションで呼び出したいデスクトップ フローと実行モードを選択します。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/call-desktopflow-from-cloudflow6.png">  </p><ul><li>Desktop フロー：呼び出したいデスクトップ フローをご指定ください。  </li><li>実行モード：アテンド型をご指定ください。  </li></ul></li></ol><p><a id='anchor-notes-on-attended-automation'></a></p><h2 id="有人実行の際の注意事項について"><a href="#有人実行の際の注意事項について" class="headerlink" title="有人実行の際の注意事項について"></a>有人実行の際の注意事項について</h2><p>有人実行でデスクトップ フローを呼び出す際は、フローを問題なく実行するために以下の点をご確認いただけますと幸いです。  </p><ul><li>端末にログオンしていること：接続を設定した際に指定したユーザーでログオンしているかどうかご確認ください。  </li><li>画面をロックしていないこと：有人実行する際に画面をロックしているとフローが実行できませんので、画面がロックされていないことをご確認ください。  </li></ul><p><a id='anchor-result-of-attended-automation-flow'></a></p><h2 id="実行結果"><a href="#実行結果" class="headerlink" title="実行結果"></a>実行結果</h2><p>Power Automate for desktop で作成したデスクトップ フローをクラウド フローからアテンド型 (有人) で呼び出して実行することができました。<br><img src="/blog/powerautomate/power-automate-desktop-attand-automation/result-of-attended-automation-flow.png">  </p><hr><h2 id="補足"><a href="#補足" class="headerlink" title="補足"></a>補足</h2><p>本手順は執筆時点でのユーザー インターフェイスを基に紹介しています。  バージョンアップによって若干の UI の遷移など異なる場合があります。  その場合は画面の指示に従って進めてください。  </p><hr>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。Power Platform サポートの原野です。&lt;br&gt;本記事では Power Automate for desktop で作成したデスクトップ フローをクラウド フローから呼び出して、アテンド型 (有人) でフローを実行する方法についてご案内いたします。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Power Automate" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate/"/>
    
    <category term="How to" scheme="https://jpdynamicscrm.github.io/blog/tags/How-to/"/>
    
    <category term="Desktop flow" scheme="https://jpdynamicscrm.github.io/blog/tags/Desktop-flow/"/>
    
    <category term="Power Automate for desktop" scheme="https://jpdynamicscrm.github.io/blog/tags/Power-Automate-for-desktop/"/>
    
  </entry>
  
</feed>
